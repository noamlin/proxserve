{"mappings":"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","sources":["src/index.ts","src/globals.ts","src/supporting-functions.ts","src/general-functions.ts","src/pseudo-methods.ts","src/proxy-methods.ts","src/event-emitter.ts"],"sourcesContent":["/**\n * 2022 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { proxyTypes, NODE_STATUSES, PROXY_STATUSES, ND, NID } from './globals';\nimport type { TargetVariable, SomeObject } from './types/globals';\nimport type { ProxserveInstance, DataNode, ProxyNode, ProxserveInstanceMetadata } from './types/proxserve-class';\nimport { unproxify, createNodes, stackTraceLog } from './supporting-functions';\nimport * as pseudoMethods from './pseudo-methods';\nimport * as proxyMethods from './proxy-methods';\nimport { realtypeof, splitPath, evalPath } from './general-functions';\nimport { initEmitEvent } from './event-emitter';\n\nconst doNotProxifyPrefix = '_$';\nconst pseudoMethodsAlternativeNamingPrefix = '$';\n\n/**\n * save an array of all reserved function names\n * and also add synonyms to these functions\n */\nlet pseudoMethodsNames = Object.keys(pseudoMethods);\nfor(let i = pseudoMethodsNames.length - 1; i >= 0; i--) {\n\tlet name = pseudoMethodsNames[i];\n\tlet synonym = pseudoMethodsAlternativeNamingPrefix + name;\n\tpseudoMethods[synonym] = pseudoMethods[name];\n\tpseudoMethodsNames.push(synonym);\n}\n\ninterface MakeOptions {\n\tstrict?: ProxserveInstanceMetadata['strict'];\n\tmethodsEmitRaw?: ProxserveInstanceMetadata['methodsEmitRaw'];\n\t/** internal root name of the instance */\n\tname?: string;\n\tdebug?: {\n\t\tdestroyDelay?: ProxserveInstanceMetadata['destroyDelay'];\n\t\ttrace?: ProxserveInstanceMetadata['trace'];\n\t};\n}\n\nexport class Proxserve {\n\t/**\n\t * make a new proxserve instance\n\t */\n\tstatic make<T>(target: TargetVariable, options = {} as MakeOptions): ProxserveInstance & T {\n\t\tconst {\n\t\t\tstrict = true,\n\t\t\tmethodsEmitRaw = false,\n\t\t\tname = '',\n\t\t\tdebug,\n\t\t} = options;\n\n\t\tconst destroyDelay = debug?.destroyDelay ?? 1000;\n\t\tconst trace = debug?.trace ?? 'none';\n\n\t\tlet dataTreePrototype: DataNode = {\n\t\t\t[NID]: {\n\t\t\t\tstatus: NODE_STATUSES.active,\n\t\t\t\tname,\n\t\t\t},\n\t\t\t[ND]: { isTreePrototype: true } as DataNode[typeof ND],\n\t\t};\n\t\tlet proxyTreePrototype: ProxyNode = {\n\t\t\t[NID]: { status: PROXY_STATUSES.alive },\n\t\t\t[ND]: { isTreePrototype: true } as ProxyNode[typeof ND],\n\t\t};\n\n\t\tconst newNodes = createNodes(dataTreePrototype, '', proxyTreePrototype, target);\n\n\t\tconst metadata = {\n\t\t\tstrict,\n\t\t\tmethodsEmitRaw,\n\t\t\tdestroyDelay,\n\t\t\ttrace,\n\t\t\tdataTree: newNodes.dataNode,\n\t\t\tproxyTree: newNodes.proxyNode,\n\t\t} as ProxserveInstanceMetadata;\n\n\t\treturn Proxserve.createProxy<T>(metadata, metadata.dataTree);\n\t}\n\n\t/**\n\t * create a new proxy and a new node for a property of the parent's target-object\n\t */\n\tstatic createProxy<T>(\n\t\tmetadata: ProxserveInstanceMetadata,\n\t\tparentDataNode: DataNode,\n\t\ttargetProperty?: string,\n\t): ProxserveInstance & T {\n\t\tconst parentProxyNode = parentDataNode[ND].proxyNode!;\n\t\tlet dataNode: DataNode;\n\t\tlet proxyNode: ProxyNode;\n\n\t\tif(targetProperty === undefined) { //refering to own node and not a child property (meaning root object)\n\t\t\tdataNode = parentDataNode;\n\t\t\tproxyNode = parentProxyNode;\n\t\t}\n\t\telse {\n\t\t\t//create new or reset an existing data-node and then creates a new proxy-node\n\t\t\tconst newNodes = createNodes(\n\t\t\t\tparentDataNode,\n\t\t\t\ttargetProperty,\n\t\t\t\tparentProxyNode,\n\t\t\t\tparentProxyNode[ND].target[targetProperty],\n\t\t\t);\n\t\t\tdataNode = newNodes.dataNode;\n\t\t\tproxyNode = newNodes.proxyNode!;\n\t\t}\n\n\t\tlet target = proxyNode[ND].target;\n\n\t\tlet typeoftarget = realtypeof(target);\n\n\t\tif(proxyTypes[typeoftarget]) {\n\t\t\tlet revocable = Proxy.revocable<TargetVariable>(target, {\n\t\t\t\tget: (target: TargetVariable/*same as parent scope 'target'*/, property: string|symbol, proxy) => {\n\t\t\t\t\tif(metadata.methodsEmitRaw === false && Object.prototype.hasOwnProperty.call(proxyMethods, property) && property in Object.getPrototypeOf(target)) {\n\t\t\t\t\t\t// use a proxy method instead of the built-in method that is on the prototype chain\n\t\t\t\t\t\treturn proxyMethods[property].bind({ metadata, dataNode, proxyNode });\n\t\t\t\t\t}\n\t\t\t\t\telse if(pseudoMethodsNames.includes(property as string) && typeof target[property] === 'undefined') {\n\t\t\t\t\t\t// can access a pseudo function (or its synonym) if their keywords isn't used\n\t\t\t\t\t\treturn pseudoMethods[property].bind({ metadata, dataNode, proxyNode });\n\t\t\t\t\t}\n\t\t\t\t\telse if(!target.propertyIsEnumerable(property) || typeof property === 'symbol') {\n\t\t\t\t\t\treturn target[property]; // non-enumerable or non-path'able aren't proxied\n\t\t\t\t\t}\n\t\t\t\t\telse if(\n\t\t\t\t\t\tproxyNode[property] // there's a child node\n\t\t\t\t\t\t&& proxyNode[property][ND].proxy // it holds a proxy\n\t\t\t\t\t\t&& proxyNode[property][NID].status === PROXY_STATUSES.alive\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn proxyNode[property][ND].proxy;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn target[property];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\n\t\t\t\tset: (target/*same as parent scope 'target'*/, property, value, proxy) => { //'receiver' is proxy\n\t\t\t\t\t/**\n\t\t\t\t\t * property can be a regular object because of a few possible reasons:\n\t\t\t\t\t * 1. proxy is deleted from tree but user keeps accessing it then it means he saved a reference.\n\t\t\t\t\t * 2. it is a non-enumerable property which means it was intentionally hidden.\n\t\t\t\t\t * 3. property is a symbol and symbols can't be proxied because we can't create a normal path for them.\n\t\t\t\t\t *    these properties are not proxied and should not emit change-event.\n\t\t\t\t\t *    except for: length\n\t\t\t\t\t * 4. property is manually set as raw object with the special prefix.\n\t\t\t\t\t * TODO - make a list of all possible properties exceptions (maybe function 'name'?)\n\t\t\t\t\t */\n\t\t\t\t\tif(dataNode[NID].status === NODE_STATUSES.blocked) { //blocked from changing values\n\t\t\t\t\t\tconsole.error('object is blocked. can\\'t change value of property:', property);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(\n\t\t\t\t\t\ttypeof property === 'symbol'\n\t\t\t\t\t\t|| property.indexOf(doNotProxifyPrefix) === 0\n\t\t\t\t\t) {\n\t\t\t\t\t\ttarget[property] = value;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(property !== 'length' && !target.propertyIsEnumerable(property)) {\n\t\t\t\t\t\t//if setting a whole new property then it is non-enumerable (yet) so a further test is needed\n\t\t\t\t\t\tlet descriptor = Object.getOwnPropertyDescriptor(target, property);\n\t\t\t\t\t\tif(typeof descriptor === 'object' && descriptor.enumerable === false) { //property was previously set\n\t\t\t\t\t\t\ttarget[property] = value;\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet oldValue = target[property]; // should not be proxy\n\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\tif(proxyNode[property] !== undefined && proxyNode[property][ND].proxy !== undefined) {\n\t\t\t\t\t\t// about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\tproxyNode[property][NID].status = PROXY_STATUSES.deleted;\n\t\t\t\t\t\tdelete dataNode[property][ND].proxyNode; // detach reference from data-node to proxy-node\n\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\tif(metadata.strict) {\n\t\t\t\t\t\t\t// postpone this cpu intense function for later, probably when proxserve is not in use\n\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, metadata.destroyDelay, proxyNode[property][ND].proxy);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = unproxify(value);\n\t\t\t\t\ttarget[property] = value; //assign new value\n\n\t\t\t\t\tlet isValueProxy = false;\n\t\t\t\t\tlet typeofvalue = realtypeof(value);\n\t\t\t\t\tif(proxyTypes[typeofvalue]) {\n\t\t\t\t\t\tProxserve.createProxy(metadata, dataNode, property); // if trying to add a new value which is an object then make it a proxy\n\t\t\t\t\t\tisValueProxy = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, value, isValueProxy, metadata.trace);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * TODO - this function is incomplete and doesn't handle all of 'descriptor' scenarios\n\t\t\t\t */\n\t\t\t\tdefineProperty: (target/*same as parent scope 'target'*/, property, descriptor) => {\n\t\t\t\t\tif(typeof property === 'symbol') {\n\t\t\t\t\t\tObject.defineProperty(target, property, descriptor);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet oldValue = target[property]; //should not be proxy\n\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\tif(proxyNode[property] !== undefined && proxyNode[property][ND].proxy !== undefined) {\n\t\t\t\t\t\t//about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\tproxyNode[property][NID].status = PROXY_STATUSES.deleted;\n\t\t\t\t\t\tdelete dataNode[property][ND].proxyNode; //detach reference from data-node to proxy-node\n\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\tif(metadata.strict) {\n\t\t\t\t\t\t\t//postpone this cpu intense function for later, probably when proxserve is not is use\n\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, metadata.destroyDelay, proxyNode[property][ND].proxy);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdescriptor.value = unproxify(descriptor.value);\n\t\t\t\t\tObject.defineProperty(target, property, descriptor); //defining the new value\n\t\t\t\t\tlet value = descriptor.value;\n\t\t\t\t\tlet isValueProxy = false;\n\t\t\t\t\t//excluding non-enumerable properties from being proxied\n\t\t\t\t\tlet typeofvalue = realtypeof(descriptor.value);\n\t\t\t\t\tif(proxyTypes[typeofvalue] && descriptor.enumerable === true) {\n\t\t\t\t\t\tProxserve.createProxy(metadata, dataNode, property); //if trying to add a new value which is an object then make it a proxy\n\t\t\t\t\t\tisValueProxy = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, value, isValueProxy);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\n\t\t\t\tdeleteProperty: (target/*same as parent scope 'target'*/, property) => {\n\t\t\t\t\tif(!target.propertyIsEnumerable(property) || typeof property === 'symbol') {\n\t\t\t\t\t\t//non-proxied properties simply get deleted and nothing more\n\t\t\t\t\t\tdelete target[property];\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(dataNode[NID].status === NODE_STATUSES.blocked) { //blocked from changing values\n\t\t\t\t\t\tconsole.error(`can't delete property '${property}'. object is blocked.`);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(property in target) {\n\t\t\t\t\t\tlet oldValue = target[property]; //should not be proxy\n\t\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\t\tif(proxyNode[property] !== undefined && proxyNode[property][ND].proxy !== undefined) {\n\t\t\t\t\t\t\t//about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\t\tproxyNode[property][NID].status = PROXY_STATUSES.deleted;\n\t\t\t\t\t\t\tdelete dataNode[property][ND].proxyNode; //detach reference from data-node to proxy-node\n\t\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\t\tif(metadata.strict) {\n\t\t\t\t\t\t\t\t//postpone this cpu intense function for later, probably when proxserve is not is use\n\t\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, metadata.destroyDelay, proxyNode[property][ND].proxy);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelete target[property]; // actual delete\n\n\t\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, undefined, false);\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn true; //do nothing because there's nothing to delete\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as ProxyHandler<TargetVariable>) as { proxy: ProxserveInstance & T, revoke: () => void };\n\n\t\t\tproxyNode[ND].proxy = revocable.proxy;\n\t\t\tproxyNode[ND].revoke = revocable.revoke;\n\n\t\t\tif(proxyTypes[typeoftarget]) {\n\t\t\t\tlet keys = Object.keys(target); //handles both Objects and Arrays\n\t\t\t\tfor(let key of keys) {\n\t\t\t\t\tif (key.indexOf(doNotProxifyPrefix) === 0) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlet typeofproperty = realtypeof(target[key]);\n\t\t\t\t\tif(proxyTypes[typeofproperty]) {\n\t\t\t\t\t\tProxserve.createProxy(metadata, dataNode, key); //recursively make child objects also proxies\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.warn(`Type of \"${typeoftarget}\" is not implemented`);\n\t\t\t}\n\n\t\t\treturn revocable.proxy;\n\t\t}\n\t\telse {\n\t\t\tconst types = Object.keys(proxyTypes);\n\t\t\tthrow new Error(`Must observe an ${types.join('/')}`);\n\t\t}\n\t}\n\n\t/**\n\t * Recursively revoke proxies, allowing them to be garbage collected.\n\t * this functions delays 1000 milliseconds to let time for all events to finish\n\t */\n\tstatic destroy(proxy: ProxserveInstance) {\n\t\tlet proxyNode: ProxyNode;\n\t\ttry {\n\t\t\tconst nodes = proxy.$getProxserveNodes();\n\t\t\tproxyNode = nodes.proxyNode;\n\t\t} catch(error) {\n\t\t\treturn; // proxy variable isn't a proxy\n\t\t}\n\n\t\tif(proxyNode[NID].status === PROXY_STATUSES.alive) {\n\t\t\tproxyNode[NID].status = PROXY_STATUSES.deleted;\n\t\t}\n\n\t\tlet typeofproxy = realtypeof(proxy);\n\n\t\tif(proxyTypes[typeofproxy]) {\n\t\t\tlet keys = Object.keys(proxy); // handles both Objects and Arrays\n\t\t\tfor(let key of keys) {\n\t\t\t\tif (key.indexOf(doNotProxifyPrefix) === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tlet typeofproperty = realtypeof(proxy[key]);\n\t\t\t\t\tif(proxyTypes[typeofproperty]) {\n\t\t\t\t\t\t// going to proxy[key], which is deleted, will return the original target so we will bypass it\n\t\t\t\t\t\tProxserve.destroy(proxyNode[key][ND].proxy!);\n\t\t\t\t\t}\n\t\t\t\t} catch(error) {\n\t\t\t\t\tconsole.error(error); // don't throw and kill the whole process just if this iteration fails\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tproxyNode[ND].revoke?.();\n\t\t\t//proxyNode[ND].proxy = undefined;\n\t\t\tproxyNode[NID].status = PROXY_STATUSES.revoked;\n\t\t}\n\t\telse {\n\t\t\tconsole.warn(`Type of \"${typeofproxy}\" is not implemented`);\n\t\t}\n\t}\n\n\t/**\n\t * splits a path to an array of properties\n\t */\n\tstatic splitPath(path: string): Array<string|number> {\n\t\treturn splitPath(path);\n\t}\n\n\t/**\n\t * evaluate a long path and return the designated object and its referred property\n\t */\n\tstatic evalPath(obj: SomeObject, path: string): {\n\t\tobject: SomeObject,\n\t\tproperty: string|number,\n\t\tvalue: any,\n\t} {\n\t\treturn evalPath(obj, path);\n\t}\n}","/**\n * 2022 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nexport const ND = Symbol.for('proxserve_node_data'); // key for the data of a node\nexport const NID = Symbol.for('proxserve_node_inherited_data'); // key for the inherited data of a node\n\n// acceptable types to be proxied\nexport const proxyTypes = {\n\t\"Object\": true,\n\t\"Array\": true,\n};\n\n// statuses of data-nodes\nexport enum NODE_STATUSES {\n\tactive = 'active',\n\tstopped = 'stopped',\n\tblocked = 'blocked',\n\tsplicing = 'splicing',\n};\n\n// statuses of proxies\nexport enum PROXY_STATUSES {\n\talive = 'alive',\n\tdeleted = 'deleted',\n\trevoked = 'revoked',\n};\n\n// event names that can be emitted\nexport enum EVENTS {\n\tcreate = 'create',\n\tupdate = 'update',\n\tdelete = 'delete',\n\tsplice = 'splice',\n\tshift = 'shift',\n\tunshift = 'unshift',\n};","/**\n * 2022 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { proxyTypes, ND, NID, EVENTS } from './globals';\nimport type { TargetVariable, ListenerData, ChangeEvent } from './types/globals';\nimport type { DataNode, ProxyNode, ProxserveInstanceMetadata, PseudoThis } from './types/proxserve-class';\nimport { realtypeof } from './general-functions';\nimport { whoami } from './pseudo-methods';\n\n/**\n * Convert property name to valid path segment\n */\nexport function property2path(obj: any, property: string|number): string {\n\tif(typeof property === 'symbol') {\n\t\tthrow new Error(`property of type \"symbol\" isn't path'able`);\n\t}\n\n\tconst typeofobj = realtypeof(obj);\n\tswitch(typeofobj) {\n\t\tcase 'Object': {\n\t\t\treturn `.${property}`;\n\t\t}\n\t\tcase 'Array': {\n\t\t\treturn `[${property}]`;\n\t\t}\n\t\tdefault: {\n\t\t\tconsole.warn(`Not Implemented (type of '${typeofobj}')`);\n\t\t\treturn property as string;\n\t\t}\n\t}\n}\n\n/**\n * recursively switch between all proxies to their original targets.\n * note: original targets should never hold proxies under them,\n * thus altering the object references (getting from 'value') should be ok.\n * if whoever uses this library decides to\n * \t1. create a proxy with children (sub-proxies)\n * \t2. create a regular object\n * \t3. adding sub-proxies to the regular object\n * \t4. attaching the regular object to the proxy\n * then this regular object will be altered.\n */\nexport function unproxify(value: any): any {\n\tconst typeofvalue = realtypeof(value);\n\n\tif(proxyTypes[typeofvalue]) {\n\t\tlet target = value;\n\t\ttry {\n\t\t\ttarget = value.$getOriginalTarget();\n\t\t} catch(error) {}\n\n\t\tswitch(typeofvalue) {\n\t\t\tcase 'Object':\n\t\t\t\tlet keys = Object.keys(target);\n\t\t\t\tfor(let key of keys) {\n\t\t\t\t\ttarget[key] = unproxify(target[key]); // maybe alters target and maybe returning the exact same object\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Array':\n\t\t\t\tfor(let i=0; i < target.length; i++) {\n\t\t\t\t\ttarget[i] = unproxify(target[i]); // maybe alters target and maybe returning the exact same object\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(`Not Implemented (type of '${typeofvalue}')`);\n\t\t}\n\n\t\treturn target;\n\t}\n\telse {\n\t\treturn value; // primitive\n\t}\n}\n\n/**\n * create or reset a node in a tree of meta-data (mainly path related)\n * and optionally create a node in a tree of proxy data (mainly objects related)\n */\nexport function createNodes(\n\tparentDataNode: DataNode,\n\tproperty: string | number,\n\tparentProxyNode?: ProxyNode,\n\ttarget?: TargetVariable,\n): { dataNode: DataNode, proxyNode: ProxyNode | undefined } {\n\t//handle property path\n\tlet propertyPath: string;\n\tif(parentProxyNode?.[ND].target) {\n\t\tpropertyPath = property2path(parentProxyNode[ND].target, property);\n\t} else {\n\t\tpropertyPath = property2path({}, property); // if parent doesn't have target then treat it as object\n\t}\n\t\n\t//handle data node\n\tlet dataNode: DataNode = parentDataNode[property]; // try to receive existing data-node\n\tif(!dataNode) {\n\t\tdataNode = {\n\t\t\t[NID]: Object.create(parentDataNode[NID]),\n\t\t\t[ND]: {\n\t\t\t\tparentNode: parentDataNode,\n\t\t\t\tlisteners: {\n\t\t\t\t\tshallow: [] as ListenerData[],\n\t\t\t\t\tdeep: [] as ListenerData[],\n\t\t\t\t},\n\t\t\t}\n\t\t} as DataNode;\n\t\tparentDataNode[property] = dataNode;\n\t}\n\n\tdelete dataNode[NID].status; // clears old status in case a node previously existed\n\t// updates path (for rare case where parent was array and then changed to object or vice versa)\n\tif(!parentDataNode[ND].isTreePrototype) {\n\t\tObject.assign(dataNode[ND], {\n\t\t\tpath: parentDataNode[ND].path + propertyPath,\n\t\t\tpropertyPath\n\t\t});\n\t}\n\telse {\n\t\tObject.assign(dataNode[ND], {\n\t\t\tpath: '',\n\t\t\tpropertyPath: ''\n\t\t});\n\t}\n\n\t// handle proxy node\n\tlet proxyNode: ProxyNode | undefined;\n\tif(parentProxyNode) {\n\t\tproxyNode = {\n\t\t\t[NID]: Object.create(parentProxyNode[NID]),\n\t\t\t[ND]: {\n\t\t\t\ttarget: target as TargetVariable,\n\t\t\t\tdataNode,\n\t\t\t},\n\t\t};\n\n\t\tparentProxyNode[property] = proxyNode;\n\n\t\t// attach nodes to each other\n\t\tdataNode[ND].proxyNode = proxyNode;\n\t} else {\n\t\t// this scenario is dangerous and exists only for `on()` of future variables (paths) that don't yet exist\n\t\tproxyNode = undefined;\n\t}\n\n\treturn { dataNode, proxyNode };\n}\n\nlet noStackFlag = false;\nexport function stackTraceLog(\n\tlogLevel: ProxserveInstanceMetadata['trace'],\n\tdataNode: DataNode,\n\tchange: ChangeEvent,\n) {\n\tif (logLevel === 'none') {\n\t\treturn;\n\t}\n\n\tconst err = new Error();\n\tconst stack = err.stack;\n\t\n\tif (!stack) {\n\t\tif (!noStackFlag) {\n\t\t\t// log this only once. no need to spam.\n\t\t\tconsole.error('Can\\'t log stack trace of proxserve. browser/runtime doesn\\'t support Error.stack');\n\t\t\tnoStackFlag = true;\n\t\t}\n\t\treturn;\n\t}\n\n\t// break stack to individual lines. each line will point to a file and function.\n\tconst lines = stack.split('\\n').map((value) => {\n\t\treturn value.trim();\n\t});\n\t// remove first and useless Error line.\n\tif (lines[0].toLowerCase().indexOf('error') === 0) {\n\t\tlines.shift();\n\t}\n\t// delete this function's own line.\n\tlines.shift();\n\t// delete `initEmitEvent` line.\n\tlines.shift();\n\n\t// write our message head.\n\tconst pathname = whoami.call({ dataNode } as PseudoThis);\n\tlet title = `${pathname} has been `;\n\tswitch (change.type) {\n\t\tcase EVENTS.create: title += 'created'; break;\n\t\tcase EVENTS.update: title += 'updated'; break;\n\t\tcase EVENTS.delete: title += 'deleted'; break;\n\t}\n\tlines.unshift(title);\n\n\tconsole.log(lines.join('\\n'));\n}\n","/**\n * 2022 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { SomeObject, SomeArray, VariableTypes } from './types/globals';\n\n/**\n * return a string representing the full type of the variable\n */\nexport function realtypeof(variable: any): VariableTypes {\n\tlet rawType = Object.prototype.toString.call(variable); //[object Object], [object Array], [object Number]...\n\treturn rawType.substring(8, rawType.length - 1) as VariableTypes;\n}\n\n/**\n * check if variable is a number or a string of a number\n * @param variable \n */\n/*export function isNumeric(variable: any): boolean {\n\tif(typeof variable === 'string' && variable === '') {\n\t\treturn false;\n\t}\n\t\n\treturn !isNaN(variable as number);\n}*/\n\n/**\n * recursively clones objects and array\n */\nconst simpleCloneSet = new WeakSet();\nexport function simpleClone(variable: any): any {\n\tlet typeofvar = realtypeof(variable);\n\n\tif(typeofvar === 'Object') {\n\t\tconst obj = variable as SomeObject;\n\t\tsimpleCloneSet.add(obj);\n\t\tconst cloned = {};\n\t\tlet keys = Object.keys(obj);\n\t\tfor(let key of keys) {\n\t\t\tif(simpleCloneSet.has(obj[key])) {\n\t\t\t\tcloned[key] = obj[key];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloned[key] = simpleClone(obj[key]);\n\t\t\t}\n\t\t}\n\t\treturn cloned;\n\t}\n\telse if(typeofvar === 'Array') {\n\t\tconst arr = variable as SomeArray;\n\t\tsimpleCloneSet.add(arr);\n\t\tconst cloned = [] as any[];\n\t\tfor(let i = 0; i < arr.length; i++) {\n\t\t\tif(simpleCloneSet.has(arr[i])) {\n\t\t\t\tcloned[i] = arr[i];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloned[i] = simpleClone(arr[i]);\n\t\t\t}\n\t\t}\n\t\treturn cloned;\n\t}\n\telse { // hopefully a primitive\n\t\tif(typeofvar !== 'Undefined' && typeofvar !== 'Null' && typeofvar !== 'Boolean' && typeofvar !== 'Number'\n\t\t&& typeofvar !== 'BigInt' && typeofvar !== 'String') {\n\t\t\tconsole.warn(`Can't clone a variable of type ${typeofvar}`);\n\t\t}\n\t\treturn variable;\n\t}\n}\n\n/**\n * splits a path to an array of properties\n * (benchmarked and is faster than regex and split())\n * @param path \n */\nexport function splitPath(path: string): Array<string|number> {\n\tif(typeof path !== 'string' || path === '') {\n\t\treturn [];\n\t}\n\t\n\tlet i = 0, betweenBrackets = false, onlyDigits = false;\n\t//loop will skip over openning '.' or '['\n\tif(path[0] === '.') {\n\t\ti = 1;\n\t} else if(path[0] === '[') {\n\t\ti = 1;\n\t\tbetweenBrackets = true;\n\t\tonlyDigits = true;\n\t}\n\n\tlet resultsArr = [] as Array<string|number>;\n\tlet tmp = '';\n\tfor(; i < path.length; i++) {\n\t\tlet char = path[i];\n\n\t\tif(betweenBrackets) {\n\t\t\tif(char === ']') {\n\t\t\t\tif(onlyDigits) {\n\t\t\t\t\tresultsArr.push(parseInt(tmp, 10));\n\t\t\t\t} else {\n\t\t\t\t\tresultsArr.push(tmp);\n\t\t\t\t}\n\n\t\t\t\tbetweenBrackets = false;\n\t\t\t\tonlyDigits = false;\n\t\t\t\ttmp = '';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(onlyDigits) {\n\t\t\t\t\tlet code = char.charCodeAt(0);\n\t\t\t\t\tif(code < 48 || code > 57) { //less than '0' char or greater than '9' char\n\t\t\t\t\t\tonlyDigits = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttmp += char;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif(char === '[') {\n\t\t\t\tbetweenBrackets = true;\n\t\t\t\tonlyDigits = true;\n\t\t\t}\n\t\t\t\n\t\t\t//check if starting a new property but avoid special case of [prop][prop]\n\t\t\tif(char === '.' || char === '[') {\n\t\t\t\tif(tmp !== '') {\n\t\t\t\t\tresultsArr.push(tmp);\n\t\t\t\t\ttmp = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttmp += char;\n\t\t\t}\n\t\t}\n\t}\n\tif(tmp !== '') {\n\t\tresultsArr.push(tmp);\n\t}\n\treturn resultsArr;\n}\n\n/**\n * evaluate a long path and return the designated object and its referred property\n */\nexport function evalPath(obj: SomeObject, path: string): {\n\tobject: SomeObject,\n\tproperty: string | number,\n\tvalue: any,\n} {\n\tif(path === '') {\n\t\treturn {\n\t\t\tobject: obj,\n\t\t\tproperty: '',\n\t\t\tvalue: obj,\n\t\t};\n\t}\n\n\tlet segments = splitPath(path);\n\tlet i: number;\n\tfor(i = 0; i <= segments.length - 2; i++) { // iterate until one before last property because they all must exist\n\t\tobj = obj[segments[i]];\n\t\tif(typeof obj === 'undefined') {\n\t\t\tthrow new Error(`Invalid path was given - \"${path}\"`);\n\t\t}\n\t}\n\treturn {\n\t\tobject: obj,\n\t\tproperty: segments[i],\n\t\tvalue: obj[ segments[i] ],\n\t};\n}","/**\n * 2022 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n// Pseudo methods are methods that aren't really on the object - not as a property nor via its prototype\n// thus they will not be retrieved via \"for..in\" and etcetera. Their property name is actually undefined, but\n// calling it will return the method via the JS proxy's \"get\" handler.\n// (i.e. someProxserve.pseudoFunction will return the pseudoFunction)\n\"use strict\"\n\nimport { EVENTS, NODE_STATUSES, ND, NID } from './globals';\nimport { ListenerData, EVENT_NAMES } from './types/globals';\nimport {\n\tStopFunction, BlockFunction, ActivateFunction,\n\tOnFunction, OnceFunction,\n\tRemoveListenerFunction, RemoveAllListenersFunction,\n\tGetProxserveNameFunction, WhoAMI,\n\tGetOriginalTargetFunction, GetProxserveNodesFunction,\n} from './types/pseudo-methods';\nimport { createNodes } from './supporting-functions';\nimport { splitPath } from './general-functions';\n\nexport const stop: StopFunction = function stop(this) {\n\tthis.dataNode[NID].status = NODE_STATUSES.stopped;\n};\n\nexport const block: BlockFunction = function block(this) {\n\tthis.dataNode[NID].status = NODE_STATUSES.blocked;\n};\n\nexport const activate: ActivateFunction = function activate(this, force = false): void {\n\tif(force || this.dataNode === this.metadata.dataTree) { // force activation or we are on root proxy\n\t\tthis.dataNode[NID].status = NODE_STATUSES.active;\n\t}\n\telse {\n\t\tdelete this.dataNode[NID].status;\n\t}\n};\n\nexport const on: OnFunction = function on(this, args) {\n\tconst {\n\t\tpath = '',\n\t\tlistener,\n\t\tid,\n\t\tdeep = false,\n\t\tonce = false,\n\t} = args;\n\t// its nicer to expose `event` to the user,\n\t// but since it is semi-reserved word, we internally rename it to `events`\n\tlet { event: events } = args;\n\n\tif(events === 'change') {\n\t\tevents = Object.keys(EVENTS) as EVENT_NAMES[]; // will listen to all events\n\t} else if(!Array.isArray(events)) {\n\t\tevents = [events];\n\t}\n\n\tfor(let event of events) {\n\t\tif(!EVENTS[event]) {\n\t\t\tconst names = Object.keys(EVENTS);\n\t\t\tthrow new Error(`${event} is not a valid event. valid events are ${names.join(',')}`);\n\t\t}\n\t}\n\t\n\tlet dataNode = this.dataNode;\n\tlet segments = splitPath(path);\n\tfor(let property of segments) { // traverse down the tree\n\t\tif(!dataNode[property]) {\n\t\t\t// create data-nodes if needed (in dataNode[property]), but don't create/overwrite proxy-nodes\n\t\t\tcreateNodes(dataNode, property);\n\t\t}\n\n\t\tdataNode = dataNode[property];\n\t}\n\n\tlet listenersPool = dataNode[ND].listeners.shallow;\n\tif(deep) {\n\t\tlistenersPool = dataNode[ND].listeners.deep;\n\t}\n\n\tlet listenerObj = {\n\t\ttype: events,\n\t\tonce,\n\t\tfunc: listener\n\t} as ListenerData;\n\n\tif(id !== undefined) {\n\t\tlistenerObj.id = id;\n\t}\n\tlistenersPool.push(listenerObj);\n};\n\nexport const once: OnceFunction = function once(this, args) {\n\targs.once = true;\n\ton.call(this, args);\n};\n\nfunction removeById(listenersArr: ListenerData[], id: string | number | Function): void {\n\tfor(let i = listenersArr.length - 1; i >= 0; i--) {\n\t\tlet listenerObj = listenersArr[i];\n\t\tif((id !== undefined && listenerObj.id === id) || listenerObj.func === id) {\n\t\t\tlistenersArr.splice(i, 1);\n\t\t}\n\t}\n}\n\nexport const removeListener: RemoveListenerFunction = function removeListener(this, args) {\n\tconst { id, path = '' } = args;\n\tconst fullPath = `${this.dataNode[ND].path}${path}`;\n\tlet dataNode = this.dataNode;\n\tconst segments = splitPath(path);\n\n\t// traverse down the tree\n\tfor(let property of segments) {\n\t\tif(!dataNode[property]) {\n\t\t\tconsole.warn(`can't remove listener from a non-existent path '${fullPath}'`);\n\t\t\treturn;\n\t\t}\n\t\tdataNode = dataNode[property];\n\t}\n\n\tremoveById(dataNode[ND].listeners.shallow, id);\n\tremoveById(dataNode[ND].listeners.deep, id);\n};\n\nexport const removeAllListeners: RemoveAllListenersFunction = function removeAllListeners(this, path = '') {\n\tconst fullPath = `${this.dataNode[ND].path}${path}`;\n\tconst segments = splitPath(path);\n\tlet dataNode = this.dataNode;\n\n\t//traverse down the tree\n\tfor(let property of segments) {\n\t\tif(!dataNode[property]) {\n\t\t\tconsole.warn(`can't remove all listeners from a non-existent path '${fullPath}'`);\n\t\t\treturn;\n\t\t}\n\t\tdataNode = dataNode[property];\n\t}\n\n\tdataNode[ND].listeners.shallow = [] as ListenerData[];\n\tdataNode[ND].listeners.deep = [] as ListenerData[];\n};\n\nexport const getOriginalTarget: GetOriginalTargetFunction = function getOriginalTarget(this) {\n\treturn this.proxyNode[ND].target;\n};\n\nexport const getProxserveName: GetProxserveNameFunction = function getProxserveName(this) {\n\treturn this.dataNode[NID].name;\n};\n\nexport const whoami: WhoAMI = function whoami(this) {\n\treturn this.dataNode[NID].name + this.dataNode[ND].path;\n};\n\nexport const getProxserveNodes: GetProxserveNodesFunction = function getProxserveNodes(this) {\n\treturn { dataNode: this.dataNode, proxyNode: this.proxyNode };\n};","/**\n * 2022 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n// Proxy methods are methods that will proxy JS built-in methods.\n// For examply, the proxy function for \"splice\" will handle some event stuff and then use\n// the actual \"splice\" function internally\n\"use strict\"\n\nimport { NODE_STATUSES, EVENTS, ND, NID } from './globals';\nimport { SpliceFunction, ShiftFunction, UnshiftFunction } from './types/proxy-methods';\nimport { initFunctionEmitEvent } from './event-emitter';\n\n\nexport const splice: SpliceFunction = function splice(\n\tthis,\n\tstart,\n\tdeleteCount,\n\t...items\n) {\n\tif(this.dataNode[NID].status !== NODE_STATUSES.active) {\n\t\t// if not active then run regular `splice`\n\t\t// which will reach the `set` of the ProxyHandler and will be blocked or events stopped, etc.\n\t\treturn Array.prototype.splice.call(this.proxyNode[ND].proxy, start, deleteCount, ...items);\n\t}\n\n\tlet isActiveByInheritance = !this.dataNode[NID].hasOwnProperty('status');\n\tthis.dataNode[NID].status = NODE_STATUSES.splicing;\n\tlet oldValue = this.proxyNode[ND].target.slice(0);\n\tlet deleted = Array.prototype.splice.call(this.proxyNode[ND].proxy, start, deleteCount, ...items); // creates many side-effect events\n\tlet args = { start, deleteCount, items };\n\t\n\tif(isActiveByInheritance) {\n\t\tdelete this.dataNode[NID].status;\n\t} else {\n\t\tthis.dataNode[NID].status = NODE_STATUSES.active;\n\t}\n\n\tinitFunctionEmitEvent(this.dataNode, EVENTS.splice, args, oldValue, this.proxyNode[ND].target);\n\n\treturn deleted;\n}\n\nexport const shift: ShiftFunction = function shift(this) {\n\tif(this.dataNode[NID].status !== NODE_STATUSES.active) {\n\t\t// if not active then run regular `shift`\n\t\t// which will reach the `set` of the ProxyHandler and will be blocked or events stopped, etc.\n\t\treturn Array.prototype.shift.call(this.proxyNode[ND].proxy);\n\t}\n\n\tlet isActiveByInheritance = !this.dataNode[NID].hasOwnProperty('status');\n\tthis.dataNode[NID].status = NODE_STATUSES.splicing;\n\tlet oldValue = this.proxyNode[ND].target.slice(0);\n\tlet deleted = Array.prototype.shift.call(this.proxyNode[ND].proxy); // creates many side-effect events\n\t\n\tif(isActiveByInheritance) {\n\t\tdelete this.dataNode[NID].status;\n\t} else {\n\t\tthis.dataNode[NID].status = NODE_STATUSES.active;\n\t}\n\n\tinitFunctionEmitEvent(this.dataNode, EVENTS.shift, {}, oldValue, this.proxyNode[ND].target);\n\n\treturn deleted;\n}\n\nexport const unshift: UnshiftFunction = function unshift(this, ...items) {\n\tif(this.dataNode[NID].status !== NODE_STATUSES.active) {\n\t\t// if not active then run regular `unshift`\n\t\t// which will reach the `set` of the ProxyHandler and will be blocked or events stopped, etc.\n\t\treturn Array.prototype.shift.call(this.proxyNode[ND].proxy) as number;\n\t}\n\n\tlet isActiveByInheritance = !this.dataNode[NID].hasOwnProperty('status');\n\tthis.dataNode[NID].status = NODE_STATUSES.splicing;\n\tlet oldValue = this.proxyNode[ND].target.slice(0);\n\tlet newLength: number = Array.prototype.unshift.call(this.proxyNode[ND].proxy, ...items); // creates many side-effect events\n\tlet args = { items };\n\t\n\tif(isActiveByInheritance) {\n\t\tdelete this.dataNode[NID].status;\n\t} else {\n\t\tthis.dataNode[NID].status = NODE_STATUSES.active;\n\t}\n\n\tinitFunctionEmitEvent(this.dataNode, EVENTS.unshift, args, oldValue, this.proxyNode[ND].target);\n\n\treturn newLength;\n}\n","/**\n * 2022 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { EVENTS, NODE_STATUSES, PROXY_STATUSES, ND, NID } from './globals';\nimport type { EVENT_NAMES, ChangeEvent, DeferredEvent, ListenerData } from './types/globals';\nimport type { DataNode, ProxserveInstanceMetadata } from './types/proxserve-class';\nimport { property2path, stackTraceLog } from './supporting-functions';\nimport { splitPath } from './general-functions';\n\n/**\n * try to get the proxy-object from a data-node. if can't then from it's parent's proxy\n * @param dataNode \n * @param property - the property as the dataNode is assigned on its parent\n */\nfunction getProxyValue(dataNode: DataNode, property?: string): any {\n\tif(dataNode[ND].proxyNode && dataNode[ND].proxyNode[NID].status === PROXY_STATUSES.alive) {\n\t\treturn dataNode[ND].proxyNode[ND].proxy; // actual proxy of child node\n\t}\n\telse {\n\t\tif(!property) {\n\t\t\t// my property on the parent\n\t\t\tproperty = splitPath(dataNode[ND].propertyPath)[0] as string;\n\t\t}\n\n\t\tlet parentNode = dataNode[ND].parentNode;\n\n\t\tif(parentNode[ND].proxyNode && parentNode[ND].proxyNode[NID].status === PROXY_STATUSES.alive) {\n\t\t\treturn parentNode[ND].proxyNode[ND].proxy?.[property]; // proxy or primitive via parent's proxy object\n\t\t}\n\t\telse {\n\t\t\t// if we reached here then probably we are on a capture phase of a deep deletion.\n\t\t\t// for example 'obj.sub1.sub2' gets 'delete obj.sub1' so now there are no values for 'sub2' nor its parent 'sub1'.\n\t\t\t// the warning is turned off because this situation seems okay\n\t\t\t// console.warn(`reached a capture level where neither child not parent proxy-nodes exist`);\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\n/**\n * process event and then bubble up and capture down the data tree\n */\nexport function initEmitEvent(\n\tdataNode: DataNode,\n\tproperty: string,\n\toldValue: any,\n\twasOldValueProxy: boolean,\n\tvalue: any,\n\tisValueProxy: boolean,\n\ttrace?: ProxserveInstanceMetadata['trace'],\n) {\n\tif(oldValue === value // no new change was made\n\t|| !dataNode[ND].proxyNode) { // proxy-node is detached from data-node\n\t\treturn;\n\t}\n\n\tlet proxyNode = dataNode[ND].proxyNode;\n\tif(proxyNode[NID].status !== PROXY_STATUSES.alive) { // altered a deleted proxy\n\t\treturn;\n\t}\n\n\tlet changeType = EVENTS.update;\n\tif(value === undefined) {\n\t\tchangeType = EVENTS.delete;\n\t} else if(oldValue === undefined) {\n\t\tchangeType = EVENTS.create;\n\t}\n\n\tlet deferredEvents: DeferredEvent[] | undefined;\n\t// altering properties of an array that's in the middle of a splicing phase\n\tif(dataNode[NID].status === NODE_STATUSES.splicing) {\n\t\t// initiate (if needed) an object to hold side effect events\n\t\tif(!dataNode[ND].deferredEvents) {\n\t\t\tdataNode[ND].deferredEvents = [];\n\t\t}\n\t\t// save a reference to the deferredEvents\n\t\tdeferredEvents = dataNode[ND].deferredEvents;\n\t}\n\n\tlet path: string;\n\tif(dataNode[property]) { // changed a property which has its own data node on the tree\n\t\tdataNode = dataNode[property];\n\t\tpath = '';\n\t} else {\n\t\tpath = property2path(proxyNode[ND].target, property);\n\t}\n\n\tlet change: ChangeEvent = {\n\t\tpath, value, oldValue, type: changeType,\n\t};\n\n\tif(!deferredEvents) {\n\t\tif (trace === 'normal' || trace === 'verbose') {\n\t\t\tstackTraceLog(trace, dataNode, change);\n\t\t}\n\t\tbubbleEmit(dataNode, change, property);\n\t\n\t\tif(wasOldValueProxy || isValueProxy) { // old value or new value are proxy meaning they are objects with children\n\t\t\tcaptureEmit(dataNode, change);\n\t\t}\n\t}\n\telse {\n\t\tdeferredEvents.push({dataNode, change, shouldCapture: wasOldValueProxy || isValueProxy});\n\t}\n}\n\n/**\n * bubbling phase - go up the data tree and emit\n * @param dataNode\n * @param change\n * @param property - property name of the data-node (i.e. as the data-node is assigned to its parent)\n */\nfunction bubbleEmit(dataNode: DataNode, change: ChangeEvent, property?: string): void {\n\tif(dataNode[NID].status === NODE_STATUSES.stopped) {\n\t\treturn; // not allowed to emit\n\t}\n\n\tlet thisValue = getProxyValue(dataNode, property);\n\n\tif(change.path === '') { // iterate over 'shallow' listeners\n\t\titerateAndEmit(dataNode[ND].listeners.shallow, thisValue, change);\n\t}\n\n\t// iterate over 'deep' listeners\n\titerateAndEmit(dataNode[ND].listeners.deep, thisValue, change);\n\n\tif(!dataNode[ND].parentNode[ND].isTreePrototype) { // we are not on root node yet\n\t\t// create a shallow copy of 'change' and update its path\n\t\t// (we don't want to alter the 'change' object that was just emitted to a listener)\n\t\tlet nextChange: ChangeEvent = {\n\t\t\t...change,\n\t\t\tpath: dataNode[ND].propertyPath + change.path\n\t\t};\n\n\t\tbubbleEmit(dataNode[ND].parentNode, nextChange);\n\t}\n}\n\n/**\n * capturing phase - go down the data tree and emit\n * @param dataNode\n * @param change\n */\nfunction captureEmit(dataNode: DataNode, change: ChangeEvent): void {\n\tlet keys = Object.keys(dataNode);\n\tfor(let key of keys) {\n\t\tlet subValue = (typeof change.value === 'object' && change.value !== null) ? change.value[key] : undefined;\n\t\tlet subOldValue = (typeof change.oldValue === 'object' && change.oldValue !== null) ? change.oldValue[key] : undefined;\n\t\tif(subValue !== subOldValue) { //if not both undefined or same primitive or the same object\n\t\t\tlet changeType = EVENTS.update;\n\t\t\tif(subValue === undefined) {\n\t\t\t\tchangeType = EVENTS.delete;\n\t\t\t} else if(subOldValue === undefined) {\n\t\t\t\tchangeType = EVENTS.create;\n\t\t\t}\n\n\t\t\tlet subChange: ChangeEvent = {\n\t\t\t\tpath: '',\n\t\t\t\toldValue: subOldValue,\n\t\t\t\tvalue: subValue,\n\t\t\t\ttype: changeType\n\t\t\t}\n\n\t\t\t// failing the status check will not emit for current property (but sub-properties might still be forcibly active)\n\t\t\tlet childNode = dataNode[key];\n\t\t\tif(childNode[NID].status !== NODE_STATUSES.stopped) {\n\t\t\t\tlet thisValue = getProxyValue(childNode, key);\n\t\t\t\titerateAndEmit(childNode[ND].listeners.shallow, thisValue, subChange);\n\t\t\t}\n\n\t\t\tcaptureEmit(childNode, subChange);\n\t\t}\n\t}\n}\n\n/**\n * iterate over an array of listeners, handle 'once' listeners and emit\n * @param listenersArr \n * @param thisValue \n * @param change \n */\nfunction iterateAndEmit(listenersArr: ListenerData[], thisValue: any, change: ChangeEvent): void {\n\tfor(let i = listenersArr.length - 1; i >= 0; i--) {\n\t\tlet listener = listenersArr[i];\n\t\tif(listener.type.includes(change.type)) {\n\t\t\tif(listener.once === true) {\n\t\t\t\tlistenersArr.splice(i, 1);\n\t\t\t}\n\t\t\tlistener.func.call(thisValue, change);\n\t\t}\n\t}\n}\n\n/**\n * process special event for a built-in method and then bubble up the data tree\n * @param dataNode\n * @param funcName - the method's name\n * @param funcArgs - the method's arguments\n * @param oldValue\n * @param value\n */\nexport function initFunctionEmitEvent(\n\tdataNode: DataNode,\n\tfuncName: EVENT_NAMES,\n\tfuncArgs: ChangeEvent['args'],\n\toldValue: any,\n\tvalue: any,\n) {\n\tlet change: ChangeEvent = {\n\t\tpath: '', value, oldValue, type: funcName, args: funcArgs,\n\t};\n\n\tbubbleEmit(dataNode, change);\n\n\tif(dataNode[ND].deferredEvents) {\n\t\t// manually handle the side-effect events that were caught\n\t\t// in order to not bubble up, but should capture down\n\t\tfor(let event of dataNode[ND].deferredEvents!) {\n\t\t\tif(event.change.path === '') {\n\t\t\t\t// no path means its an event directly on the property, not on the parent.\n\t\t\t\t// i.e: not an event with path \"0\" on \".arr\", but an event with no path on \".arr[0]\".\n\t\t\t\t// function event on \"arr\" already ran, but now a regular event on \"arr[0]\" is due\n\t\t\t\tlet thisValue = getProxyValue(event.dataNode);\n\t\t\t\titerateAndEmit(event.dataNode[ND].listeners.shallow, thisValue, event.change);\n\t\t\t\titerateAndEmit(event.dataNode[ND].listeners.deep, thisValue, event.change);\n\t\t\t}\n\n\t\t\tif(event.shouldCapture) {\n\t\t\t\tcaptureEmit(event.dataNode, event.change);\n\t\t\t}\n\t\t}\n\t\tdelete dataNode[ND].deferredEvents;\n\t}\n\telse {\n\t\tconsole.warn(`no side effect events for ${funcName} were made`);\n\t}\n}"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../"}