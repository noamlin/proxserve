{"version":3,"sources":["global-vars.js","general-functions.js","supporting-functions.js","pseudo-methods.js","event-emitter.js","proxy-methods.js","index.js"],"names":["proxyTypes","OBJECT","ARRAY","nodeStatuses","ACTIVE","STOPPED","BLOCKED","SPLICING","proxyStatuses","ALIVE","DELETED","REVOKED","eventNames","CREATE","UPDATE","DELETE","SPLICE","SHIFT","UNSHIFT","ND","Symbol","for","NID","realtypeof","variable","rawType","Object","prototype","toString","call","substring","length","simpleCloneSet","WeakSet","simpleClone","obj","typeofobj","cloned","add","keys","key","has","i","console","warn","splitPath","path","betweenBrackets","onlyDigits","resultsArr","tmp","char","push","parseInt","code","charCodeAt","evalPath","object","property","undefined","value","segments","Error","property2path","unproxify","typeofvalue","includes","target","$getOriginalTarget","error","createDataNode","parentNode","propertyPath","objects","node","create","status","assign","stop","dataNode","block","activate","force","dataTree","on","events","listener","deep","id","once","slice","Array","isArray","event","join","listenersPool","listeners","shallow","listenerObj","type","func","options","removeListener","arguments","fullPath","removeById","listenersArr","splice","removeAllListeners","getOriginalTarget","getProxserveObjects","getProxserveDataNode","getProxserveInstance","initEmitEvent","oldValue","wasOldValueProxy","isValueProxy","changeType","deferredEvents","change","bubbleEmit","captureEmit","shouldCapture","initFunctionEmitEvent","funcName","funcArgs","iterateAndEmit","proxy","isTreePrototype","nextChange","subValue","subOldValue","subChange","thisValue","start","deleteCount","items","isActiveByInheritance","hasOwnProperty","deleted","args","shift","unshift","newLength","pseudoMethodsNames","pseudoMethods","name","synonym","Proxserve","constructor","strict","emitMethods","debug","destroyDelay","createProxy","targetProperty","typeoftarget","revocable","Proxy","get","proxyMethods","getPrototypeOf","bind","propertyIsEnumerable","set","descriptor","getOwnPropertyDescriptor","enumerable","isOldValueProxy","setTimeout","destroy","defineProperty","deleteProperty","revoke","typeofproperty","$getProxserveDataNode","$getProxserveObjects","typeofproxy","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAEA,IAAIA,UAAU,GAAG,CAAC,QAAD,EAAW,OAAX,CAAjB,EAAsC;;;AACtCA,UAAU,CAACC,MAAX,GAAoBD,UAAU,CAAC,CAAD,CAA9B;AACAA,UAAU,CAACE,KAAX,GAAmBF,UAAU,CAAC,CAAD,CAA7B;AAEA,IAAIG,YAAY,GAAG,CAAC,QAAD,EAAW,SAAX,EAAsB,SAAtB,EAAiC,UAAjC,CAAnB,EAAiE;;;AACjEA,YAAY,CAACC,MAAb,GAAsBD,YAAY,CAAC,CAAD,CAAlC;AACAA,YAAY,CAACE,OAAb,GAAuBF,YAAY,CAAC,CAAD,CAAnC;AACAA,YAAY,CAACG,OAAb,GAAuBH,YAAY,CAAC,CAAD,CAAnC;AACAA,YAAY,CAACI,QAAb,GAAwBJ,YAAY,CAAC,CAAD,CAApC;AAEA,IAAIK,aAAa,GAAG,CAAC,OAAD,EAAU,SAAV,EAAqB,SAArB,CAApB,EAAqD;;;AACrDA,aAAa,CAACC,KAAd,GAAsBD,aAAa,CAAC,CAAD,CAAnC;AACAA,aAAa,CAACE,OAAd,GAAwBF,aAAa,CAAC,CAAD,CAArC;AACAA,aAAa,CAACG,OAAd,GAAwBH,aAAa,CAAC,CAAD,CAArC;AAEA,IAAII,UAAU,GAAG,CAAC,QAAD,EAAW,QAAX,EAAqB,QAArB,EAA+B,QAA/B,EAAyC,OAAzC,EAAkD,SAAlD,CAAjB;;AACAA,UAAU,CAACC,MAAX,GAAoBD,UAAU,CAAC,CAAD,CAA9B;AACAA,UAAU,CAACE,MAAX,GAAoBF,UAAU,CAAC,CAAD,CAA9B;AACAA,UAAU,CAACG,MAAX,GAAoBH,UAAU,CAAC,CAAD,CAA9B;AACAA,UAAU,CAACI,MAAX,GAAoBJ,UAAU,CAAC,CAAD,CAA9B;AACAA,UAAU,CAACK,KAAX,GAAmBL,UAAU,CAAC,CAAD,CAA7B;AACAA,UAAU,CAACM,OAAX,GAAqBN,UAAU,CAAC,CAAD,CAA/B;AAEA,IAAIO,EAAE,GAAGC,MAAM,CAACC,GAAP,CAAW,qBAAX,CAAT,EAA4C;;;AAC5C,IAAIC,GAAG,GAAGF,MAAM,CAACC,GAAP,CAAW,+BAAX,CAAV,EAAuD;;;;ACjCvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;AACO,SAASE,UAAT,CAAoBC,QAApB,EAA8B;AACpC,MAAIC,OAAO,GAAGC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BL,QAA/B,CAAd,CADoC,CACoB;;AACxD,SAAOC,OAAO,CAACK,SAAR,CAAkB,CAAlB,EAAqBL,OAAO,CAACM,MAAR,GAAiB,CAAtC,CAAP;AACA;AAED;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AACA,IAAIC,cAAc,GAAG,IAAIC,OAAJ,EAArB;;AACO,SAASC,WAAT,CAAqBC,GAArB,EAA0B;AAChC,MAAIC,SAAS,GAAGb,UAAU,CAACY,GAAD,CAA1B;AACA,MAAIE,MAAJ;;AACA,MAAGD,SAAS,KAAK,QAAjB,EAA2B;AAC1BJ,IAAAA,cAAc,CAACM,GAAf,CAAmBH,GAAnB;AACAE,IAAAA,MAAM,GAAG,EAAT;AACA,QAAIE,IAAI,GAAGb,MAAM,CAACa,IAAP,CAAYJ,GAAZ,CAAX;;AACA,SAAI,IAAIK,GAAR,IAAeD,IAAf,EAAqB;AACpB,UAAGP,cAAc,CAACS,GAAf,CAAmBN,GAAG,CAACK,GAAD,CAAtB,CAAH,EAAiC;AAChCH,QAAAA,MAAM,CAACG,GAAD,CAAN,GAAcL,GAAG,CAACK,GAAD,CAAjB;AACA,OAFD,MAGK;AACJH,QAAAA,MAAM,CAACG,GAAD,CAAN,GAAcN,WAAW,CAACC,GAAG,CAACK,GAAD,CAAJ,CAAzB;AACA;AACD;AACD,GAZD,MAaK,IAAGJ,SAAS,KAAK,OAAjB,EAA0B;AAC9BJ,IAAAA,cAAc,CAACM,GAAf,CAAmBH,GAAnB;AACAE,IAAAA,MAAM,GAAG,EAAT;;AACA,SAAI,IAAIK,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGP,GAAG,CAACJ,MAAvB,EAA+BW,CAAC,EAAhC,EAAoC;AACnC,UAAGV,cAAc,CAACS,GAAf,CAAmBN,GAAG,CAACO,CAAD,CAAtB,CAAH,EAA+B;AAC9BL,QAAAA,MAAM,CAACK,CAAD,CAAN,GAAYP,GAAG,CAACO,CAAD,CAAf;AACA,OAFD,MAGK;AACJL,QAAAA,MAAM,CAACK,CAAD,CAAN,GAAYR,WAAW,CAACC,GAAG,CAACO,CAAD,CAAJ,CAAvB;AACA;AACD;AACD,GAXI,MAYA;AAAE;AACNL,IAAAA,MAAM,GAAGF,GAAT;;AAEA,QAAGC,SAAS,KAAK,WAAd,IAA6BA,SAAS,KAAK,MAA3C,IAAqDA,SAAS,KAAK,SAAnE,IAAgFA,SAAS,KAAK,QAA9F,IACAA,SAAS,KAAK,QADd,IAC0BA,SAAS,KAAK,QAD3C,EACqD;AACpDO,MAAAA,OAAO,CAACC,IAAR,CAAc,kCAAiCR,SAAU,EAAzD;AACA;AACD;;AAED,SAAOC,MAAP;AACA;AAED;AACA;AACA;AACA;AACA;;;AACO,SAASQ,SAAT,CAAmBC,IAAnB,EAAyB;AAC/B,MAAG,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,KAAK,EAAxC,EAA4C;AAC3C,WAAO,EAAP;AACA;;AAED,MAAIJ,CAAC,GAAG,CAAR;AAAA,MAAWK,eAAe,GAAG,KAA7B;AAAA,MAAoCC,UAAU,GAAG,KAAjD,CAL+B,CAM/B;;AACA,MAAGF,IAAI,CAAC,CAAD,CAAJ,KAAY,GAAf,EAAoB;AACnBJ,IAAAA,CAAC,GAAG,CAAJ;AACA,GAFD,MAEO,IAAGI,IAAI,CAAC,CAAD,CAAJ,KAAY,GAAf,EAAoB;AAC1BJ,IAAAA,CAAC,GAAG,CAAJ;AACAK,IAAAA,eAAe,GAAG,IAAlB;AACAC,IAAAA,UAAU,GAAG,IAAb;AACA;;AAED,MAAIC,UAAU,GAAG,EAAjB;AACA,MAAIC,GAAG,GAAC,EAAR;;AACA,SAAMR,CAAC,GAAGI,IAAI,CAACf,MAAf,EAAuBW,CAAC,EAAxB,EAA4B;AAC3B,QAAIS,IAAI,GAAGL,IAAI,CAACJ,CAAD,CAAf;;AAEA,QAAGK,eAAH,EAAoB;AACnB,UAAGI,IAAI,KAAK,GAAZ,EAAiB;AAChB,YAAGH,UAAH,EAAeC,UAAU,CAACG,IAAX,CAAgBC,QAAQ,CAACH,GAAD,EAAM,EAAN,CAAxB,EAAf,KACKD,UAAU,CAACG,IAAX,CAAgBF,GAAhB;AAELH,QAAAA,eAAe,GAAG,KAAlB;AACAC,QAAAA,UAAU,GAAG,KAAb;AACAE,QAAAA,GAAG,GAAG,EAAN;AACA,OAPD,MAQK;AACJ,YAAGF,UAAH,EAAe;AACd,cAAIM,IAAI,GAAGH,IAAI,CAACI,UAAL,CAAgB,CAAhB,CAAX;;AACA,cAAGD,IAAI,GAAG,EAAP,IAAaA,IAAI,GAAG,EAAvB,EAA2B;AAAE;AAC5BN,YAAAA,UAAU,GAAG,KAAb;AACA;AACD;;AACDE,QAAAA,GAAG,IAAIC,IAAP;AACA;AACD,KAlBD,MAmBK;AACJ,UAAGA,IAAI,KAAK,GAAZ,EAAiB;AAChBJ,QAAAA,eAAe,GAAG,IAAlB;AACAC,QAAAA,UAAU,GAAG,IAAb;AACA,OAJG,CAMJ;;;AACA,UAAGG,IAAI,KAAK,GAAT,IAAgBA,IAAI,KAAK,GAA5B,EAAiC;AAChC,YAAGD,GAAG,KAAK,EAAX,EAAe;AACdD,UAAAA,UAAU,CAACG,IAAX,CAAgBF,GAAhB;AACAA,UAAAA,GAAG,GAAG,EAAN;AACA;AACD,OALD,MAMK;AACJA,QAAAA,GAAG,IAAIC,IAAP;AACA;AACD;AACD;;AACD,MAAGD,GAAG,KAAG,EAAT,EAAa;AACZD,IAAAA,UAAU,CAACG,IAAX,CAAgBF,GAAhB;AACA;;AACD,SAAOD,UAAP;AACA;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASO,QAAT,CAAkBrB,GAAlB,EAAuBW,IAAvB,EAA6B;AACnC,MAAGA,IAAI,KAAK,EAAZ,EAAgB;AACf,WAAO;AAAEW,MAAAA,MAAM,EAAEtB,GAAV;AAAeuB,MAAAA,QAAQ,EAAEC,SAAzB;AAAoCC,MAAAA,KAAK,EAAEzB;AAA3C,KAAP;AACA;;AAED,MAAI0B,QAAQ,GAAGhB,SAAS,CAACC,IAAD,CAAxB;AACA,MAAIJ,CAAJ;;AACA,OAAIA,CAAC,GAAG,CAAR,EAAWA,CAAC,IAAImB,QAAQ,CAAC9B,MAAT,GAAkB,CAAlC,EAAqCW,CAAC,EAAtC,EAA0C;AAAE;AAC3CP,IAAAA,GAAG,GAAGA,GAAG,CAAC0B,QAAQ,CAACnB,CAAD,CAAT,CAAT;;AACA,QAAG,OAAOP,GAAP,KAAe,WAAlB,EAA+B;AAC9B,YAAM,IAAI2B,KAAJ,CAAW,6BAA4BhB,IAAK,GAA5C,CAAN;AACA;AACD;;AACD,SAAO;AAAEW,IAAAA,MAAM,EAAEtB,GAAV;AAAeuB,IAAAA,QAAQ,EAAEG,QAAQ,CAACnB,CAAD,CAAjC;AAAsCkB,IAAAA,KAAK,EAAEzB,GAAG,CAAE0B,QAAQ,CAACnB,CAAD,CAAV;AAAhD,GAAP;AACA;;ACjKD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASqB,aAAT,CAAuB5B,GAAvB,EAA4BuB,QAA5B,EAAsC;AAC5C,MAAG,OAAOA,QAAP,KAAoB,QAAvB,EAAiC;AAChC,UAAM,IAAII,KAAJ,CAAW,2CAAX,CAAN;AACA;;AAED,MAAI1B,SAAS,GAAG,kCAAWD,GAAX,CAAhB;;AACA,UAAOC,SAAP;AACC,SAAK,QAAL;AAAe,aAAQ,IAAGsB,QAAS,EAApB;;AACf,SAAK,OAAL;AAAc,aAAQ,IAAGA,QAAS,GAApB;;AACd;AAASf,MAAAA,OAAO,CAACC,IAAR,CAAc,6BAA4BR,SAAU,IAApD;AAA0D,aAAOsB,QAAP;AAHpE;AAKA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASM,SAAT,CAAmBJ,KAAnB,EAA0B;AAChC,MAAIK,WAAW,GAAG,kCAAWL,KAAX,CAAlB;;AACA,MAAG5D,uBAAWkE,QAAX,CAAoBD,WAApB,CAAH,EAAqC;AACpC,QAAIE,MAAM,GAAGP,KAAb;;AACA,QAAI;AACHO,MAAAA,MAAM,GAAGP,KAAK,CAACQ,kBAAN,EAAT;AACA,KAFD,CAEE,OAAMC,KAAN,EAAa,CAAE;;AAEjB,YAAOJ,WAAP;AACC,WAAK,QAAL;AACC,YAAI1B,IAAI,GAAGb,MAAM,CAACa,IAAP,CAAY4B,MAAZ,CAAX;;AACA,aAAI,IAAI3B,GAAR,IAAeD,IAAf,EAAqB;AACpB4B,UAAAA,MAAM,CAAC3B,GAAD,CAAN,GAAcwB,SAAS,CAACG,MAAM,CAAC3B,GAAD,CAAP,CAAvB,CADoB,CACkB;AACtC;;AACD;;AACD,WAAK,OAAL;AACC,aAAI,IAAIE,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAGyB,MAAM,CAACpC,MAAxB,EAAgCW,CAAC,EAAjC,EAAqC;AACpCyB,UAAAA,MAAM,CAACzB,CAAD,CAAN,GAAYsB,SAAS,CAACG,MAAM,CAACzB,CAAD,CAAP,CAArB,CADoC,CACF;AAClC;;AACD;;AACD;AACCC,QAAAA,OAAO,CAACC,IAAR,CAAc,6BAA4BR,SAAU,IAApD;AAbF;;AAgBA,WAAO+B,MAAP;AACA,GAvBD,MAwBK;AACJ,WAAOP,KAAP,CADI,CACU;AACd;AACD;AAED;AACA;AACA;AACA;AACA;;;AACO,SAASU,cAAT,CAAwBC,UAAxB,EAAoCb,QAApC,EAA8C;AACpD,MAAIc,YAAJ;;AACA,MAAGD,UAAU,CAACpD,cAAD,CAAV,IAAkBoD,UAAU,CAACpD,cAAD,CAAV,CAAesD,OAAjC,IAA4CF,UAAU,CAACpD,cAAD,CAAV,CAAesD,OAAf,CAAuBN,MAAtE,EAA8E;AAC7EK,IAAAA,YAAY,GAAGT,aAAa,CAACQ,UAAU,CAACpD,cAAD,CAAV,CAAesD,OAAf,CAAuBN,MAAxB,EAAgCT,QAAhC,CAA5B;AACA,GAFD,MAEO;AACNc,IAAAA,YAAY,GAAGT,aAAa,CAAC,EAAD,EAAKL,QAAL,CAA5B,CADM,CACsC;AAC5C;;AAED,MAAIgB,IAAI,GAAGH,UAAU,CAACb,QAAD,CAArB;;AACA,MAAG,CAACgB,IAAJ,EAAU;AACTA,IAAAA,IAAI,GAAG;AACN,OAACpD,eAAD,GAAOI,MAAM,CAACiD,MAAP,CAAcJ,UAAU,CAACjD,eAAD,CAAxB,CADD;AAEN,OAACH,cAAD,GAAM;AACL,sBAAcoD,UADT;AAEL,qBAAa;AACZ,qBAAW,EADC;AAEZ,kBAAQ;AAFI;AAFR;AAFA,KAAP;AAUAA,IAAAA,UAAU,CAACb,QAAD,CAAV,GAAuBgB,IAAvB;AACA;;AAED,SAAOA,IAAI,CAACpD,eAAD,CAAJ,CAAUsD,MAAjB,CAvBoD,CAuB3B;AACzB;AACA;;AACAlD,EAAAA,MAAM,CAACmD,MAAP,CAAcH,IAAI,CAACvD,cAAD,CAAlB,EAAwB;AACvB,YAAQoD,UAAU,CAACpD,cAAD,CAAV,CAAe2B,IAAf,GAAsB0B,YADP;AAEvB,oBAAgBA,YAFO;AAGvB,eAAW9C,MAAM,CAACmD,MAAP,CAAcnD,MAAM,CAACiD,MAAP,CAAcJ,UAAU,CAACpD,cAAD,CAAV,CAAesD,OAA7B,CAAd,EAAqD;AAC/D,gBAAUd,SADqD;AAE/D,eAASA,SAFsD;AAG/D,gBAAUA;AACV;;AAJ+D,KAArD;AAHY,GAAxB;AAWA,SAAOe,IAAP;AACA;;ACpHD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;AAEA;;AACA;;AACA;;AAEA;AACA;AACA;AACA;AACO,SAASI,IAAT,CAAcC,QAAd,EAAwB;AAC9BA,EAAAA,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaE,OAApC;AACA;AAED;AACA;AACA;AACA;AACA;;;AACO,SAAS2E,KAAT,CAAeD,QAAf,EAAyB;AAC/BA,EAAAA,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaG,OAApC;AACA;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAAS2E,QAAT,CAAkBF,QAAlB,EAA4BN,OAA5B,EAAqCS,KAAK,GAAC,KAA3C,EAAkD;AACxD,MAAGA,KAAK,IAAIH,QAAQ,KAAK,KAAKI,QAA9B,EAAwC;AAAE;AACzCJ,IAAAA,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaC,MAApC;AACA,GAFD,MAGK;AACJ,WAAO2E,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAArB;AACA;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASQ,EAAT,CAAYL,QAAZ,EAAsBN,OAAtB,EAA+BY,MAA/B,EAAuCvC,IAAvC,EAA6CwC,QAA7C,EAAuD;AAACC,EAAAA,IAAI,GAAC,KAAN;AAAaC,EAAAA,EAAE,GAAC7B,SAAhB;AAA2B8B,EAAAA,IAAI,GAAC;AAAhC,IAAyC,EAAhG,EAAoG;AAC1G,MAAGJ,MAAM,KAAK,QAAd,EAAwBA,MAAM,GAAGzE,uBAAW8E,KAAX,CAAiB,CAAjB,CAAT,CAAxB,CAAsD;AAAtD,OACK,IAAG,CAACC,KAAK,CAACC,OAAN,CAAcP,MAAd,CAAJ,EAA2BA,MAAM,GAAG,CAACA,MAAD,CAAT;;AAEhC,OAAI,IAAIQ,KAAR,IAAiBR,MAAjB,EAAyB;AACxB,QAAG,CAACzE,uBAAWsD,QAAX,CAAoB2B,KAApB,CAAJ,EAAgC;AAC/B,YAAM,IAAI/B,KAAJ,CAAW,GAAE+B,KAAM,2CAA0CjF,uBAAWkF,IAAX,CAAgB,GAAhB,CAAqB,EAAlF,CAAN;AACA;AACD;;AAED,MAAG,OAAOhD,IAAP,KAAgB,UAAnB,EAA+B;AAAE;AAChC,QAAG,OAAOwC,QAAP,KAAoB,QAAvB,EAAiC;AAChC,UAAG,OAAOA,QAAQ,CAACC,IAAhB,KAAyB,SAA5B,EAAuCA,IAAI,GAAGD,QAAQ,CAACC,IAAhB;AACvC,UAAGD,QAAQ,CAACE,EAAT,KAAgB7B,SAAnB,EAA8B6B,EAAE,GAAGF,QAAQ,CAACE,EAAd;AAC9B,UAAG,OAAOF,QAAQ,CAACG,IAAhB,KAAyB,SAA5B,EAAuCA,IAAI,GAAGH,QAAQ,CAACG,IAAhB;AACvC;;AACDH,IAAAA,QAAQ,GAAGxC,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACA,GARD,MAQO,IAAG,OAAOwC,QAAP,KAAoB,UAAvB,EAAmC;AACzC,UAAM,IAAIxB,KAAJ,CAAW,2DAAX,CAAN;AACA;;AAED,MAAID,QAAQ,GAAG,iCAAUf,IAAV,CAAf,CAtB0G,CAuB1G;;AACA,OAAI,IAAIY,QAAR,IAAoBG,QAApB,EAA8B;AAC7B,QAAG,CAACkB,QAAQ,CAACrB,QAAD,CAAZ,EAAwB;AACvB,+CAAeqB,QAAf,EAAyBrB,QAAzB;AACA;;AACDqB,IAAAA,QAAQ,GAAGA,QAAQ,CAACrB,QAAD,CAAnB;AACA;;AAED,MAAIqC,aAAa,GAAGhB,QAAQ,CAAC5D,cAAD,CAAR,CAAa6E,SAAb,CAAuBC,OAA3C;AACA,MAAGV,IAAH,EAASQ,aAAa,GAAGhB,QAAQ,CAAC5D,cAAD,CAAR,CAAa6E,SAAb,CAAuBT,IAAvC;AAET,MAAIW,WAAW,GAAG;AACjBC,IAAAA,IAAI,EAAEd,MADW;AAEjBI,IAAAA,IAAI,EAAEA,IAFW;AAGjBW,IAAAA,IAAI,EAAEd;AAHW,GAAlB;;AAKA,MAAGE,EAAE,KAAK7B,SAAV,EAAqB;AACpBuC,IAAAA,WAAW,CAACV,EAAZ,GAAiBA,EAAjB;AACA;;AACDO,EAAAA,aAAa,CAAC3C,IAAd,CAAmB8C,WAAnB;AACA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAAST,IAAT,CAAcV,QAAd,EAAwBN,OAAxB,EAAiCY,MAAjC,EAAyCvC,IAAzC,EAA+CwC,QAA/C,EAAyDe,OAAzD,EAAkE;AACxE,MAAG,OAAOA,OAAP,KAAmB,QAAtB,EAAgCA,OAAO,GAAG,EAAV;AAChCA,EAAAA,OAAO,CAACZ,IAAR,GAAe,IAAf;AACAL,EAAAA,EAAE,CAACvD,IAAH,CAAQ,IAAR,EAAckD,QAAd,EAAwBN,OAAxB,EAAiCY,MAAjC,EAAyCvC,IAAzC,EAA+CwC,QAA/C,EAAyDe,OAAzD;AACA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASC,cAAT,CAAwBvB,QAAxB,EAAkCN,OAAlC,EAA2C3B,IAA3C,EAAiD0C,EAAjD,EAAqD;AAC3D,MAAGe,SAAS,CAACxE,MAAV,KAAqB,CAAxB,EAA2B;AAAE;AAC5ByD,IAAAA,EAAE,GAAG1C,IAAL;AACAA,IAAAA,IAAI,GAAG,EAAP;AACA;;AAED,MAAI0D,QAAQ,GAAI,GAAEzB,QAAQ,CAAC5D,cAAD,CAAR,CAAa2B,IAAK,GAAEA,IAAK,EAA3C;AACA,MAAIe,QAAQ,GAAG,iCAAUf,IAAV,CAAf,CAP2D,CAQ3D;;AACA,OAAI,IAAIY,QAAR,IAAoBG,QAApB,EAA8B;AAC7B,QAAG,CAACkB,QAAQ,CAACrB,QAAD,CAAZ,EAAwB;AACvBf,MAAAA,OAAO,CAACC,IAAR,CAAc,mDAAkD4D,QAAS,GAAzE;AACA;AACA;;AACDzB,IAAAA,QAAQ,GAAGA,QAAQ,CAACrB,QAAD,CAAnB;AACA;;AAED,WAAS+C,UAAT,CAAoBC,YAApB,EAAkClB,EAAlC,EAAsC;AACrC,SAAI,IAAI9C,CAAC,GAAGgE,YAAY,CAAC3E,MAAb,GAAsB,CAAlC,EAAqCW,CAAC,IAAI,CAA1C,EAA6CA,CAAC,EAA9C,EAAkD;AACjD,UAAIwD,WAAW,GAAGQ,YAAY,CAAChE,CAAD,CAA9B;;AACA,UAAI8C,EAAE,KAAK7B,SAAP,IAAoBuC,WAAW,CAACV,EAAZ,KAAmBA,EAAxC,IAA+CU,WAAW,CAACE,IAAZ,KAAqBZ,EAAvE,EAA2E;AAC1EkB,QAAAA,YAAY,CAACC,MAAb,CAAoBjE,CAApB,EAAuB,CAAvB;AACA;AACD;AACD;;AAED+D,EAAAA,UAAU,CAAC1B,QAAQ,CAAC5D,cAAD,CAAR,CAAa6E,SAAb,CAAuBC,OAAxB,EAAiCT,EAAjC,CAAV;AACAiB,EAAAA,UAAU,CAAC1B,QAAQ,CAAC5D,cAAD,CAAR,CAAa6E,SAAb,CAAuBT,IAAxB,EAA8BC,EAA9B,CAAV;AACA;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASoB,kBAAT,CAA4B7B,QAA5B,EAAsCN,OAAtC,EAA+C3B,IAAI,GAAC,EAApD,EAAwD;AAC9D,MAAI0D,QAAQ,GAAI,GAAEzB,QAAQ,CAAC5D,cAAD,CAAR,CAAa2B,IAAK,GAAEA,IAAK,EAA3C;AACA,MAAIe,QAAQ,GAAG,iCAAUf,IAAV,CAAf,CAF8D,CAG9D;;AACA,OAAI,IAAIY,QAAR,IAAoBG,QAApB,EAA8B;AAC7B,QAAG,CAACkB,QAAQ,CAACrB,QAAD,CAAZ,EAAwB;AACvBf,MAAAA,OAAO,CAACC,IAAR,CAAc,wDAAuD4D,QAAS,GAA9E;AACA;AACA;;AACDzB,IAAAA,QAAQ,GAAGA,QAAQ,CAACrB,QAAD,CAAnB;AACA;;AAEDqB,EAAAA,QAAQ,CAAC5D,cAAD,CAAR,CAAa6E,SAAb,CAAuBC,OAAvB,GAAiC,EAAjC;AACAlB,EAAAA,QAAQ,CAAC5D,cAAD,CAAR,CAAa6E,SAAb,CAAuBT,IAAvB,GAA8B,EAA9B;AACA;AAED;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASsB,iBAAT,CAA2B9B,QAA3B,EAAqCN,OAArC,EAA8C;AACpD,SAAOA,OAAO,CAACN,MAAf;AACA;AAED;AACA;AACA;AACA;AACA;;;AACO,SAAS2C,mBAAT,CAA6B/B,QAA7B,EAAuCN,OAAvC,EAAgD;AACtD,SAAOA,OAAP;AACA;AAED;AACA;AACA;AACA;;;AACO,SAASsC,oBAAT,CAA8BhC,QAA9B,EAAwC;AAC9C,SAAOA,QAAP;AACA;AAED;AACA;AACA;;;AACO,SAASiC,oBAAT,GAAgC;AACtC,SAAO,IAAP;AACA;;ACzND;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,aAAT,CAAuBlC,QAAvB,EAAiCrB,QAAjC,EAA2CwD,QAA3C,EAAqDC,gBAArD,EAAuEvD,KAAvE,EAA8EwD,YAA9E,EAA4F;AAClG,MAAGF,QAAQ,KAAKtD;AAAK;AAAlB,KACAmB,QAAQ,CAAC5D,cAAD,CAAR,CAAasD,OAAb,CAAqBG,MAArB,KAAgCpE,0BAAcC;AAAK;AADtD,IAC+F;AAC9F;AACA;;AAED,MAAI4G,UAAU,GAAGzG,uBAAWE,MAA5B;AACA,MAAG8C,KAAK,KAAKD,SAAb,EAAwB0D,UAAU,GAAGzG,uBAAWG,MAAxB,CAAxB,KACK,IAAGmG,QAAQ,KAAKvD,SAAhB,EAA2B0D,UAAU,GAAGzG,uBAAWC,MAAxB;AAEhC,MAAIyG,cAAJ,CAVkG,CAWlG;;AACA,MAAGvC,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,KAAyBzE,yBAAaI,QAAzC,EAAmD;AAClD;AACA,QAAG,CAACwE,QAAQ,CAAC5D,cAAD,CAAR,CAAamG,cAAjB,EAAiCvC,QAAQ,CAAC5D,cAAD,CAAR,CAAamG,cAAb,GAA8B,EAA9B,CAFiB,CAGlD;;AACAA,IAAAA,cAAc,GAAGvC,QAAQ,CAAC5D,cAAD,CAAR,CAAamG,cAA9B;AACA;;AAED,MAAIxE,IAAJ;;AACA,MAAGiC,QAAQ,CAACrB,QAAD,CAAX,EAAuB;AAAE;AACxBqB,IAAAA,QAAQ,GAAGA,QAAQ,CAACrB,QAAD,CAAnB;AACAZ,IAAAA,IAAI,GAAG,EAAP;AACA,GAHD,MAGO;AACNA,IAAAA,IAAI,GAAG,wCAAciC,QAAQ,CAAC5D,cAAD,CAAR,CAAasD,OAAb,CAAqBN,MAAnC,EAA2CT,QAA3C,CAAP;AACA;;AAED,MAAI6D,MAAM,GAAG;AACZ,YAAQzE,IADI;AACE,aAASc,KADX;AACkB,gBAAYsD,QAD9B;AACwC,YAAQG;AADhD,GAAb;;AAIA,MAAG,CAACC,cAAJ,EAAoB;AACnBE,IAAAA,UAAU,CAACzC,QAAD,EAAWwC,MAAX,CAAV;;AAEA,QAAGJ,gBAAgB,IAAIC,YAAvB,EAAqC;AAAE;AACtCK,MAAAA,WAAW,CAAC1C,QAAD,EAAWwC,MAAX,CAAX;AACA;AACD,GAND,MAOK;AACJD,IAAAA,cAAc,CAAClE,IAAf,CAAoB;AAAC2B,MAAAA,QAAD;AAAWwC,MAAAA,MAAX;AAAmBG,MAAAA,aAAa,EAAEP,gBAAgB,IAAIC;AAAtD,KAApB;AACA;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASO,qBAAT,CAA+B5C,QAA/B,EAAyC6C,QAAzC,EAAmDC,QAAnD,EAA6DX,QAA7D,EAAuEtD,KAAvE,EAA8E;AACpF,MAAI2D,MAAM,GAAG;AACZ,YAAQ,EADI;AACA,aAAS3D,KADT;AACgB,gBAAYsD,QAD5B;AACsC,YAAQU,QAD9C;AACwD,YAAQC;AADhE,GAAb;AAIAL,EAAAA,UAAU,CAACzC,QAAD,EAAWwC,MAAX,CAAV;;AAEA,MAAGxC,QAAQ,CAAC5D,cAAD,CAAR,CAAamG,cAAhB,EAAgC;AAC/B,SAAI,IAAIzB,KAAR,IAAiBd,QAAQ,CAAC5D,cAAD,CAAR,CAAamG,cAA9B,EAA8C;AAC7C,UAAGzB,KAAK,CAAC0B,MAAN,CAAazE,IAAb,KAAsB,EAAzB,EAA6B;AAC5B;AACA;AACA;AACAgF,QAAAA,cAAc,CAACjC,KAAK,CAACd,QAAN,CAAe5D,cAAf,EAAmB6E,SAAnB,CAA6BC,OAA9B,EAAuCJ,KAAK,CAACd,QAAN,CAAe5D,cAAf,EAAmBsD,OAAnB,CAA2BsD,KAAlE,EAAyElC,KAAK,CAAC0B,MAA/E,CAAd;AACAO,QAAAA,cAAc,CAACjC,KAAK,CAACd,QAAN,CAAe5D,cAAf,EAAmB6E,SAAnB,CAA6BT,IAA9B,EAAoCM,KAAK,CAACd,QAAN,CAAe5D,cAAf,EAAmBsD,OAAnB,CAA2BsD,KAA/D,EAAsElC,KAAK,CAAC0B,MAA5E,CAAd;AACA;;AAED,UAAG1B,KAAK,CAAC6B,aAAT,EAAwB;AACvBD,QAAAA,WAAW,CAAC5B,KAAK,CAACd,QAAP,EAAiBc,KAAK,CAAC0B,MAAvB,CAAX;AACA;AACD;;AACD,WAAOxC,QAAQ,CAAC5D,cAAD,CAAR,CAAamG,cAApB;AACA,GAfD,MAgBK;AACJ3E,IAAAA,OAAO,CAACC,IAAR,CAAc,6BAA4BgF,QAAS,YAAnD;AACA;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASJ,UAAT,CAAoBzC,QAApB,EAA8BwC,MAA9B,EAAsC;AACrC,MAAGxC,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,KAAyBzE,yBAAaE,OAAzC,EAAkD;AACjD,WADiD,CACzC;AACR;;AAED,MAAGkH,MAAM,CAACzE,IAAP,KAAgB,EAAnB,EAAuB;AAAE;AACxBgF,IAAAA,cAAc,CAAC/C,QAAQ,CAAC5D,cAAD,CAAR,CAAa6E,SAAb,CAAuBC,OAAxB,EAAiClB,QAAQ,CAAC5D,cAAD,CAAR,CAAasD,OAAb,CAAqBsD,KAAtD,EAA6DR,MAA7D,CAAd;AACA,GAPoC,CASrC;;;AACAO,EAAAA,cAAc,CAAC/C,QAAQ,CAAC5D,cAAD,CAAR,CAAa6E,SAAb,CAAuBT,IAAxB,EAA8BR,QAAQ,CAAC5D,cAAD,CAAR,CAAasD,OAAb,CAAqBsD,KAAnD,EAA0DR,MAA1D,CAAd;;AAEA,MAAG,CAACxC,QAAQ,CAAC5D,cAAD,CAAR,CAAaoD,UAAb,CAAwByD,eAA5B,EAA6C;AAAE;AAC9C;AACA;AACA,QAAIC,UAAU,GAAG,EAChB,GAAGV,MADa;AAEhBzE,MAAAA,IAAI,EAAEiC,QAAQ,CAAC5D,cAAD,CAAR,CAAaqD,YAAb,GAA4B+C,MAAM,CAACzE;AAFzB,KAAjB;AAIAiC,IAAAA,QAAQ,GAAGA,QAAQ,CAAC5D,cAAD,CAAR,CAAaoD,UAAxB;AACAiD,IAAAA,UAAU,CAACzC,QAAD,EAAWkD,UAAX,CAAV;AACA;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASR,WAAT,CAAqB1C,QAArB,EAA+BwC,MAA/B,EAAuC;AACtC,MAAIhF,IAAI,GAAGb,MAAM,CAACa,IAAP,CAAYwC,QAAZ,CAAX;;AACA,OAAI,IAAIvC,GAAR,IAAeD,IAAf,EAAqB;AACpB,QAAI2F,QAAQ,GAAI,OAAOX,MAAM,CAAC3D,KAAd,KAAwB,QAAxB,IAAoC2D,MAAM,CAAC3D,KAAP,KAAiB,IAAtD,GAA8D2D,MAAM,CAAC3D,KAAP,CAAapB,GAAb,CAA9D,GAAkFmB,SAAjG;AACA,QAAIwE,WAAW,GAAI,OAAOZ,MAAM,CAACL,QAAd,KAA2B,QAA3B,IAAuCK,MAAM,CAACL,QAAP,KAAoB,IAA5D,GAAoEK,MAAM,CAACL,QAAP,CAAgB1E,GAAhB,CAApE,GAA2FmB,SAA7G;;AACA,QAAGuE,QAAQ,KAAKC,WAAhB,EAA6B;AAAE;AAC9B,UAAId,UAAU,GAAGzG,uBAAWE,MAA5B;AACA,UAAGoH,QAAQ,KAAKvE,SAAhB,EAA2B0D,UAAU,GAAGzG,uBAAWG,MAAxB,CAA3B,KACK,IAAGoH,WAAW,KAAKxE,SAAnB,EAA8B0D,UAAU,GAAGzG,uBAAWC,MAAxB;AAEnC,UAAIuH,SAAS,GAAG;AACftF,QAAAA,IAAI,EAAE,EADS;AAEfoE,QAAAA,QAAQ,EAAEiB,WAFK;AAGfvE,QAAAA,KAAK,EAAEsE,QAHQ;AAIf/B,QAAAA,IAAI,EAAEkB;AAJS,OAAhB,CAL4B,CAY5B;;AACA,UAAGtC,QAAQ,CAACvC,GAAD,CAAR,CAAclB,eAAd,EAAmBsD,MAAnB,KAA8BzE,yBAAaE,OAA9C,EAAuD;AACtDyH,QAAAA,cAAc,CAAC/C,QAAQ,CAACvC,GAAD,CAAR,CAAcrB,cAAd,EAAkB6E,SAAlB,CAA4BC,OAA7B,EAAsClB,QAAQ,CAACvC,GAAD,CAAR,CAAcrB,cAAd,EAAkBsD,OAAlB,CAA0BsD,KAAhE,EAAuEK,SAAvE,CAAd;AACA;;AAEDX,MAAAA,WAAW,CAAC1C,QAAQ,CAACvC,GAAD,CAAT,EAAgB4F,SAAhB,CAAX;AACA;AACD;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASN,cAAT,CAAwBpB,YAAxB,EAAsC2B,SAAtC,EAAiDd,MAAjD,EAAyD;AACxD,OAAI,IAAI7E,CAAC,GAAGgE,YAAY,CAAC3E,MAAb,GAAsB,CAAlC,EAAqCW,CAAC,IAAI,CAA1C,EAA6CA,CAAC,EAA9C,EAAkD;AACjD,QAAI4C,QAAQ,GAAGoB,YAAY,CAAChE,CAAD,CAA3B;;AACA,QAAG4C,QAAQ,CAACa,IAAT,CAAcjC,QAAd,CAAuBqD,MAAM,CAACpB,IAA9B,CAAH,EAAwC;AACvC,UAAGb,QAAQ,CAACG,IAAT,KAAkB,IAArB,EAA2B;AAC1BiB,QAAAA,YAAY,CAACC,MAAb,CAAoBjE,CAApB,EAAuB,CAAvB;AACA;;AACD4C,MAAAA,QAAQ,CAACc,IAAT,CAAcvE,IAAd,CAAmBwG,SAAnB,EAA8Bd,MAA9B;AACA;AACD;AACD;;ACzLD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASZ,MAAT,CAAgB5B,QAAhB,EAA0BN,OAA1B,EAAmC6D,KAAnC,EAA0CC,WAA1C,EAAuD,GAAGC,KAA1D,EAAiE;AACvE,MAAGzD,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,KAAyBzE,yBAAaC,MAAzC,EAAiD;AAChD,WAAOuF,KAAK,CAAChE,SAAN,CAAgBgF,MAAhB,CAAuB9E,IAAvB,CAA4B4C,OAAO,CAACsD,KAApC,EAA2CO,KAA3C,EAAkDC,WAAlD,EAA+D,GAAGC,KAAlE,CAAP;AACA;;AAED,MAAIC,qBAAqB,GAAG,CAAC1D,QAAQ,CAACzD,eAAD,CAAR,CAAcoH,cAAd,CAA6B,QAA7B,CAA7B;AACA3D,EAAAA,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaI,QAApC;AACA,MAAI2G,QAAQ,GAAGzC,OAAO,CAACN,MAAR,CAAeuB,KAAf,CAAqB,CAArB,CAAf;AACA,MAAIiD,OAAO,GAAGhD,KAAK,CAAChE,SAAN,CAAgBgF,MAAhB,CAAuB9E,IAAvB,CAA4B4C,OAAO,CAACsD,KAApC,EAA2CO,KAA3C,EAAkDC,WAAlD,EAA+D,GAAGC,KAAlE,CAAd,CARuE,CAQiB;;AACxF,MAAII,IAAI,GAAG;AAAEN,IAAAA,KAAF;AAASC,IAAAA,WAAT;AAAsBC,IAAAA;AAAtB,GAAX;AAEA,MAAGC,qBAAH,EAA0B,OAAO1D,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAArB,CAA1B,KACKG,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaC,MAApC;AAEL,2CAAsB2E,QAAtB,EAAgCnE,uBAAWI,MAA3C,EAAmD4H,IAAnD,EAAyD1B,QAAzD,EAAmEzC,OAAO,CAACN,MAA3E;AAEA,SAAOwE,OAAP;AACA;AAED;AACA;AACA;AACA;AACA;;;AACO,SAASE,KAAT,CAAe9D,QAAf,EAAyBN,OAAzB,EAAkC;AACxC,MAAGM,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,KAAyBzE,yBAAaC,MAAzC,EAAiD;AAChD,WAAOuF,KAAK,CAAChE,SAAN,CAAgBkH,KAAhB,CAAsBhH,IAAtB,CAA2B4C,OAAO,CAACsD,KAAnC,CAAP;AACA;;AAED,MAAIU,qBAAqB,GAAG,CAAC1D,QAAQ,CAACzD,eAAD,CAAR,CAAcoH,cAAd,CAA6B,QAA7B,CAA7B;AACA3D,EAAAA,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaI,QAApC;AACA,MAAI2G,QAAQ,GAAGzC,OAAO,CAACN,MAAR,CAAeuB,KAAf,CAAqB,CAArB,CAAf;AACA,MAAIiD,OAAO,GAAGhD,KAAK,CAAChE,SAAN,CAAgBkH,KAAhB,CAAsBhH,IAAtB,CAA2B4C,OAAO,CAACsD,KAAnC,CAAd,CARwC,CAQiB;;AAEzD,MAAGU,qBAAH,EAA0B,OAAO1D,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAArB,CAA1B,KACKG,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaC,MAApC;AAEL,2CAAsB2E,QAAtB,EAAgCnE,uBAAWK,KAA3C,EAAkD,EAAlD,EAAsDiG,QAAtD,EAAgEzC,OAAO,CAACN,MAAxE;AAEA,SAAOwE,OAAP;AACA;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASG,OAAT,CAAiB/D,QAAjB,EAA2BN,OAA3B,EAAoC,GAAG+D,KAAvC,EAA8C;AACpD,MAAGzD,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,KAAyBzE,yBAAaC,MAAzC,EAAiD;AAChD,WAAOuF,KAAK,CAAChE,SAAN,CAAgBkH,KAAhB,CAAsBhH,IAAtB,CAA2B4C,OAAO,CAACsD,KAAnC,CAAP;AACA;;AAED,MAAIU,qBAAqB,GAAG,CAAC1D,QAAQ,CAACzD,eAAD,CAAR,CAAcoH,cAAd,CAA6B,QAA7B,CAA7B;AACA3D,EAAAA,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaI,QAApC;AACA,MAAI2G,QAAQ,GAAGzC,OAAO,CAACN,MAAR,CAAeuB,KAAf,CAAqB,CAArB,CAAf;AACA,MAAIqD,SAAS,GAAGpD,KAAK,CAAChE,SAAN,CAAgBmH,OAAhB,CAAwBjH,IAAxB,CAA6B4C,OAAO,CAACsD,KAArC,EAA4C,GAAGS,KAA/C,CAAhB,CARoD,CAQmB;;AACvE,MAAII,IAAI,GAAG;AAAEJ,IAAAA;AAAF,GAAX;AAEA,MAAGC,qBAAH,EAA0B,OAAO1D,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAArB,CAA1B,KACKG,QAAQ,CAACzD,eAAD,CAAR,CAAcsD,MAAd,GAAuBzE,yBAAaC,MAApC;AAEL,2CAAsB2E,QAAtB,EAAgCnE,uBAAWM,OAA3C,EAAoD0H,IAApD,EAA0D1B,QAA1D,EAAoEzC,OAAO,CAACN,MAA5E;AAEA,SAAO4E,SAAP;AACA;;ACxFD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;AAEA,IAAI5H,EAAE,GAAGC,MAAM,CAACC,GAAP,CAAW,qBAAX,CAAT,EAA4C;;AAC5C,IAAIC,GAAG,GAAGF,MAAM,CAACC,GAAP,CAAW,+BAAX,CAAV,EAAuD;;AAEvD;AACA;AACA;AACA;;AACA,IAAI2H,kBAAkB,GAAGtH,MAAM,CAACa,IAAP,CAAY0G,aAAZ,CAAzB;;AACA,KAAI,IAAIvG,CAAC,GAAGsG,kBAAkB,CAACjH,MAAnB,GAA4B,CAAxC,EAA2CW,CAAC,IAAI,CAAhD,EAAmDA,CAAC,EAApD,EAAwD;AACvD,MAAIwG,IAAI,GAAGF,kBAAkB,CAACtG,CAAD,CAA7B;AACA,MAAIyG,OAAO,GAAG,MAAID,IAAlB;AACAD,EAAAA,aAAa,CAACE,OAAD,CAAb,GAAyBF,aAAa,CAACC,IAAD,CAAtC;AACAF,EAAAA,kBAAkB,CAAC5F,IAAnB,CAAwB+F,OAAxB;AACA;;AAED,MAAMC,SAAN,CAAgB;AACf;AACD;AACA;AACA;AACA;AACA;AACA;AACCC,EAAAA,WAAW,CAAClF,MAAD,EAAS;AAAEmF,IAAAA,MAAM,GAAC,IAAT;AAAeC,IAAAA,WAAW,GAAC,IAA3B;AAAiCC,IAAAA,KAAK,GAAC;AAAvC,MAA8C,EAAvD,EAA2D;AACrE,SAAKF,MAAL,GAAcA,MAAd;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKE,YAAL,GAAoB,IAApB;AAEA,QAAGD,KAAK,IAAIA,KAAK,CAACC,YAAlB,EAAgC,KAAKA,YAAL,GAAoBD,KAAK,CAACC,YAA1B;AAEhC,SAAKtE,QAAL,GAAgB,yCAAe;AAC9B,OAAC7D,GAAD,GAAO;AACNsD,QAAAA,MAAM,EAAEzE,yBAAaC;AADf,OADuB;AAI9B,OAACe,EAAD,GAAM;AACLsD,QAAAA,OAAO,EAAE;AAAEG,UAAAA,MAAM,EAAEpE,0BAAcC;AAAxB;AADJ,OAJwB;AAO9BuH,MAAAA,eAAe,EAAE;AAPa,KAAf,EAQb,EARa,CAAhB;AASA,SAAK7C,QAAL,CAAchE,EAAd,EAAkB2B,IAAlB,GAAyB,EAAzB;AACA,SAAKqC,QAAL,CAAchE,EAAd,EAAkBqD,YAAlB,GAAiC,EAAjC;AACA,SAAKW,QAAL,CAAchE,EAAd,EAAkBsD,OAAlB,CAA0BN,MAA1B,GAAmCA,MAAnC;AAEA,WAAO,KAAKuF,WAAL,CAAiB,KAAKvE,QAAtB,CAAP;AACA;AAED;AACD;AACA;AACA;AACA;;;AACCuE,EAAAA,WAAW,CAACnF,UAAD,EAAaoF,cAAb,EAA6B;AACvC,QAAI5E,QAAJ;;AAEA,QAAG4E,cAAc,KAAKhG,SAAtB,EAAiC;AAAE;AAClCoB,MAAAA,QAAQ,GAAGR,UAAX;AACA,KAFD,MAGK;AACJQ,MAAAA,QAAQ,GAAG,yCAAeR,UAAf,EAA2BoF,cAA3B,CAAX,CADI,CACmD;;AACvD5E,MAAAA,QAAQ,CAAC5D,EAAD,CAAR,CAAasD,OAAb,CAAqBN,MAArB,GAA8BI,UAAU,CAACpD,EAAD,CAAV,CAAesD,OAAf,CAAuBN,MAAvB,CAA+BwF,cAA/B,CAA9B,CAFI,CAE2E;AAC/E;;AAED,QAAIlF,OAAO,GAAGM,QAAQ,CAAC5D,EAAD,CAAR,CAAasD,OAA3B,CAXuC,CAWH;;AACpC,QAAIN,MAAM,GAAGM,OAAO,CAACN,MAArB;AAEA,QAAIyF,YAAY,GAAG,kCAAWzF,MAAX,CAAnB;;AAEA,QAAGnE,uBAAWkE,QAAX,CAAoB0F,YAApB,CAAH,EAAsC;AACrC,UAAIC,SAAS,GAAGC,KAAK,CAACD,SAAN,CAAgB1F,MAAhB,EAAwB;AACvC4F,QAAAA,GAAG,EAAE,CAAC5F;AAAM;AAAP,UAA0CT,QAA1C,EAAoDqE,KAApD,KAA8D;AAClE,cAAG,KAAKwB,WAAL,IAAoBS,YAAY,CAACtB,cAAb,CAA4BhF,QAA5B,CAApB,IAA6DA,QAAQ,IAAIhC,MAAM,CAACuI,cAAP,CAAsB9F,MAAtB,CAA5E,EAA2G;AAC1G;AACA,mBAAO6F,YAAY,CAACtG,QAAD,CAAZ,CAAuBwG,IAAvB,CAA4B,IAA5B,EAAkCnF,QAAlC,EAA4CN,OAA5C,CAAP;AACA,WAHD,MAIK,IAAGuE,kBAAkB,CAAC9E,QAAnB,CAA4BR,QAA5B,KAAyC,OAAOS,MAAM,CAACT,QAAD,CAAb,KAA4B,WAAxE,EAAqF;AACzF;AACA,mBAAOuF,aAAa,CAACvF,QAAD,CAAb,CAAwBwG,IAAxB,CAA6B,IAA7B,EAAmCnF,QAAnC,EAA6CN,OAA7C,CAAP;AACA,WAHI,MAIA,IAAG,CAACN,MAAM,CAACgG,oBAAP,CAA4BzG,QAA5B,CAAD,IAA0C,OAAOA,QAAP,KAAoB,QAAjE,EAA2E;AAC/E,mBAAOS,MAAM,CAACT,QAAD,CAAb,CAD+E,CACtD;AACzB,WAFI,MAGA,IAAGqB,QAAQ,CAACrB,QAAD,CAAR,CAAmB;AAAnB,aACHqB,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BsD,KAD5B,CACkC;AADlC,aAEHhD,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BG,MAA/B,KAA0CpE,0BAAcC,KAFxD,EAE+D;AACnE,mBAAOsE,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BsD,KAAtC;AACA,WAJI,MAIE;AACN,mBAAO5D,MAAM,CAACT,QAAD,CAAb;AACA;AACD,SApBsC;AAsBvC0G,QAAAA,GAAG,EAAE,CAACjG;AAAM;AAAP,UAA0CT,QAA1C,EAAoDE,KAApD,EAA2DmE,KAA3D,KAAqE;AAAE;;AAC3E;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACK,cAAGhD,QAAQ,CAACzD,GAAD,CAAR,CAAcsD,MAAd,KAAyBzE,yBAAaG,OAAzC,EAAkD;AAAE;AACnDqC,YAAAA,OAAO,CAAC0B,KAAR,CAAe,mCAAkCX,QAAS,uBAA1D;AACA,mBAAO,IAAP;AACA,WAHD,MAIK,IAAG,OAAOA,QAAP,KAAoB,QAAvB,EAAiC;AACrCS,YAAAA,MAAM,CAACT,QAAD,CAAN,GAAmBE,KAAnB;AACA,mBAAO,IAAP;AACA,WAHI,MAIA,IAAGF,QAAQ,KAAK,QAAb,IAAyB,CAACS,MAAM,CAACgG,oBAAP,CAA4BzG,QAA5B,CAA7B,EAAoE;AACxE;AACA,gBAAI2G,UAAU,GAAG3I,MAAM,CAAC4I,wBAAP,CAAgCnG,MAAhC,EAAwCT,QAAxC,CAAjB;;AACA,gBAAG,OAAO2G,UAAP,KAAsB,QAAtB,IAAkCA,UAAU,CAACE,UAAX,KAA0B,KAA/D,EAAsE;AAAE;AACvEpG,cAAAA,MAAM,CAACT,QAAD,CAAN,GAAmBE,KAAnB;AACA,qBAAO,IAAP;AACA;AACD;;AAED,cAAIsD,QAAQ,GAAG/C,MAAM,CAACT,QAAD,CAArB,CA3ByE,CA2BxC;;AACjC,cAAI8G,eAAe,GAAG,KAAtB;;AACA,cAAGzF,QAAQ,CAACrB,QAAD,CAAR,KAAuBC,SAAvB,IAAoCoB,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BsD,KAA/B,KAAyCpE,SAAhF,EAA2F;AAC1F;AACAoB,YAAAA,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BG,MAA/B,GAAwCpE,0BAAcE,OAAtD;AACA8J,YAAAA,eAAe,GAAG,IAAlB;;AACA,gBAAG,KAAKlB,MAAR,EAAgB;AACf;AACAmB,cAAAA,UAAU,CAACrB,SAAS,CAACsB,OAAX,EAAoB,KAAKjB,YAAzB,EAAuC1E,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BsD,KAAtE,CAAV;AACA;AACD;;AAEDnE,UAAAA,KAAK,GAAG,oCAAUA,KAAV,CAAR;AACAO,UAAAA,MAAM,CAACT,QAAD,CAAN,GAAmBE,KAAnB,CAxCyE,CAwC/C;;AAE1B,cAAIwD,YAAY,GAAG,KAAnB;AACA,cAAInD,WAAW,GAAG,kCAAWL,KAAX,CAAlB;;AACA,cAAG5D,uBAAWkE,QAAX,CAAoBD,WAApB,CAAH,EAAqC;AACpC,iBAAKyF,WAAL,CAAiB3E,QAAjB,EAA2BrB,QAA3B,EADoC,CACE;;AACtC0D,YAAAA,YAAY,GAAG,IAAf;AACA;;AAED,2CAAcrC,QAAd,EAAwBrB,QAAxB,EAAkCwD,QAAlC,EAA4CsD,eAA5C,EAA6D5G,KAA7D,EAAoEwD,YAApE;AAEA,iBAAO,IAAP;AACA,SA1EsC;;AA4EvC;AACJ;AACA;AACIuD,QAAAA,cAAc,EAAE,CAACxG;AAAM;AAAP,UAA0CT,QAA1C,EAAoD2G,UAApD,KAAmE;AAClF,cAAG,OAAO3G,QAAP,KAAoB,QAAvB,EAAiC;AAChChC,YAAAA,MAAM,CAACiJ,cAAP,CAAsBxG,MAAtB,EAA8BT,QAA9B,EAAwC2G,UAAxC;AACA,mBAAO,IAAP;AACA;;AAED,cAAInD,QAAQ,GAAG/C,MAAM,CAACT,QAAD,CAArB,CANkF,CAMjD;;AACjC,cAAI8G,eAAe,GAAG,KAAtB;;AACA,cAAGzF,QAAQ,CAACrB,QAAD,CAAR,KAAuBC,SAAvB,IAAoCoB,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BsD,KAA/B,KAAyCpE,SAAhF,EAA2F;AAC1F;AACAoB,YAAAA,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BG,MAA/B,GAAwCpE,0BAAcE,OAAtD;AACA8J,YAAAA,eAAe,GAAG,IAAlB;;AACA,gBAAG,KAAKlB,MAAR,EAAgB;AACf;AACAmB,cAAAA,UAAU,CAACrB,SAAS,CAACsB,OAAX,EAAoB,KAAKjB,YAAzB,EAAuC1E,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BsD,KAAtE,CAAV;AACA;AACD;;AAEDsC,UAAAA,UAAU,CAACzG,KAAX,GAAmB,oCAAUyG,UAAU,CAACzG,KAArB,CAAnB;AACAlC,UAAAA,MAAM,CAACiJ,cAAP,CAAsBxG,MAAtB,EAA8BT,QAA9B,EAAwC2G,UAAxC,EAnBkF,CAmB7B;;AACrD,cAAIzG,KAAK,GAAGyG,UAAU,CAACzG,KAAvB;AACA,cAAIwD,YAAY,GAAG,KAAnB,CArBkF,CAsBlF;;AACA,cAAInD,WAAW,GAAG,kCAAWoG,UAAU,CAACzG,KAAtB,CAAlB;;AACA,cAAG5D,uBAAWkE,QAAX,CAAoBD,WAApB,KAAoCoG,UAAU,CAACE,UAAX,KAA0B,IAAjE,EAAuE;AACtE,iBAAKb,WAAL,CAAiB3E,QAAjB,EAA2BrB,QAA3B,EADsE,CAChC;;AACtC0D,YAAAA,YAAY,GAAG,IAAf;AACA;;AAED,2CAAcrC,QAAd,EAAwBrB,QAAxB,EAAkCwD,QAAlC,EAA4CsD,eAA5C,EAA6D5G,KAA7D,EAAoEwD,YAApE;AAEA,iBAAO,IAAP;AACA,SA/GsC;AAiHvCwD,QAAAA,cAAc,EAAE,CAACzG;AAAM;AAAP,UAA0CT,QAA1C,KAAuD;AACtE,cAAG,CAACS,MAAM,CAACgG,oBAAP,CAA4BzG,QAA5B,CAAD,IAA0C,OAAOA,QAAP,KAAoB,QAAjE,EAA2E;AAC1E;AACA,mBAAOS,MAAM,CAACT,QAAD,CAAb;AACA,mBAAO,IAAP;AACA;;AAED,cAAGqB,QAAQ,CAACzD,GAAD,CAAR,CAAcsD,MAAd,KAAyBzE,yBAAaG,OAAzC,EAAkD;AAAE;AACnDqC,YAAAA,OAAO,CAAC0B,KAAR,CAAe,0BAAyBX,QAAS,uBAAjD;AACA,mBAAO,IAAP;AACA;;AAED,cAAGA,QAAQ,IAAIS,MAAf,EAAuB;AACtB,gBAAI+C,QAAQ,GAAG/C,MAAM,CAACT,QAAD,CAArB,CADsB,CACW;;AACjC,gBAAI8G,eAAe,GAAG,KAAtB;;AACA,gBAAGzF,QAAQ,CAACrB,QAAD,CAAR,KAAuBC,SAAvB,IAAoCoB,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BsD,KAA/B,KAAyCpE,SAAhF,EAA2F;AAC1F;AACAoB,cAAAA,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BG,MAA/B,GAAwCpE,0BAAcE,OAAtD;AACA8J,cAAAA,eAAe,GAAG,IAAlB;;AACA,kBAAG,KAAKlB,MAAR,EAAgB;AACf;AACAmB,gBAAAA,UAAU,CAACrB,SAAS,CAACsB,OAAX,EAAoB,KAAKjB,YAAzB,EAAuC1E,QAAQ,CAACrB,QAAD,CAAR,CAAmBvC,EAAnB,EAAuBsD,OAAvB,CAA+BsD,KAAtE,CAAV;AACA;AACD;;AAED,mBAAO5D,MAAM,CAACT,QAAD,CAAb,CAbsB,CAaG;;AAEzB,6CAAcqB,QAAd,EAAwBrB,QAAxB,EAAkCwD,QAAlC,EAA4CsD,eAA5C,EAA6D7G,SAA7D,EAAwE,KAAxE;AAEA,mBAAO,IAAP;AACA,WAlBD,MAmBK;AACJ,mBAAO,IAAP,CADI,CACS;AACb;AACD;AAnJsC,OAAxB,CAAhB;AAsJAoB,MAAAA,QAAQ,CAAC5D,EAAD,CAAR,CAAasD,OAAb,CAAqBsD,KAArB,GAA6B8B,SAAS,CAAC9B,KAAvC;AACAhD,MAAAA,QAAQ,CAAC5D,EAAD,CAAR,CAAasD,OAAb,CAAqBoG,MAArB,GAA8BhB,SAAS,CAACgB,MAAxC;;AAEA,UAAGjB,YAAY,KAAK,QAApB,EAA8B;AAC7B,YAAIrH,IAAI,GAAGb,MAAM,CAACa,IAAP,CAAY4B,MAAZ,CAAX;;AACA,aAAI,IAAI3B,GAAR,IAAeD,IAAf,EAAqB;AACpB,cAAIuI,cAAc,GAAG,kCAAW3G,MAAM,CAAC3B,GAAD,CAAjB,CAArB;;AACA,cAAGxC,uBAAWkE,QAAX,CAAoB4G,cAApB,CAAH,EAAwC;AACvC,iBAAKpB,WAAL,CAAiB3E,QAAjB,EAA2BvC,GAA3B,EADuC,CACN;AACjC;AACD;AACD,OARD,MASK,IAAGoH,YAAY,KAAK,OAApB,EAA6B;AACjC,aAAI,IAAIlH,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGyB,MAAM,CAACpC,MAA1B,EAAkCW,CAAC,EAAnC,EAAuC;AACtC,cAAIoI,cAAc,GAAG,kCAAW3G,MAAM,CAACzB,CAAD,CAAjB,CAArB;;AACA,cAAG1C,uBAAWkE,QAAX,CAAoB4G,cAApB,CAAH,EAAwC;AACvC,iBAAKpB,WAAL,CAAiB3E,QAAjB,EAA2BrC,CAA3B,EADuC,CACR;AAC/B;AACD;AACD,OAPI,MAQA;AACJC,QAAAA,OAAO,CAACC,IAAR,CAAa,iBAAb;AACA;;AAED,aAAOiH,SAAS,CAAC9B,KAAjB;AACA,KAhLD,MAiLK;AACJ,YAAM,IAAIjE,KAAJ,CAAU,qBAAmB9D,uBAAW8F,IAAX,CAAgB,GAAhB,CAA7B,CAAN;AACA;AACD;AAED;AACD;AACA;AACA;AACA;;;AACC,SAAO4E,OAAP,CAAe3C,KAAf,EAAsB;AACrB,QAAIhD,QAAJ,EAAcN,OAAd;;AACA,QAAI;AACHM,MAAAA,QAAQ,GAAGgD,KAAK,CAACgD,qBAAN,EAAX;AACAtG,MAAAA,OAAO,GAAGsD,KAAK,CAACiD,oBAAN,EAAV;AACA,KAHD,CAGE,OAAM3G,KAAN,EAAa;AACd,aADc,CACN;AACR;;AAED,QAAGI,OAAO,CAACG,MAAR,KAAmBpE,0BAAcC,KAApC,EAA2C;AAC1CgE,MAAAA,OAAO,CAACG,MAAR,GAAiBpE,0BAAcE,OAA/B;AACA;;AAED,QAAIuK,WAAW,GAAG,kCAAWlD,KAAX,CAAlB;;AAEA,QAAG/H,uBAAWkE,QAAX,CAAoB+G,WAApB,CAAH,EAAqC;AACpC,UAAI1I,IAAI,GAAGb,MAAM,CAACa,IAAP,CAAYwF,KAAZ,CAAX,CADoC,CACL;;AAC/B,WAAI,IAAIvF,GAAR,IAAeD,IAAf,EAAqB;AACpB,YAAI;AACH,cAAIuI,cAAc,GAAG,kCAAW/C,KAAK,CAACvF,GAAD,CAAhB,CAArB;;AACA,cAAGxC,uBAAWkE,QAAX,CAAoB4G,cAApB,CAAH,EAAwC;AACvC1B,YAAAA,SAAS,CAACsB,OAAV,CAAkB3F,QAAQ,CAACvC,GAAD,CAAR,CAAcrB,EAAd,EAAkBsD,OAAlB,CAA0BsD,KAA5C;AACA;AACD,SALD,CAKE,OAAM1D,KAAN,EAAa;AACd1B,UAAAA,OAAO,CAAC0B,KAAR,CAAcA,KAAd,EADc,CACQ;AACtB;AACD;;AAEDI,MAAAA,OAAO,CAACoG,MAAR;AACApG,MAAAA,OAAO,CAACsD,KAAR,GAAgBpE,SAAhB;AACAc,MAAAA,OAAO,CAACG,MAAR,GAAiBpE,0BAAcG,OAA/B;AACA,KAhBD,MAiBK;AACJgC,MAAAA,OAAO,CAACC,IAAR,CAAc,YAAWqI,WAAY,sBAArC;AACA;AACD;;AAED,SAAOpI,SAAP,CAAiBC,IAAjB,EAAuB;AACtB,WAAO,iCAAUA,IAAV,CAAP;AACA;;AAED,SAAOU,QAAP,CAAgBrB,GAAhB,EAAqBW,IAArB,EAA2B;AAC1B,WAAO,gCAASX,GAAT,EAAcW,IAAd,CAAP;AACA;;AA1Rc;;AA6RhBoI,MAAM,CAACC,OAAP,GAAiBA,OAAO,GAAG/B,SAA3B,EAAsC","file":"proxserve.js","sourceRoot":"../src","sourcesContent":["/**\n * Copyright 2021 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nlet proxyTypes = ['Object', 'Array']; //acceptable types to be proxied\nproxyTypes.OBJECT = proxyTypes[0];\nproxyTypes.ARRAY = proxyTypes[1];\n\nlet nodeStatuses = ['active', 'stopped', 'blocked', 'splicing']; //statuses of data-nodes\nnodeStatuses.ACTIVE = nodeStatuses[0];\nnodeStatuses.STOPPED = nodeStatuses[1];\nnodeStatuses.BLOCKED = nodeStatuses[2];\nnodeStatuses.SPLICING = nodeStatuses[3];\n\nlet proxyStatuses = ['alive', 'deleted', 'revoked']; //statuses of proxies\nproxyStatuses.ALIVE = proxyStatuses[0];\nproxyStatuses.DELETED = proxyStatuses[1];\nproxyStatuses.REVOKED = proxyStatuses[2];\n\nlet eventNames = ['create', 'update', 'delete', 'splice', 'shift', 'unshift'];\neventNames.CREATE = eventNames[0];\neventNames.UPDATE = eventNames[1];\neventNames.DELETE = eventNames[2];\neventNames.SPLICE = eventNames[3];\neventNames.SHIFT = eventNames[4];\neventNames.UNSHIFT = eventNames[5];\n\nlet ND = Symbol.for('proxserve_node_data'); //key for the data of a node\nlet NID = Symbol.for('proxserve_node_inherited_data'); //key for the inherited data of a node\n\nexport { proxyTypes, nodeStatuses, proxyStatuses, eventNames, ND, NID };","/**\n * Copyright 2020 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\n/**\n * return a string representing the full type of the variable\n * @param {*} variable \n * @returns {String} - Object, Array, Number, String, Boolean, Null, Undefined, BigInt, Symbol, Date ...\n */\nexport function realtypeof(variable) {\n\tlet rawType = Object.prototype.toString.call(variable); //[object Object], [object Array], [object Number] ...\n\treturn rawType.substring(8, rawType.length - 1);\n}\n\n/**\n * check if variable is a number or a string of a number\n * @param {*} variable \n */\n/*export function isNumeric(variable) {\n\tif(typeof variable === 'string' && variable === '') return false;\n\telse return !isNaN(variable);\n}*/\n\n/**\n * recursively clones objects and array\n * @param {Proxy|Object|Array} proxy \n */\nlet simpleCloneSet = new WeakSet();\nexport function simpleClone(obj) {\n\tlet typeofobj = realtypeof(obj);\n\tlet cloned;\n\tif(typeofobj === 'Object') {\n\t\tsimpleCloneSet.add(obj);\n\t\tcloned = {};\n\t\tlet keys = Object.keys(obj);\n\t\tfor(let key of keys) {\n\t\t\tif(simpleCloneSet.has(obj[key])) {\n\t\t\t\tcloned[key] = obj[key];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloned[key] = simpleClone(obj[key]);\n\t\t\t}\n\t\t}\n\t}\n\telse if(typeofobj === 'Array') {\n\t\tsimpleCloneSet.add(obj);\n\t\tcloned = [];\n\t\tfor(let i = 0; i < obj.length; i++) {\n\t\t\tif(simpleCloneSet.has(obj[i])) {\n\t\t\t\tcloned[i] = obj[i];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloned[i] = simpleClone(obj[i]);\n\t\t\t}\n\t\t}\n\t}\n\telse { //hopefully a primitive\n\t\tcloned = obj;\n\n\t\tif(typeofobj !== 'Undefined' && typeofobj !== 'Null' && typeofobj !== 'Boolean' && typeofobj !== 'Number'\n\t\t&& typeofobj !== 'BigInt' && typeofobj !== 'String') {\n\t\t\tconsole.warn(`Can't clone a variable of type ${typeofobj}`);\n\t\t}\n\t}\n\n\treturn cloned;\n}\n\n/**\n * splits a path to an array of properties\n * (benchmarked and is faster than regex and split())\n * @param {String} path \n */\nexport function splitPath(path) {\n\tif(typeof path !== 'string' || path === '') {\n\t\treturn [];\n\t}\n\t\n\tlet i = 0, betweenBrackets = false, onlyDigits = false;\n\t//loop will skip over openning '.' or '['\n\tif(path[0] === '.') {\n\t\ti = 1;\n\t} else if(path[0] === '[') {\n\t\ti = 1;\n\t\tbetweenBrackets = true;\n\t\tonlyDigits = true;\n\t}\n\n\tlet resultsArr = [];\n\tlet tmp='';\n\tfor(; i < path.length; i++) {\n\t\tlet char = path[i];\n\n\t\tif(betweenBrackets) {\n\t\t\tif(char === ']') {\n\t\t\t\tif(onlyDigits) resultsArr.push(parseInt(tmp, 10));\n\t\t\t\telse resultsArr.push(tmp);\n\n\t\t\t\tbetweenBrackets = false;\n\t\t\t\tonlyDigits = false;\n\t\t\t\ttmp = '';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(onlyDigits) {\n\t\t\t\t\tlet code = char.charCodeAt(0);\n\t\t\t\t\tif(code < 48 || code > 57) { //less than '0' char or greater than '9' char\n\t\t\t\t\t\tonlyDigits = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttmp += char;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif(char === '[') {\n\t\t\t\tbetweenBrackets = true;\n\t\t\t\tonlyDigits = true;\n\t\t\t}\n\t\t\t\n\t\t\t//check if starting a new property but avoid special case of [prop][prop]\n\t\t\tif(char === '.' || char === '[') {\n\t\t\t\tif(tmp !== '') {\n\t\t\t\t\tresultsArr.push(tmp);\n\t\t\t\t\ttmp = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttmp += char;\n\t\t\t}\n\t\t}\n\t}\n\tif(tmp!=='') {\n\t\tresultsArr.push(tmp);\n\t}\n\treturn resultsArr;\n}\n\n/**\n * evaluate a long path and return the designated object and its referred property\n * @param {Object} obj\n * @param {String} path\n * @returns {Object} - returns {object, property, value}\n */\nexport function evalPath(obj, path) {\n\tif(path === '') {\n\t\treturn { object: obj, property: undefined, value: obj };\n\t}\n\n\tlet segments = splitPath(path);\n\tlet i;\n\tfor(i = 0; i <= segments.length - 2; i++) { //iterate until one before last property because they all must exist\n\t\tobj = obj[segments[i]];\n\t\tif(typeof obj === 'undefined') {\n\t\t\tthrow new Error(`Invalid path was given - \"${path}\"`);\n\t\t}\n\t}\n\treturn { object: obj, property: segments[i], value: obj[ segments[i] ] };\n}","/**\n * Copyright 2021 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { proxyTypes, ND, NID } from './global-vars.js';\nimport { realtypeof } from './general-functions.js';\n\n/**\n * Convert property name to valid path segment\n * @param {*} obj \n * @param {String} property \n */\nexport function property2path(obj, property) {\n\tif(typeof property === 'symbol') {\n\t\tthrow new Error(`property of type \"symbol\" isn't path'able`);\n\t}\n\n\tlet typeofobj = realtypeof(obj);\n\tswitch(typeofobj) {\n\t\tcase 'Object': return `.${property}`;\n\t\tcase 'Array': return `[${property}]`;\n\t\tdefault: console.warn(`Not Implemented (type of '${typeofobj}')`); return property;\n\t}\n}\n\n/**\n * recursively switch between all proxies to their original targets.\n * note: original targets should never hold proxies under them,\n * thus altering the object references (getting from 'value') should be ok.\n * if the programmer decided to\n * \t1. create a proxy with children (sub-proxies)\n * \t2. create a regular object\n * \t3. adding sub-proxies to the regular object\n * \t4. attaching the regular object to the proxy\n * then this regular object will be altered.\n * @param {*} value\n */\nexport function unproxify(value) {\n\tlet typeofvalue = realtypeof(value);\n\tif(proxyTypes.includes(typeofvalue)) {\n\t\tlet target = value;\n\t\ttry {\n\t\t\ttarget = value.$getOriginalTarget();\n\t\t} catch(error) {}\n\n\t\tswitch(typeofvalue) {\n\t\t\tcase 'Object':\n\t\t\t\tlet keys = Object.keys(target);\n\t\t\t\tfor(let key of keys) {\n\t\t\t\t\ttarget[key] = unproxify(target[key]); //maybe alters target and maybe returning the exact same object\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Array':\n\t\t\t\tfor(let i=0; i < target.length; i++) {\n\t\t\t\t\ttarget[i] = unproxify(target[i]); //maybe alters target and maybe returning the exact same object\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(`Not Implemented (type of '${typeofobj}')`);\n\t\t}\n\n\t\treturn target;\n\t}\n\telse {\n\t\treturn value; //primitive\n\t}\n}\n\n/**\n * create a node in a tree that mimics the proxserve's object and holds meta-data\n * @param {Object} parentNode \n * @param {String|Number} property \n */\nexport function createDataNode(parentNode, property) {\n\tlet propertyPath;\n\tif(parentNode[ND] && parentNode[ND].objects && parentNode[ND].objects.target) {\n\t\tpropertyPath = property2path(parentNode[ND].objects.target, property);\n\t} else {\n\t\tpropertyPath = property2path({}, property); //if parent doesn't have target then treat it as object\n\t}\n\t\n\tlet node = parentNode[property];\n\tif(!node) {\n\t\tnode = {\n\t\t\t[NID]: Object.create(parentNode[NID]),\n\t\t\t[ND]: {\n\t\t\t\t'parentNode': parentNode,\n\t\t\t\t'listeners': {\n\t\t\t\t\t'shallow': [],\n\t\t\t\t\t'deep': []\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tparentNode[property] = node;\n\t}\n\n\tdelete node[NID].status; //clears old status in case a node previously existed\n\t//updates path (for rare case where parent was array and then changed to object or vice versa)\n\t//and also makes a new and clean 'objects' property\n\tObject.assign(node[ND], {\n\t\t'path': parentNode[ND].path + propertyPath,\n\t\t'propertyPath': propertyPath,\n\t\t'objects': Object.assign(Object.create(parentNode[ND].objects), {\n\t\t\t'target': undefined,\n\t\t\t'proxy': undefined,\n\t\t\t'revoke': undefined\n\t\t\t/* inherits status */\n\t\t})\n\t});\n\n\treturn node;\n}\n","/**\n * Copyright 2021 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n// Pseudo methods are methods that aren't really on the object - not as a property nor via its prototype\n// thus they will not be retrieved via \"for..in\" and etcetera. Their property name is actually undefined, but\n// calling it will return the method via the JS proxy's \"get\" handler.\n// (i.e. someProxserve.pseudoFunction will return the pseudoFunction)\n\"use strict\"\n\nimport { eventNames, nodeStatuses, ND, NID } from './global-vars.js';\nimport { createDataNode } from './supporting-functions.js';\nimport { splitPath } from './general-functions.js';\n\n/**\n * stop object and children from emitting change events\n * automatically filled param {Object} dataNode\n */\nexport function stop(dataNode) {\n\tdataNode[NID].status = nodeStatuses.STOPPED;\n}\n\n/**\n * block object and children from any changes.\n * user can't set nor delete any property\n * automatically filled param {Object} dataNode\n */\nexport function block(dataNode) {\n\tdataNode[NID].status = nodeStatuses.BLOCKED;\n}\n\n/**\n * resume default behavior of emitting change events, inherited from parent\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n * @param {Boolean} [force] - force being active regardless of parent\n */\nexport function activate(dataNode, objects, force=false) {\n\tif(force || dataNode === this.dataTree) { //force activation or we are on root proxy\n\t\tdataNode[NID].status = nodeStatuses.ACTIVE;\n\t}\n\telse {\n\t\tdelete dataNode[NID].status;\n\t}\n}\n\n/**\n * add event listener on a proxy or on a descending path\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n * @param {String|Array.String} events\n * @param {String} [path] - path selector\n * @param {Function} listener\n * @param {Object} [options]\n * \t@property {Boolean} [options.deep] - should listen for event emitted by sub-objects or not\n * \t@property {Boolean} [options.id] - identifier for removing this listener later\n * \t@property {Boolean} [options.once] - whether this listener will run only once or always\n */\nexport function on(dataNode, objects, events, path, listener, {deep=false, id=undefined, once=false} = {}) {\n\tif(events === 'change') events = eventNames.slice(0); //will listen to all events\n\telse if(!Array.isArray(events)) events = [events];\n\n\tfor(let event of events) {\n\t\tif(!eventNames.includes(event)) {\n\t\t\tthrow new Error(`${event} is not a valid event. valid events are ${eventNames.join(',')}`);\n\t\t}\n\t}\n\t\n\tif(typeof path === 'function') { //if called without path\n\t\tif(typeof listener === 'object') {\n\t\t\tif(typeof listener.deep === 'boolean') deep = listener.deep;\n\t\t\tif(listener.id !== undefined) id = listener.id;\n\t\t\tif(typeof listener.once === 'boolean') once = listener.once;\n\t\t}\n\t\tlistener = path;\n\t\tpath = '';\n\t} else if(typeof listener !== 'function') {\n\t\tthrow new Error(`invalid arguments were given. listener must be a function`);\n\t}\n\t\n\tlet segments = splitPath(path);\n\t//traverse down the tree. create data-nodes if needed\n\tfor(let property of segments) {\n\t\tif(!dataNode[property]) {\n\t\t\tcreateDataNode(dataNode, property);\n\t\t}\n\t\tdataNode = dataNode[property];\n\t}\n\n\tlet listenersPool = dataNode[ND].listeners.shallow;\n\tif(deep) listenersPool = dataNode[ND].listeners.deep;\n\n\tlet listenerObj = {\n\t\ttype: events,\n\t\tonce: once,\n\t\tfunc: listener\n\t};\n\tif(id !== undefined) {\n\t\tlistenerObj.id = id;\n\t}\n\tlistenersPool.push(listenerObj);\n}\n\n/**\n * add event listener on a proxy or on a descending path which will run only once\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n * @param {String|Array.String} events\n * @param {String} [path] - path selector\n * @param {Function} listener \n * @param {String} [options]\n */\nexport function once(dataNode, objects, events, path, listener, options) {\n\tif(typeof options !== 'object') options = {};\n\toptions.once = true;\n\ton.call(this, dataNode, objects, events, path, listener, options);\n}\n\n/**\n * removes a listener from a path by an identifier (can have multiple listeners with the same ID)\n * or by the listener function itself\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n * @param {String} [path] - path selector\n * @param {String|Function} id - the listener(s) identifier or listener-function\n */\nexport function removeListener(dataNode, objects, path, id) {\n\tif(arguments.length === 3) { //if called without path\n\t\tid = path;\n\t\tpath = '';\n\t}\n\n\tlet fullPath = `${dataNode[ND].path}${path}`;\n\tlet segments = splitPath(path);\n\t//traverse down the tree\n\tfor(let property of segments) {\n\t\tif(!dataNode[property]) {\n\t\t\tconsole.warn(`can't remove listener from a non-existent path '${fullPath}'`);\n\t\t\treturn;\n\t\t}\n\t\tdataNode = dataNode[property];\n\t}\n\n\tfunction removeById(listenersArr, id) {\n\t\tfor(let i = listenersArr.length - 1; i >= 0; i--) {\n\t\t\tlet listenerObj = listenersArr[i];\n\t\t\tif((id !== undefined && listenerObj.id === id) || listenerObj.func === id) {\n\t\t\t\tlistenersArr.splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveById(dataNode[ND].listeners.shallow, id);\n\tremoveById(dataNode[ND].listeners.deep, id);\n}\n\n/**\n * removing all listeners of a path\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n * @param {String} [path] - path selector\n */\nexport function removeAllListeners(dataNode, objects, path='') {\n\tlet fullPath = `${dataNode[ND].path}${path}`;\n\tlet segments = splitPath(path);\n\t//traverse down the tree\n\tfor(let property of segments) {\n\t\tif(!dataNode[property]) {\n\t\t\tconsole.warn(`can't remove all listeners from a non-existent path '${fullPath}'`);\n\t\t\treturn;\n\t\t}\n\t\tdataNode = dataNode[property];\n\t}\n\n\tdataNode[ND].listeners.shallow = [];\n\tdataNode[ND].listeners.deep = [];\n}\n\n/**\n * the following functions (getOriginalTarget, getProxserveObjects, getProxserveDataNode, getProxserveInstance) seem silly\n * because they could have been written directly on the handler's get() method but it's here as part of the convention of\n * exposing proxy-\"inherited\"-methods\n */\n/**\n * get original target that is behind the proxy\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n */\nexport function getOriginalTarget(dataNode, objects) {\n\treturn objects.target;\n}\n\n/**\n * get 'objects' (which holds all related objects) of a proxy\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n */\nexport function getProxserveObjects(dataNode, objects) {\n\treturn objects;\n}\n\n/**\n * get the data-node of the proxy or sub-proxy\n * automatically filled param {Object} dataNode\n */\nexport function getProxserveDataNode(dataNode) {\n\treturn dataNode;\n}\n\n/**\n * get the Proxserve's instance that created this proxy\n */\nexport function getProxserveInstance() {\n\treturn this;\n}","/**\n * Copyright 2021 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { eventNames, nodeStatuses, proxyStatuses, ND, NID } from './global-vars.js';\nimport { property2path } from './supporting-functions.js';\n\n/**\n * process event and then bubble up and capture down the data tree\n * @param {Object} dataNode\n * @param {String} property\n * @param {*} oldValue\n * @param {Boolean} wasOldValueProxy\n * @param {*} value\n * @param {Boolean} isValueProxy\n */\nexport function initEmitEvent(dataNode, property, oldValue, wasOldValueProxy, value, isValueProxy) {\n\tif(oldValue === value/*no new change was made*/\n\t|| dataNode[ND].objects.status !== proxyStatuses.ALIVE/*altered a deleted or detached proxy*/) {\n\t\treturn;\n\t}\n\n\tlet changeType = eventNames.UPDATE;\n\tif(value === undefined) changeType = eventNames.DELETE;\n\telse if(oldValue === undefined) changeType = eventNames.CREATE;\n\n\tlet deferredEvents;\n\t//altering properties of an array that's in the middle of a splicing phase\n\tif(dataNode[NID].status === nodeStatuses.SPLICING) {\n\t\t//initiate (if needed) an object to hold side effect events\n\t\tif(!dataNode[ND].deferredEvents) dataNode[ND].deferredEvents = [];\n\t\t//save a reference to the deferredEvents\n\t\tdeferredEvents = dataNode[ND].deferredEvents;\n\t}\n\n\tlet path;\n\tif(dataNode[property]) { //changed a property which has its own data node on the tree\n\t\tdataNode = dataNode[property];\n\t\tpath = '';\n\t} else {\n\t\tpath = property2path(dataNode[ND].objects.target, property);\n\t}\n\n\tlet change = {\n\t\t'path': path, 'value': value, 'oldValue': oldValue, 'type': changeType\n\t};\n\n\tif(!deferredEvents) {\n\t\tbubbleEmit(dataNode, change);\n\t\n\t\tif(wasOldValueProxy || isValueProxy) { //old value or new value are proxy meaning they are objects with children\n\t\t\tcaptureEmit(dataNode, change);\n\t\t}\n\t}\n\telse {\n\t\tdeferredEvents.push({dataNode, change, shouldCapture: wasOldValueProxy || isValueProxy});\n\t}\n}\n\n/**\n * process special event for a built-in method and then bubble up the data tree\n * @param {Object} dataNode\n * @param {String} funcName - the method's name\n * @param {Object} funcArgs - the method's arguments\n * @param {*} oldValue\n * @param {*} value\n */\nexport function initFunctionEmitEvent(dataNode, funcName, funcArgs, oldValue, value) {\n\tlet change = {\n\t\t'path': '', 'value': value, 'oldValue': oldValue, 'type': funcName, 'args': funcArgs\n\t};\n\n\tbubbleEmit(dataNode, change);\n\n\tif(dataNode[ND].deferredEvents) {\n\t\tfor(let event of dataNode[ND].deferredEvents) {\n\t\t\tif(event.change.path === '') {\n\t\t\t\t//no path means its an event directly on the property, not on the parent.\n\t\t\t\t//i.e: not an event on \"arr\" with path \"0\", but on \"arr[0]\" with no path.\n\t\t\t\t//function event on \"arr\" already ran, but now a regular event on \"arr[0]\" is due\n\t\t\t\titerateAndEmit(event.dataNode[ND].listeners.shallow, event.dataNode[ND].objects.proxy, event.change);\n\t\t\t\titerateAndEmit(event.dataNode[ND].listeners.deep, event.dataNode[ND].objects.proxy, event.change);\n\t\t\t}\n\n\t\t\tif(event.shouldCapture) {\n\t\t\t\tcaptureEmit(event.dataNode, event.change);\n\t\t\t}\n\t\t}\n\t\tdelete dataNode[ND].deferredEvents;\n\t}\n\telse {\n\t\tconsole.warn(`no side effect events for ${funcName} were made`);\n\t}\n}\n\n/**\n * bubbling phase - go up the data tree and emit\n * @param {Object} dataNode\n * @param {Object} change\n * \t@property {String} change.path\n * \t@property {*} change.oldValue\n * \t@property {*} change.value\n * \t@property {String} change.type\n */\nfunction bubbleEmit(dataNode, change) {\n\tif(dataNode[NID].status === nodeStatuses.STOPPED) {\n\t\treturn; //not allowed to emit\n\t}\n\n\tif(change.path === '') { //iterate over 'shallow' listeners\n\t\titerateAndEmit(dataNode[ND].listeners.shallow, dataNode[ND].objects.proxy, change);\n\t}\n\n\t//iterate over 'deep' listeners\n\titerateAndEmit(dataNode[ND].listeners.deep, dataNode[ND].objects.proxy, change);\n\n\tif(!dataNode[ND].parentNode.isTreePrototype) { //we are not on root node yet\n\t\t//create a shallow copy of 'change' and update its path\n\t\t//(we don't want to alter the 'change' object just emitted to the listener)\n\t\tlet nextChange = {\n\t\t\t...change,\n\t\t\tpath: dataNode[ND].propertyPath + change.path\n\t\t};\n\t\tdataNode = dataNode[ND].parentNode;\n\t\tbubbleEmit(dataNode, nextChange);\n\t}\n}\n\n/**\n * capturing phase - go down the data tree and emit\n * @param {Object} dataNode\n * @param {Object} change\n * \t@property {String} change.path\n * \t@property {*} change.oldValue\n * \t@property {*} change.value\n * \t@property {String} change.type\n */\nfunction captureEmit(dataNode, change) {\n\tlet keys = Object.keys(dataNode);\n\tfor(let key of keys) {\n\t\tlet subValue = (typeof change.value === 'object' && change.value !== null) ? change.value[key] : undefined;\n\t\tlet subOldValue = (typeof change.oldValue === 'object' && change.oldValue !== null) ? change.oldValue[key] : undefined;\n\t\tif(subValue !== subOldValue) { //if not both undefined or same primitive or the same object\n\t\t\tlet changeType = eventNames.UPDATE;\n\t\t\tif(subValue === undefined) changeType = eventNames.DELETE;\n\t\t\telse if(subOldValue === undefined) changeType = eventNames.CREATE;\n\n\t\t\tlet subChange = {\n\t\t\t\tpath: '',\n\t\t\t\toldValue: subOldValue,\n\t\t\t\tvalue: subValue,\n\t\t\t\ttype: changeType\n\t\t\t}\n\n\t\t\t//failing the status check will not emit for current property (but sub-properties might still be forcibly active)\n\t\t\tif(dataNode[key][NID].status !== nodeStatuses.STOPPED) {\n\t\t\t\titerateAndEmit(dataNode[key][ND].listeners.shallow, dataNode[key][ND].objects.proxy, subChange);\n\t\t\t}\n\n\t\t\tcaptureEmit(dataNode[key], subChange);\n\t\t}\n\t}\n}\n\n/**\n * iterate over an array of listeners, handle 'once' listeners and emit\n * @param {Array} listenersArr \n * @param {*} thisValue \n * @param {Object} change \n */\nfunction iterateAndEmit(listenersArr, thisValue, change) {\n\tfor(let i = listenersArr.length - 1; i >= 0; i--) {\n\t\tlet listener = listenersArr[i];\n\t\tif(listener.type.includes(change.type)) {\n\t\t\tif(listener.once === true) {\n\t\t\t\tlistenersArr.splice(i, 1);\n\t\t\t}\n\t\t\tlistener.func.call(thisValue, change);\n\t\t}\n\t}\n}","/**\n * Copyright 2021 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n// Proxy methods are methods that will proxy JS built-in methods.\n// For examply, the proxy function for \"splice\" will handle some event stuff and then use\n// the actual \"splice\" function internally\n\"use strict\"\n\nimport { nodeStatuses, eventNames, NID } from './global-vars.js';\nimport { initFunctionEmitEvent } from './event-emitter.js';\n\n/**\n * a wrapper function for the 'splice' method\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n * @param {Number} start \n * @param {Number} deleteCount \n * @param  {...any} items \n */\nexport function splice(dataNode, objects, start, deleteCount, ...items) {\n\tif(dataNode[NID].status !== nodeStatuses.ACTIVE) {\n\t\treturn Array.prototype.splice.call(objects.proxy, start, deleteCount, ...items);\n\t}\n\n\tlet isActiveByInheritance = !dataNode[NID].hasOwnProperty('status');\n\tdataNode[NID].status = nodeStatuses.SPLICING;\n\tlet oldValue = objects.target.slice(0);\n\tlet deleted = Array.prototype.splice.call(objects.proxy, start, deleteCount, ...items); //creates many side-effect events\n\tlet args = { start, deleteCount, items };\n\t\n\tif(isActiveByInheritance) delete dataNode[NID].status;\n\telse dataNode[NID].status = nodeStatuses.ACTIVE;\n\n\tinitFunctionEmitEvent(dataNode, eventNames.SPLICE, args, oldValue, objects.target);\n\n\treturn deleted;\n}\n\n/**\n * a wrapper function for the 'shift' method\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n */\nexport function shift(dataNode, objects) {\n\tif(dataNode[NID].status !== nodeStatuses.ACTIVE) {\n\t\treturn Array.prototype.shift.call(objects.proxy);\n\t}\n\n\tlet isActiveByInheritance = !dataNode[NID].hasOwnProperty('status');\n\tdataNode[NID].status = nodeStatuses.SPLICING;\n\tlet oldValue = objects.target.slice(0);\n\tlet deleted = Array.prototype.shift.call(objects.proxy); //creates many side-effect events\n\t\n\tif(isActiveByInheritance) delete dataNode[NID].status;\n\telse dataNode[NID].status = nodeStatuses.ACTIVE;\n\n\tinitFunctionEmitEvent(dataNode, eventNames.SHIFT, {}, oldValue, objects.target);\n\n\treturn deleted;\n}\n\n/**\n * a wrapper function for the 'unshift' method\n * automatically filled param {Object} dataNode\n * automatically filled param {Object} objects\n * @param  {...any} items \n */\nexport function unshift(dataNode, objects, ...items) {\n\tif(dataNode[NID].status !== nodeStatuses.ACTIVE) {\n\t\treturn Array.prototype.shift.call(objects.proxy);\n\t}\n\n\tlet isActiveByInheritance = !dataNode[NID].hasOwnProperty('status');\n\tdataNode[NID].status = nodeStatuses.SPLICING;\n\tlet oldValue = objects.target.slice(0);\n\tlet newLength = Array.prototype.unshift.call(objects.proxy, ...items); //creates many side-effect events\n\tlet args = { items };\n\t\n\tif(isActiveByInheritance) delete dataNode[NID].status;\n\telse dataNode[NID].status = nodeStatuses.ACTIVE;\n\n\tinitFunctionEmitEvent(dataNode, eventNames.UNSHIFT, args, oldValue, objects.target);\n\n\treturn newLength;\n}\n","/**\n * Copyright 2021 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { proxyTypes, nodeStatuses, proxyStatuses } from './global-vars.js';\nimport { unproxify, createDataNode } from './supporting-functions.js';\nimport * as pseudoMethods from './pseudo-methods.js';\nimport * as proxyMethods from './proxy-methods.js';\nimport { realtypeof, splitPath, evalPath } from './general-functions.js';\nimport { initEmitEvent } from './event-emitter.js';\n\nlet ND = Symbol.for('proxserve_node_data'); //key for the data of a node\nlet NID = Symbol.for('proxserve_node_inherited_data'); //key for the inherited data of a node\n\n/**\n * save an array of all reserved function names\n * and also add synonyms to these functions\n */\nlet pseudoMethodsNames = Object.keys(pseudoMethods);\nfor(let i = pseudoMethodsNames.length - 1; i >= 0; i--) {\n\tlet name = pseudoMethodsNames[i];\n\tlet synonym = '$'+name;\n\tpseudoMethods[synonym] = pseudoMethods[name];\n\tpseudoMethodsNames.push(synonym);\n}\n\nclass Proxserve {\n\t/**\n\t * construct a new proxserve instance\n\t * @param {Object|Array} target \n\t * @param {Object} [options]\n\t * \t@property {Boolean} [options.strict] - should destroy detached child-objects or deleted properties automatically\n\t * \t@property {Boolean} [options.emitMethods] - should splice/shift/unshift emit one event or all CRUD events\n\t */\n\tconstructor(target, { strict=true, emitMethods=true, debug={} } = {}) {\n\t\tthis.strict = strict;\n\t\tthis.emitMethods = emitMethods;\n\t\tthis.destroyDelay = 1000;\n\n\t\tif(debug && debug.destroyDelay) this.destroyDelay = debug.destroyDelay;\n\n\t\tthis.dataTree = createDataNode({\n\t\t\t[NID]: {\n\t\t\t\tstatus: nodeStatuses.ACTIVE\n\t\t\t},\n\t\t\t[ND]: {\n\t\t\t\tobjects: { status: proxyStatuses.ALIVE }\n\t\t\t},\n\t\t\tisTreePrototype: true\n\t\t}, '');\n\t\tthis.dataTree[ND].path = '';\n\t\tthis.dataTree[ND].propertyPath = '';\n\t\tthis.dataTree[ND].objects.target = target;\n\n\t\treturn this.createProxy(this.dataTree);\n\t}\n\n\t/**\n\t * create a new proxy and a new node for a property of the parent's target-object\n\t * @param {Object} parentNode\n\t * @param {String} [targetProperty]\n\t */\n\tcreateProxy(parentNode, targetProperty) {\n\t\tlet dataNode;\n\n\t\tif(targetProperty === undefined) { //refering to own node and not a child property (meaning root object)\n\t\t\tdataNode = parentNode;\n\t\t}\n\t\telse {\n\t\t\tdataNode = createDataNode(parentNode, targetProperty); //either creates new or returns an existing one with cleaned properties\n\t\t\tdataNode[ND].objects.target = parentNode[ND].objects.target[ targetProperty ]; //assign said 'target' to the dataNode\n\t\t}\n\n\t\tlet objects = dataNode[ND].objects; //a new one for every iteration\n\t\tlet target = objects.target;\n\n\t\tlet typeoftarget = realtypeof(target);\n\n\t\tif(proxyTypes.includes(typeoftarget)) {\n\t\t\tlet revocable = Proxy.revocable(target, {\n\t\t\t\tget: (target/*same as parent scope 'target'*/, property, proxy) => {\n\t\t\t\t\tif(this.emitMethods && proxyMethods.hasOwnProperty(property) && property in Object.getPrototypeOf(target)) {\n\t\t\t\t\t\t//use a proxy method instead of the built-in method that is on the prototype chain\n\t\t\t\t\t\treturn proxyMethods[property].bind(this, dataNode, objects);\n\t\t\t\t\t}\n\t\t\t\t\telse if(pseudoMethodsNames.includes(property) && typeof target[property] === 'undefined') {\n\t\t\t\t\t\t//can access a pseudo function (or its synonym) if their keywords isn't used\n\t\t\t\t\t\treturn pseudoMethods[property].bind(this, dataNode, objects);\n\t\t\t\t\t}\n\t\t\t\t\telse if(!target.propertyIsEnumerable(property) || typeof property === 'symbol') {\n\t\t\t\t\t\treturn target[property]; //non-enumerable or non-path'able aren't proxied\n\t\t\t\t\t}\n\t\t\t\t\telse if(dataNode[property] //there's a child node\n\t\t\t\t\t\t\t&& dataNode[property][ND].objects.proxy //it holds a proxy\n\t\t\t\t\t\t\t&& dataNode[property][ND].objects.status === proxyStatuses.ALIVE) {\n\t\t\t\t\t\treturn dataNode[property][ND].objects.proxy;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn target[property];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\n\t\t\t\tset: (target/*same as parent scope 'target'*/, property, value, proxy) => { //'receiver' is proxy\n\t\t\t\t\t/**\n\t\t\t\t\t * property can be a regular object because of 3 possible reasons:\n\t\t\t\t\t * 1. proxy is deleted from tree but user keeps accessing it then it means he saved a reference\n\t\t\t\t\t * 2. it is a non-enumerable property which means it was intentionally hidden\n\t\t\t\t\t * 3. property is a symbol and symbols can't be proxied because we can't create a normal path for them.\n\t\t\t\t\t *    these properties are not proxied and should not emit change-event.\n\t\t\t\t\t *    except for: length\n\t\t\t\t\t * TODO - make a list of all possible properties exceptions (maybe function 'name'?)\n\t\t\t\t\t */\n\t\t\t\t\tif(dataNode[NID].status === nodeStatuses.BLOCKED) { //blocked from changing values\n\t\t\t\t\t\tconsole.error(`can't change value of property '${property}'. object is blocked.`);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(typeof property === 'symbol') {\n\t\t\t\t\t\ttarget[property] = value;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(property !== 'length' && !target.propertyIsEnumerable(property)) {\n\t\t\t\t\t\t//if setting a whole new property then it is non-enumerable (yet) so a further test is needed\n\t\t\t\t\t\tlet descriptor = Object.getOwnPropertyDescriptor(target, property);\n\t\t\t\t\t\tif(typeof descriptor === 'object' && descriptor.enumerable === false) { //property was previously set\n\t\t\t\t\t\t\ttarget[property] = value;\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet oldValue = target[property]; //should not be proxy\n\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\tif(dataNode[property] !== undefined && dataNode[property][ND].objects.proxy !== undefined) {\n\t\t\t\t\t\t//about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\tdataNode[property][ND].objects.status = proxyStatuses.DELETED;\n\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\tif(this.strict) {\n\t\t\t\t\t\t\t//postpone this cpu intense function for later, probably when proxserve is not in use\n\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, this.destroyDelay, dataNode[property][ND].objects.proxy); \n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = unproxify(value);\n\t\t\t\t\ttarget[property] = value; //assign new value\n\n\t\t\t\t\tlet isValueProxy = false;\n\t\t\t\t\tlet typeofvalue = realtypeof(value);\n\t\t\t\t\tif(proxyTypes.includes(typeofvalue)) {\n\t\t\t\t\t\tthis.createProxy(dataNode, property); //if trying to add a new value which is an object then make it a proxy\n\t\t\t\t\t\tisValueProxy = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, value, isValueProxy);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * TODO - this function is incomplete and doesn't handle all of 'descriptor' scenarios\n\t\t\t\t */\n\t\t\t\tdefineProperty: (target/*same as parent scope 'target'*/, property, descriptor) => {\n\t\t\t\t\tif(typeof property === 'symbol') {\n\t\t\t\t\t\tObject.defineProperty(target, property, descriptor);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet oldValue = target[property]; //should not be proxy\n\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\tif(dataNode[property] !== undefined && dataNode[property][ND].objects.proxy !== undefined) {\n\t\t\t\t\t\t//about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\tdataNode[property][ND].objects.status = proxyStatuses.DELETED;\n\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\tif(this.strict) {\n\t\t\t\t\t\t\t//postpone this cpu intense function for later, probably when proxserve is not is use\n\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, this.destroyDelay, dataNode[property][ND].objects.proxy);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdescriptor.value = unproxify(descriptor.value);\n\t\t\t\t\tObject.defineProperty(target, property, descriptor); //defining the new value\n\t\t\t\t\tlet value = descriptor.value;\n\t\t\t\t\tlet isValueProxy = false;\n\t\t\t\t\t//excluding non-enumerable properties from being proxied\n\t\t\t\t\tlet typeofvalue = realtypeof(descriptor.value);\n\t\t\t\t\tif(proxyTypes.includes(typeofvalue) && descriptor.enumerable === true) {\n\t\t\t\t\t\tthis.createProxy(dataNode, property); //if trying to add a new value which is an object then make it a proxy\n\t\t\t\t\t\tisValueProxy = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, value, isValueProxy);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\n\t\t\t\tdeleteProperty: (target/*same as parent scope 'target'*/, property) => {\n\t\t\t\t\tif(!target.propertyIsEnumerable(property) || typeof property === 'symbol') {\n\t\t\t\t\t\t//non-proxied properties simply get deleted and nothing more\n\t\t\t\t\t\tdelete target[property];\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(dataNode[NID].status === nodeStatuses.BLOCKED) { //blocked from changing values\n\t\t\t\t\t\tconsole.error(`can't delete property '${property}'. object is blocked.`);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(property in target) {\n\t\t\t\t\t\tlet oldValue = target[property]; //should not be proxy\n\t\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\t\tif(dataNode[property] !== undefined && dataNode[property][ND].objects.proxy !== undefined) {\n\t\t\t\t\t\t\t//about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\t\tdataNode[property][ND].objects.status = proxyStatuses.DELETED;\n\t\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\t\tif(this.strict) {\n\t\t\t\t\t\t\t\t//postpone this cpu intense function for later, probably when proxserve is not is use\n\t\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, this.destroyDelay, dataNode[property][ND].objects.proxy);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelete target[property]; //actual delete\n\n\t\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, undefined, false);\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn true; //do nothing because there's nothing to delete\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdataNode[ND].objects.proxy = revocable.proxy;\n\t\t\tdataNode[ND].objects.revoke = revocable.revoke;\n\n\t\t\tif(typeoftarget === 'Object') {\n\t\t\t\tlet keys = Object.keys(target);\n\t\t\t\tfor(let key of keys) {\n\t\t\t\t\tlet typeofproperty = realtypeof(target[key]);\n\t\t\t\t\tif(proxyTypes.includes(typeofproperty)) {\n\t\t\t\t\t\tthis.createProxy(dataNode, key); //recursively make child objects also proxies\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(typeoftarget === 'Array') {\n\t\t\t\tfor(let i = 0; i < target.length; i++) {\n\t\t\t\t\tlet typeofproperty = realtypeof(target[i]);\n\t\t\t\t\tif(proxyTypes.includes(typeofproperty)) {\n\t\t\t\t\t\tthis.createProxy(dataNode, i); //recursively make child objects also proxies\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.warn('Not Implemented');\n\t\t\t}\n\n\t\t\treturn revocable.proxy;\n\t\t}\n\t\telse {\n\t\t\tthrow new Error('Must observe an '+proxyTypes.join('/'));\n\t\t}\n\t}\n\n\t/**\n\t * Recursively revoke proxies, allowing them to be garbage collected.\n\t * this functions delays 1000 milliseconds to let time for all events to finish\n\t * @param {*} proxy \n\t */\n\tstatic destroy(proxy) {\n\t\tlet dataNode, objects;\n\t\ttry {\n\t\t\tdataNode = proxy.$getProxserveDataNode();\n\t\t\tobjects = proxy.$getProxserveObjects();\n\t\t} catch(error) {\n\t\t\treturn; //proxy variable isn't a proxy\n\t\t}\n\n\t\tif(objects.status === proxyStatuses.ALIVE) {\n\t\t\tobjects.status = proxyStatuses.DELETED;\n\t\t}\n\n\t\tlet typeofproxy = realtypeof(proxy);\n\n\t\tif(proxyTypes.includes(typeofproxy)) {\n\t\t\tlet keys = Object.keys(proxy); //handles both Objects and Arrays\n\t\t\tfor(let key of keys) {\n\t\t\t\ttry {\n\t\t\t\t\tlet typeofproperty = realtypeof(proxy[key]);\n\t\t\t\t\tif(proxyTypes.includes(typeofproperty)) {\n\t\t\t\t\t\tProxserve.destroy(dataNode[key][ND].objects.proxy);\n\t\t\t\t\t}\n\t\t\t\t} catch(error) {\n\t\t\t\t\tconsole.error(error); //don't throw and kill the whole process just if this iteration fails\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tobjects.revoke();\n\t\t\tobjects.proxy = undefined;\n\t\t\tobjects.status = proxyStatuses.REVOKED;\n\t\t}\n\t\telse {\n\t\t\tconsole.warn(`Type of \"${typeofproxy}\" is not implemented`);\n\t\t}\n\t}\n\n\tstatic splitPath(path) {\n\t\treturn splitPath(path);\n\t}\n\n\tstatic evalPath(obj, path) {\n\t\treturn evalPath(obj, path);\n\t}\n}\n\nmodule.exports = exports = Proxserve; //makes ParcelJS expose this globally (for all platforms) after bundling everything"]}