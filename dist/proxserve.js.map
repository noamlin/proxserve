{"version":3,"file":"proxserve.js","sources":["../src/globals.ts","../src/general-functions.ts","../src/pseudo-methods.ts","../src/supporting-functions.ts","../src/event-emitter.ts","../src/proxy-methods.ts","../src/constants.ts","../src/index.ts"],"sourcesContent":["/**\n * 2023 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nexport const ND = Symbol.for('proxserve_node_data'); // key for the data of a node\nexport const NID = Symbol.for('proxserve_node_inherited_data'); // key for the inherited data of a node\n\n// acceptable types to be proxied\nexport const proxyTypes = {\n\t\"Object\": true,\n\t\"Array\": true,\n};\n\n// statuses of data-nodes\nexport enum NODE_STATUSES {\n\tactive = 'active',\n\tstopped = 'stopped',\n\tblocked = 'blocked',\n\tsplicing = 'splicing',\n};\n\n// statuses of proxies\nexport enum PROXY_STATUSES {\n\talive = 'alive',\n\tdeleted = 'deleted',\n\trevoked = 'revoked',\n};\n\n// event names that can be emitted\nexport enum EVENTS {\n\tcreate = 'create',\n\tupdate = 'update',\n\tdelete = 'delete',\n\tsplice = 'splice',\n\tshift = 'shift',\n\tunshift = 'unshift',\n};","/**\n * 2023 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { SomeObject, SomeArray, VariableTypes } from './types/globals';\n\n/**\n * return a string representing the full type of the variable\n */\nexport function realtypeof(variable: any): VariableTypes {\n\tlet rawType = Object.prototype.toString.call(variable); //[object Object], [object Array], [object Number]...\n\treturn rawType.substring(8, rawType.length - 1) as VariableTypes;\n}\n\n/**\n * check if variable is a number or a string of a number\n * @param variable \n */\n/*export function isNumeric(variable: any): boolean {\n\tif(typeof variable === 'string' && variable === '') {\n\t\treturn false;\n\t}\n\t\n\treturn !isNaN(variable as number);\n}*/\n\n/**\n * recursively clones objects and array\n */\nconst simpleCloneSet = new WeakSet();\nexport function simpleClone(variable: any): any {\n\tlet typeofvar = realtypeof(variable);\n\n\tif(typeofvar === 'Object') {\n\t\tconst obj = variable as SomeObject;\n\t\tsimpleCloneSet.add(obj);\n\t\tconst cloned = {};\n\t\tlet keys = Object.keys(obj);\n\t\tfor(let key of keys) {\n\t\t\tif(simpleCloneSet.has(obj[key])) {\n\t\t\t\tcloned[key] = obj[key];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloned[key] = simpleClone(obj[key]);\n\t\t\t}\n\t\t}\n\t\treturn cloned;\n\t}\n\telse if(typeofvar === 'Array') {\n\t\tconst arr = variable as SomeArray;\n\t\tsimpleCloneSet.add(arr);\n\t\tconst cloned = [] as any[];\n\t\tfor(let i = 0; i < arr.length; i++) {\n\t\t\tif(simpleCloneSet.has(arr[i])) {\n\t\t\t\tcloned[i] = arr[i];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloned[i] = simpleClone(arr[i]);\n\t\t\t}\n\t\t}\n\t\treturn cloned;\n\t}\n\telse { // hopefully a primitive\n\t\tif(typeofvar !== 'Undefined' && typeofvar !== 'Null' && typeofvar !== 'Boolean' && typeofvar !== 'Number'\n\t\t&& typeofvar !== 'BigInt' && typeofvar !== 'String') {\n\t\t\tconsole.warn(`Can't clone a variable of type ${typeofvar}`);\n\t\t}\n\t\treturn variable;\n\t}\n}\n\n/**\n * splits a path to an array of properties\n * (benchmarked and is faster than regex and split())\n * @param path \n */\nexport function splitPath(path: string): Array<string|number> {\n\tif(typeof path !== 'string' || path === '') {\n\t\treturn [];\n\t}\n\t\n\tlet i = 0, betweenBrackets = false, onlyDigits = false;\n\t//loop will skip over openning '.' or '['\n\tif(path[0] === '.') {\n\t\ti = 1;\n\t} else if(path[0] === '[') {\n\t\ti = 1;\n\t\tbetweenBrackets = true;\n\t\tonlyDigits = true;\n\t}\n\n\tlet resultsArr = [] as Array<string|number>;\n\tlet tmp = '';\n\tfor(; i < path.length; i++) {\n\t\tlet char = path[i];\n\n\t\tif(betweenBrackets) {\n\t\t\tif(char === ']') {\n\t\t\t\tif(onlyDigits) {\n\t\t\t\t\tresultsArr.push(parseInt(tmp, 10));\n\t\t\t\t} else {\n\t\t\t\t\tresultsArr.push(tmp);\n\t\t\t\t}\n\n\t\t\t\tbetweenBrackets = false;\n\t\t\t\tonlyDigits = false;\n\t\t\t\ttmp = '';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(onlyDigits) {\n\t\t\t\t\tlet code = char.charCodeAt(0);\n\t\t\t\t\tif(code < 48 || code > 57) { //less than '0' char or greater than '9' char\n\t\t\t\t\t\tonlyDigits = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttmp += char;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif(char === '[') {\n\t\t\t\tbetweenBrackets = true;\n\t\t\t\tonlyDigits = true;\n\t\t\t}\n\t\t\t\n\t\t\t//check if starting a new property but avoid special case of [prop][prop]\n\t\t\tif(char === '.' || char === '[') {\n\t\t\t\tif(tmp !== '') {\n\t\t\t\t\tresultsArr.push(tmp);\n\t\t\t\t\ttmp = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttmp += char;\n\t\t\t}\n\t\t}\n\t}\n\tif(tmp !== '') {\n\t\tresultsArr.push(tmp);\n\t}\n\treturn resultsArr;\n}\n\n/**\n * evaluate a long path and return the designated object and its referred property\n */\nexport function evalPath(obj: SomeObject, path: string): {\n\tobject: SomeObject,\n\tproperty: string | number,\n\tvalue: any,\n} {\n\tif(path === '') {\n\t\treturn {\n\t\t\tobject: obj,\n\t\t\tproperty: '',\n\t\t\tvalue: obj,\n\t\t};\n\t}\n\n\tlet segments = splitPath(path);\n\tlet i: number;\n\tfor(i = 0; i <= segments.length - 2; i++) { // iterate until one before last property because they all must exist\n\t\tobj = obj[segments[i]];\n\t\tif(typeof obj === 'undefined') {\n\t\t\tthrow new Error(`Invalid path was given - \"${path}\"`);\n\t\t}\n\t}\n\treturn {\n\t\tobject: obj,\n\t\tproperty: segments[i],\n\t\tvalue: obj[ segments[i] ],\n\t};\n}","/**\n * 2023 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n// Pseudo methods are methods that aren't really on the object - not as a property nor via its prototype\n// thus they will not be retrieved via \"for..in\" and etcetera. Their property name is actually undefined, but\n// calling it will return the method via the JS proxy's \"get\" handler.\n// (i.e. someProxserve.pseudoFunction will return the pseudoFunction)\n\"use strict\"\n\nimport { EVENTS, NODE_STATUSES, ND, NID } from './globals';\nimport type { ListenerData, EVENT_NAMES } from './types/globals';\nimport type { PseudoThis } from './types/proxserve-class';\nimport type {\n\tStopFunction, BlockFunction, ActivateFunction,\n\tOnFunction, OnceFunction,\n\tRemoveListenerFunction, RemoveAllListenersFunction,\n\tGetProxserveNameFunction, WhoAMI,\n\tGetOriginalTargetFunction, GetProxserveNodesFunction,\n} from './types/pseudo-methods';\nimport { createNodes } from './supporting-functions';\nimport { splitPath } from './general-functions';\n\nexport const stop: StopFunction = function stop(this: PseudoThis) {\n\tthis.dataNode[NID].status = NODE_STATUSES.stopped;\n};\n\nexport const block: BlockFunction = function block(this: PseudoThis) {\n\tthis.dataNode[NID].status = NODE_STATUSES.blocked;\n};\n\nexport const activate: ActivateFunction = function activate(this: PseudoThis, force = false): void {\n\tif(force || this.dataNode === this.metadata.dataTree) { // force activation or we are on root proxy\n\t\tthis.dataNode[NID].status = NODE_STATUSES.active;\n\t}\n\telse {\n\t\tdelete this.dataNode[NID].status;\n\t}\n};\n\nexport const on: OnFunction = function on(this: PseudoThis, args) {\n\tconst {\n\t\tpath = '',\n\t\tlistener,\n\t\tid,\n\t\tdeep = false,\n\t\tonce = false,\n\t} = args;\n\t// its nicer to expose `event` to the user,\n\t// but since it is semi-reserved word, we internally rename it to `events`\n\tlet { event: events } = args;\n\n\tif(events === 'change') {\n\t\tevents = Object.keys(EVENTS) as EVENT_NAMES[]; // will listen to all events\n\t} else if(!Array.isArray(events)) {\n\t\tevents = [events];\n\t}\n\n\tfor(let event of events) {\n\t\tif(!EVENTS[event]) {\n\t\t\tconst names = Object.keys(EVENTS);\n\t\t\tthrow new Error(`${event} is not a valid event. valid events are ${names.join(',')}`);\n\t\t}\n\t}\n\t\n\tlet dataNode = this.dataNode;\n\tlet segments = splitPath(path);\n\tfor(let property of segments) { // traverse down the tree\n\t\tif(!dataNode[property]) {\n\t\t\t// create data-nodes if needed (in dataNode[property]), but don't create/overwrite proxy-nodes\n\t\t\tcreateNodes(dataNode, property);\n\t\t}\n\n\t\tdataNode = dataNode[property];\n\t}\n\n\tlet listenersPool = dataNode[ND].listeners.shallow;\n\tif(deep) {\n\t\tlistenersPool = dataNode[ND].listeners.deep;\n\t}\n\n\tlet listenerObj = {\n\t\ttype: events,\n\t\tonce,\n\t\tfunc: listener\n\t} as ListenerData;\n\n\tif(id !== undefined) {\n\t\tlistenerObj.id = id;\n\t}\n\tlistenersPool.push(listenerObj);\n};\n\nexport const once: OnceFunction = function once(this: PseudoThis, args) {\n\targs.once = true;\n\ton.call(this, args);\n};\n\nfunction removeById(listenersArr: ListenerData[], id: string | number | Function): void {\n\tfor(let i = listenersArr.length - 1; i >= 0; i--) {\n\t\tlet listenerObj = listenersArr[i];\n\t\tif((id !== undefined && listenerObj.id === id) || listenerObj.func === id) {\n\t\t\tlistenersArr.splice(i, 1);\n\t\t}\n\t}\n}\n\nexport const removeListener: RemoveListenerFunction = function removeListener(this: PseudoThis, args) {\n\tconst { id, path = '' } = args;\n\tconst fullPath = `${this.dataNode[ND].path}${path}`;\n\tlet dataNode = this.dataNode;\n\tconst segments = splitPath(path);\n\n\t// traverse down the tree\n\tfor(let property of segments) {\n\t\tif(!dataNode[property]) {\n\t\t\tconsole.warn(`can't remove listener from a non-existent path '${fullPath}'`);\n\t\t\treturn;\n\t\t}\n\t\tdataNode = dataNode[property];\n\t}\n\n\tremoveById(dataNode[ND].listeners.shallow, id);\n\tremoveById(dataNode[ND].listeners.deep, id);\n};\n\nexport const removeAllListeners: RemoveAllListenersFunction = function removeAllListeners(this: PseudoThis, path = '') {\n\tconst fullPath = `${this.dataNode[ND].path}${path}`;\n\tconst segments = splitPath(path);\n\tlet dataNode = this.dataNode;\n\n\t//traverse down the tree\n\tfor(let property of segments) {\n\t\tif(!dataNode[property]) {\n\t\t\tconsole.warn(`can't remove all listeners from a non-existent path '${fullPath}'`);\n\t\t\treturn;\n\t\t}\n\t\tdataNode = dataNode[property];\n\t}\n\n\tdataNode[ND].listeners.shallow = [] as ListenerData[];\n\tdataNode[ND].listeners.deep = [] as ListenerData[];\n};\n\nexport const getOriginalTarget: GetOriginalTargetFunction = function getOriginalTarget(this: PseudoThis) {\n\treturn this.proxyNode[ND].target;\n};\n\nexport const getProxserveName: GetProxserveNameFunction = function getProxserveName(this: PseudoThis) {\n\treturn this.dataNode[NID].name;\n};\n\nexport const whoami: WhoAMI = function whoami(this: PseudoThis) {\n\treturn this.dataNode[NID].name + this.dataNode[ND].path;\n};\n\nexport const getProxserveNodes: GetProxserveNodesFunction = function getProxserveNodes(this: PseudoThis) {\n\treturn { dataNode: this.dataNode, proxyNode: this.proxyNode };\n};","/**\n * 2023 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { proxyTypes, ND, NID, EVENTS } from './globals';\nimport type { TargetVariable, ListenerData, ChangeEvent } from './types/globals';\nimport type { DataNode, ProxyNode, ProxserveInstanceMetadata, PseudoThis } from './types/proxserve-class';\nimport { realtypeof } from './general-functions';\nimport { whoami } from './pseudo-methods';\n\n/**\n * Convert property name to valid path segment\n */\nexport function property2path(obj: any, property: string|number): string {\n\tif(typeof property === 'symbol') {\n\t\tthrow new Error(`property of type \"symbol\" isn't path'able`);\n\t}\n\n\tconst typeofobj = realtypeof(obj);\n\tswitch(typeofobj) {\n\t\tcase 'Object': {\n\t\t\treturn `.${property}`;\n\t\t}\n\t\tcase 'Array': {\n\t\t\treturn `[${property}]`;\n\t\t}\n\t\tdefault: {\n\t\t\tconsole.warn(`Not Implemented (type of '${typeofobj}')`);\n\t\t\treturn property as string;\n\t\t}\n\t}\n}\n\n/**\n * recursively switch between all proxies to their original targets.\n * note: original targets should never hold proxies under them,\n * thus altering the object references (getting from 'value') should be ok.\n * if whoever uses this library decides to\n * \t1. create a proxy with children (sub-proxies)\n * \t2. create a regular object\n * \t3. adding sub-proxies to the regular object\n * \t4. attaching the regular object to the proxy\n * then this regular object will be altered.\n */\nexport function unproxify(value: any): any {\n\tconst typeofvalue = realtypeof(value);\n\n\tif(proxyTypes[typeofvalue]) {\n\t\tlet target = value;\n\t\ttry {\n\t\t\ttarget = value.$getOriginalTarget();\n\t\t} catch(error) {}\n\n\t\tswitch(typeofvalue) {\n\t\t\tcase 'Object':\n\t\t\t\tlet keys = Object.keys(target);\n\t\t\t\tfor(let key of keys) {\n\t\t\t\t\ttarget[key] = unproxify(target[key]); // maybe alters target and maybe returning the exact same object\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Array':\n\t\t\t\tfor(let i=0; i < target.length; i++) {\n\t\t\t\t\ttarget[i] = unproxify(target[i]); // maybe alters target and maybe returning the exact same object\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(`Not Implemented (type of '${typeofvalue}')`);\n\t\t}\n\n\t\treturn target;\n\t}\n\telse {\n\t\treturn value; // primitive\n\t}\n}\n\n/**\n * create or reset a node in a tree of meta-data (mainly path related)\n * and optionally create a node in a tree of proxy data (mainly objects related)\n */\nexport function createNodes(\n\tparentDataNode: DataNode,\n\tproperty: string | number,\n\tparentProxyNode?: ProxyNode,\n\ttarget?: TargetVariable,\n): { dataNode: DataNode, proxyNode: ProxyNode | undefined } {\n\t//handle property path\n\tlet propertyPath: string;\n\tif(parentProxyNode?.[ND].target) {\n\t\tpropertyPath = property2path(parentProxyNode[ND].target, property);\n\t} else {\n\t\tpropertyPath = property2path({}, property); // if parent doesn't have target then treat it as object\n\t}\n\t\n\t//handle data node\n\tlet dataNode: DataNode = parentDataNode[property]; // try to receive existing data-node\n\tif(!dataNode) {\n\t\tdataNode = {\n\t\t\t[NID]: Object.create(parentDataNode[NID]),\n\t\t\t[ND]: {\n\t\t\t\tparentNode: parentDataNode,\n\t\t\t\tlisteners: {\n\t\t\t\t\tshallow: [] as ListenerData[],\n\t\t\t\t\tdeep: [] as ListenerData[],\n\t\t\t\t},\n\t\t\t}\n\t\t} as DataNode;\n\t\tparentDataNode[property] = dataNode;\n\t}\n\n\tdelete dataNode[NID].status; // clears old status in case a node previously existed\n\t// updates path (for rare case where parent was array and then changed to object or vice versa)\n\tif(!parentDataNode[ND].isTreePrototype) {\n\t\tObject.assign(dataNode[ND], {\n\t\t\tpath: parentDataNode[ND].path + propertyPath,\n\t\t\tpropertyPath\n\t\t});\n\t}\n\telse {\n\t\tObject.assign(dataNode[ND], {\n\t\t\tpath: '',\n\t\t\tpropertyPath: ''\n\t\t});\n\t}\n\n\t// handle proxy node\n\tlet proxyNode: ProxyNode | undefined;\n\tif(parentProxyNode) {\n\t\tproxyNode = {\n\t\t\t[NID]: Object.create(parentProxyNode[NID]),\n\t\t\t[ND]: {\n\t\t\t\ttarget: target as TargetVariable,\n\t\t\t\tdataNode,\n\t\t\t},\n\t\t};\n\n\t\tparentProxyNode[property] = proxyNode;\n\n\t\t// attach nodes to each other\n\t\tdataNode[ND].proxyNode = proxyNode;\n\t} else {\n\t\t// this scenario is dangerous and exists only for `on()` of future variables (paths) that don't yet exist\n\t\tproxyNode = undefined;\n\t}\n\n\treturn { dataNode, proxyNode };\n}\n\nlet noStackFlag = false;\nexport function stackTraceLog(\n\tdataNode: DataNode,\n\tchange: ChangeEvent,\n\tlogLevel?: ProxserveInstanceMetadata['trace'],\n) {\n\tif (logLevel !== 'normal' && logLevel !== 'verbose') {\n\t\treturn;\n\t}\n\n\tconst err = new Error();\n\tconst stack = err.stack;\n\t\n\tif (!stack) {\n\t\tif (!noStackFlag) {\n\t\t\t// log this only once. no need to spam.\n\t\t\tconsole.error('Can\\'t log stack trace of proxserve. browser/runtime doesn\\'t support Error.stack');\n\t\t\tnoStackFlag = true;\n\t\t}\n\t\treturn;\n\t}\n\n\t// break stack to individual lines. each line will point to a file and function.\n\tconst functionsTrace = stack.split('\\n').map((value) => {\n\t\treturn value.trim();\n\t});\n\t// remove first and useless Error line.\n\tif (functionsTrace[0].toLowerCase().indexOf('error') === 0) {\n\t\tfunctionsTrace.shift();\n\t}\n\t// delete this function's own line.\n\tfunctionsTrace.shift();\n\t// delete `initEmitEvent` line - overwrite it with a title.\n\tfunctionsTrace[0] = 'Stack Trace:';\n\n\t// log the message header.\n\tconst pathname = whoami.call({ dataNode } as PseudoThis) + change.path;\n\tlet verb = change.type;\n\tif (change.type === EVENTS.shift || change.type === EVENTS.unshift) {\n\t\tverb += 'ed';\n\t} else {\n\t\tverb += 'd';\n\t}\n\n\tconsole.log(\n\t\t'%c                                                                ',\n\t\t'border-bottom: 1px solid #008;',\n\t);\n\tconsole.log(\n\t\t`%c${pathname} %chas been ${verb}:`,\n\t\t'font-weight: bold; color: #008;',\n\t\t'color: #000;',\n\t);\n\n\t// verbose message with assigned values\n\tif (logLevel === 'verbose') {\n\t\tif (change.type === 'splice' || change.type === 'unshift') {\n\t\t\tconsole.log(\n\t\t\t\t`%cArguments of ${change.type}:`,\n\t\t\t\t'color: #555; font-style: italic;',\n\t\t\t);\n\t\t\tconsole.log(change.args);\n\t\t}\n\n\t\tconsole.log(\n\t\t\t'%cOld value was:',\n\t\t\t'color: #555; font-style: italic;',\n\t\t);\n\t\tconsole.log(change.oldValue);\n\t\tconsole.log(\n\t\t\t'%cNew value is:',\n\t\t\t'color: #555; font-style: italic;',\n\t\t);\n\t\tconsole.log(change.value);\n\t}\n\n\t// the files and lines list message\n\tconsole.log(\n\t\t`%c${functionsTrace.join('\\n')}`,\n\t\t'color: #999;',\n\t);\n\tconsole.log(\n\t\t'%c                                                                ',\n\t\t'border-top: 1px solid #008;',\n\t);\n}\n","/**\n * 2023 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { EVENTS, NODE_STATUSES, PROXY_STATUSES, ND, NID } from './globals';\nimport type { EVENT_NAMES, ChangeEvent, DeferredEvent, ListenerData } from './types/globals';\nimport type { DataNode, ProxserveInstanceMetadata } from './types/proxserve-class';\nimport { property2path, stackTraceLog } from './supporting-functions';\nimport { splitPath } from './general-functions';\n\n/**\n * try to get the proxy-object from a data-node. if can't then from it's parent's proxy\n * @param dataNode \n * @param property - the property as the dataNode is assigned on its parent\n */\nfunction getProxyValue(dataNode: DataNode, property?: string): any {\n\tif(dataNode[ND].proxyNode && dataNode[ND].proxyNode[NID].status === PROXY_STATUSES.alive) {\n\t\treturn dataNode[ND].proxyNode[ND].proxy; // actual proxy of child node\n\t}\n\telse {\n\t\tif(!property) {\n\t\t\t// my property on the parent\n\t\t\tproperty = splitPath(dataNode[ND].propertyPath)[0] as string;\n\t\t}\n\n\t\tlet parentNode = dataNode[ND].parentNode;\n\n\t\tif(parentNode[ND].proxyNode && parentNode[ND].proxyNode[NID].status === PROXY_STATUSES.alive) {\n\t\t\treturn parentNode[ND].proxyNode[ND].proxy?.[property]; // proxy or primitive via parent's proxy object\n\t\t}\n\t\telse {\n\t\t\t// if we reached here then probably we are on a capture phase of a deep deletion.\n\t\t\t// for example 'obj.sub1.sub2' gets 'delete obj.sub1' so now there are no values for 'sub2' nor its parent 'sub1'.\n\t\t\t// the warning is turned off because this situation seems okay\n\t\t\t// console.warn(`reached a capture level where neither child not parent proxy-nodes exist`);\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\n/**\n * process event and then bubble up and capture down the data tree\n */\nexport function initEmitEvent(\n\tdataNode: DataNode,\n\tproperty: string,\n\toldValue: any,\n\twasOldValueProxy: boolean,\n\tvalue: any,\n\tisValueProxy: boolean,\n\ttrace?: ProxserveInstanceMetadata['trace'],\n) {\n\tif(oldValue === value // no new change was made\n\t|| !dataNode[ND].proxyNode) { // proxy-node is detached from data-node\n\t\treturn;\n\t}\n\n\tlet proxyNode = dataNode[ND].proxyNode;\n\tif(proxyNode[NID].status !== PROXY_STATUSES.alive) { // altered a deleted proxy\n\t\treturn;\n\t}\n\n\tlet changeType = EVENTS.update;\n\tif(value === undefined) {\n\t\tchangeType = EVENTS.delete;\n\t} else if(oldValue === undefined) {\n\t\tchangeType = EVENTS.create;\n\t}\n\n\tlet deferredEvents: DeferredEvent[] | undefined;\n\t// altering properties of an array that's in the middle of a splicing phase\n\tif(dataNode[NID].status === NODE_STATUSES.splicing) {\n\t\t// initiate (if needed) an object to hold side effect events\n\t\tif(!dataNode[ND].deferredEvents) {\n\t\t\tdataNode[ND].deferredEvents = [];\n\t\t}\n\t\t// save a reference to the deferredEvents\n\t\tdeferredEvents = dataNode[ND].deferredEvents;\n\t}\n\n\tlet path: string;\n\tif(dataNode[property]) { // changed a property which has its own data node on the tree\n\t\tdataNode = dataNode[property];\n\t\tpath = '';\n\t} else {\n\t\tpath = property2path(proxyNode[ND].target, property);\n\t}\n\n\tlet change: ChangeEvent = {\n\t\tpath, value, oldValue, type: changeType,\n\t};\n\n\tif(!deferredEvents) {\n\t\t// (try to) log before emitting the event\n\t\tstackTraceLog(dataNode, change, trace);\n\n\t\tbubbleEmit(dataNode, change, property);\n\t\n\t\tif(wasOldValueProxy || isValueProxy) { // old value or new value are proxy meaning they are objects with children\n\t\t\tcaptureEmit(dataNode, change);\n\t\t}\n\t}\n\telse {\n\t\tdeferredEvents.push({dataNode, change, shouldCapture: wasOldValueProxy || isValueProxy});\n\t}\n}\n\n/**\n * bubbling phase - go up the data tree and emit\n * @param dataNode\n * @param change\n * @param property - property name of the data-node (i.e. as the data-node is assigned to its parent)\n */\nfunction bubbleEmit(dataNode: DataNode, change: ChangeEvent, property?: string): void {\n\tif(dataNode[NID].status === NODE_STATUSES.stopped) {\n\t\treturn; // not allowed to emit\n\t}\n\n\tlet thisValue = getProxyValue(dataNode, property);\n\n\tif(change.path === '') { // iterate over 'shallow' listeners\n\t\titerateAndEmit(dataNode[ND].listeners.shallow, thisValue, change);\n\t}\n\n\t// iterate over 'deep' listeners\n\titerateAndEmit(dataNode[ND].listeners.deep, thisValue, change);\n\n\tif(!dataNode[ND].parentNode[ND].isTreePrototype) { // we are not on root node yet\n\t\t// create a shallow copy of 'change' and update its path\n\t\t// (we don't want to alter the 'change' object that was just emitted to a listener)\n\t\tlet nextChange: ChangeEvent = {\n\t\t\t...change,\n\t\t\tpath: dataNode[ND].propertyPath + change.path\n\t\t};\n\n\t\tbubbleEmit(dataNode[ND].parentNode, nextChange);\n\t}\n}\n\n/**\n * capturing phase - go down the data tree and emit\n * @param dataNode\n * @param change\n */\nfunction captureEmit(dataNode: DataNode, change: ChangeEvent): void {\n\tlet keys = Object.keys(dataNode);\n\tfor(let key of keys) {\n\t\tlet subValue = (typeof change.value === 'object' && change.value !== null) ? change.value[key] : undefined;\n\t\tlet subOldValue = (typeof change.oldValue === 'object' && change.oldValue !== null) ? change.oldValue[key] : undefined;\n\t\tif(subValue !== subOldValue) { //if not both undefined or same primitive or the same object\n\t\t\tlet changeType = EVENTS.update;\n\t\t\tif(subValue === undefined) {\n\t\t\t\tchangeType = EVENTS.delete;\n\t\t\t} else if(subOldValue === undefined) {\n\t\t\t\tchangeType = EVENTS.create;\n\t\t\t}\n\n\t\t\tlet subChange: ChangeEvent = {\n\t\t\t\tpath: '',\n\t\t\t\toldValue: subOldValue,\n\t\t\t\tvalue: subValue,\n\t\t\t\ttype: changeType\n\t\t\t}\n\n\t\t\t// failing the status check will not emit for current property (but sub-properties might still be forcibly active)\n\t\t\tlet childNode = dataNode[key];\n\t\t\tif(childNode[NID].status !== NODE_STATUSES.stopped) {\n\t\t\t\tlet thisValue = getProxyValue(childNode, key);\n\t\t\t\titerateAndEmit(childNode[ND].listeners.shallow, thisValue, subChange);\n\t\t\t}\n\n\t\t\tcaptureEmit(childNode, subChange);\n\t\t}\n\t}\n}\n\n/**\n * iterate over an array of listeners, handle 'once' listeners and emit\n * @param listenersArr \n * @param thisValue \n * @param change \n */\nfunction iterateAndEmit(listenersArr: ListenerData[], thisValue: any, change: ChangeEvent): void {\n\tfor(let i = listenersArr.length - 1; i >= 0; i--) {\n\t\tlet listener = listenersArr[i];\n\t\tif(listener.type.includes(change.type)) {\n\t\t\tif(listener.once === true) {\n\t\t\t\tlistenersArr.splice(i, 1);\n\t\t\t}\n\t\t\tlistener.func.call(thisValue, change);\n\t\t}\n\t}\n}\n\n/**\n * process special event for a built-in method and then bubble up the data tree\n * @param dataNode\n * @param funcName - the method's name\n * @param funcArgs - the method's arguments\n * @param oldValue\n * @param value\n */\nexport function initFunctionEmitEvent(\n\tdataNode: DataNode,\n\tfuncName: EVENT_NAMES,\n\tfuncArgs: ChangeEvent['args'],\n\toldValue: any,\n\tvalue: any,\n\ttrace?: ProxserveInstanceMetadata['trace'],\n) {\n\tlet change: ChangeEvent = {\n\t\tpath: '', value, oldValue, type: funcName, args: funcArgs,\n\t};\n\n\t// (try to) log before emitting the event\n\tstackTraceLog(dataNode, change, trace);\n\n\tbubbleEmit(dataNode, change);\n\n\tif(dataNode[ND].deferredEvents) {\n\t\t// manually handle the side-effect events that were caught\n\t\t// in order to not bubble up, but should capture down\n\t\tfor(let event of dataNode[ND].deferredEvents!) {\n\t\t\tif(event.change.path === '') {\n\t\t\t\t// no path means its an event directly on the property, not on the parent.\n\t\t\t\t// i.e: not an event with path \"0\" on \".arr\", but an event with no path on \".arr[0]\".\n\t\t\t\t// function event on \"arr\" already ran, but now a regular event on \"arr[0]\" is due\n\t\t\t\tlet thisValue = getProxyValue(event.dataNode);\n\t\t\t\titerateAndEmit(event.dataNode[ND].listeners.shallow, thisValue, event.change);\n\t\t\t\titerateAndEmit(event.dataNode[ND].listeners.deep, thisValue, event.change);\n\t\t\t}\n\n\t\t\tif(event.shouldCapture) {\n\t\t\t\tcaptureEmit(event.dataNode, event.change);\n\t\t\t}\n\t\t}\n\t\tdelete dataNode[ND].deferredEvents;\n\t}\n\telse {\n\t\tconsole.warn(`no side effect events for ${funcName} were made`);\n\t}\n}","/**\n * 2023 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n// Proxy methods are methods that will proxy JS built-in methods.\n// For examply, the proxy function for \"splice\" will handle some event stuff and then use\n// the actual \"splice\" function internally\n\"use strict\"\n\nimport { NODE_STATUSES, EVENTS, ND, NID } from './globals';\nimport type { PseudoThis } from './types/proxserve-class';\nimport type { SpliceFunction, ShiftFunction, UnshiftFunction } from './types/proxy-methods';\nimport { initFunctionEmitEvent } from './event-emitter';\n\nexport const splice: SpliceFunction = function splice(\n\tthis: PseudoThis,\n\tstart,\n\tdeleteCount,\n\t...items\n) {\n\tif(this.dataNode[NID].status !== NODE_STATUSES.active) {\n\t\t// if not active then run regular `splice`\n\t\t// which will reach the `set` of the ProxyHandler and will be blocked or events stopped, etc.\n\t\treturn Array.prototype.splice.call(this.proxyNode[ND].proxy, start, deleteCount, ...items);\n\t}\n\n\tlet isActiveByInheritance = !this.dataNode[NID].hasOwnProperty('status');\n\tthis.dataNode[NID].status = NODE_STATUSES.splicing;\n\tlet oldValue = this.proxyNode[ND].target.slice(0);\n\tlet deleted = Array.prototype.splice.call(this.proxyNode[ND].proxy, start, deleteCount, ...items); // creates many side-effect events\n\tlet args = { start, deleteCount, items };\n\t\n\tif(isActiveByInheritance) {\n\t\tdelete this.dataNode[NID].status;\n\t} else {\n\t\tthis.dataNode[NID].status = NODE_STATUSES.active;\n\t}\n\n\tinitFunctionEmitEvent(this.dataNode, EVENTS.splice, args, oldValue, this.proxyNode[ND].target, this.metadata.trace);\n\n\treturn deleted;\n}\n\nexport const shift: ShiftFunction = function shift(this: PseudoThis) {\n\tif(this.dataNode[NID].status !== NODE_STATUSES.active) {\n\t\t// if not active then run regular `shift`\n\t\t// which will reach the `set` of the ProxyHandler and will be blocked or events stopped, etc.\n\t\treturn Array.prototype.shift.call(this.proxyNode[ND].proxy);\n\t}\n\n\tlet isActiveByInheritance = !this.dataNode[NID].hasOwnProperty('status');\n\tthis.dataNode[NID].status = NODE_STATUSES.splicing;\n\tlet oldValue = this.proxyNode[ND].target.slice(0);\n\tlet deleted = Array.prototype.shift.call(this.proxyNode[ND].proxy); // creates many side-effect events\n\t\n\tif(isActiveByInheritance) {\n\t\tdelete this.dataNode[NID].status;\n\t} else {\n\t\tthis.dataNode[NID].status = NODE_STATUSES.active;\n\t}\n\n\tinitFunctionEmitEvent(this.dataNode, EVENTS.shift, {}, oldValue, this.proxyNode[ND].target, this.metadata.trace);\n\n\treturn deleted;\n}\n\nexport const unshift: UnshiftFunction = function unshift(this: PseudoThis, ...items) {\n\tif(this.dataNode[NID].status !== NODE_STATUSES.active) {\n\t\t// if not active then run regular `unshift`\n\t\t// which will reach the `set` of the ProxyHandler and will be blocked or events stopped, etc.\n\t\treturn Array.prototype.unshift.call(this.proxyNode[ND].proxy, ...items);\n\t}\n\n\tlet isActiveByInheritance = !this.dataNode[NID].hasOwnProperty('status');\n\tthis.dataNode[NID].status = NODE_STATUSES.splicing;\n\tlet oldValue = this.proxyNode[ND].target.slice(0);\n\tlet newLength: number = Array.prototype.unshift.call(this.proxyNode[ND].proxy, ...items); // creates many side-effect events\n\tlet args = { items };\n\t\n\tif(isActiveByInheritance) {\n\t\tdelete this.dataNode[NID].status;\n\t} else {\n\t\tthis.dataNode[NID].status = NODE_STATUSES.active;\n\t}\n\n\tinitFunctionEmitEvent(this.dataNode, EVENTS.unshift, args, oldValue, this.proxyNode[ND].target, this.metadata.trace);\n\n\treturn newLength;\n}\n","export const DONT_PROXIFY_PREFIX = '_$';\nexport const PSEUDO_METHODS_ALTERNATIVE_NAMING_PREFIX = '$';","/**\n * 2023 Noam Lin <noamlin@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\"use strict\"\n\nimport { proxyTypes, NODE_STATUSES, PROXY_STATUSES, ND, NID } from './globals';\nimport type { TargetVariable, SomeObject } from './types/globals';\nimport type {\n\tProxserveInstance, ProxserveInstanceAlternatives,\n\tDataNode, ProxyNode,\n\tProxserveInstanceMetadata,\n} from './types/proxserve-class';\nimport { unproxify, createNodes } from './supporting-functions';\nimport * as pseudoMethods from './pseudo-methods';\nimport * as proxyMethods from './proxy-methods';\nimport { realtypeof, splitPath, evalPath } from './general-functions';\nimport { initEmitEvent } from './event-emitter';\nimport { DONT_PROXIFY_PREFIX, PSEUDO_METHODS_ALTERNATIVE_NAMING_PREFIX } from './constants';\n\n/**\n * save an array of all reserved function names\n * and also add synonyms to these functions\n */\nlet pseudoMethodsNames = Object.keys(pseudoMethods);\nlet pseudoMethodsExtended: Record<string | symbol, any> = {};\nfor(let i = pseudoMethodsNames.length - 1; i >= 0; i--) {\n\tlet name = pseudoMethodsNames[i];\n\tlet synonym = PSEUDO_METHODS_ALTERNATIVE_NAMING_PREFIX + name;\n\n\tpseudoMethodsNames.push(synonym);\n\tpseudoMethodsExtended[name] = pseudoMethods[name];\n\tpseudoMethodsExtended[synonym] = pseudoMethods[name];\n}\n\ninterface MakeOptions {\n\tstrict?: ProxserveInstanceMetadata['strict'];\n\tmethodsEmitRaw?: ProxserveInstanceMetadata['methodsEmitRaw'];\n\t/** internal root name of the instance */\n\tname?: string;\n\tdebug?: {\n\t\tdestroyDelay?: ProxserveInstanceMetadata['destroyDelay'];\n\t\ttrace?: ProxserveInstanceMetadata['trace'];\n\t};\n}\n\nexport class Proxserve {\n\t/**\n\t * make a new proxserve instance\n\t */\n\tstatic make<T>(target: TargetVariable, options = {} as MakeOptions): ProxserveInstance & T {\n\t\tconst {\n\t\t\tstrict = true,\n\t\t\tmethodsEmitRaw = false,\n\t\t\tname = '',\n\t\t\tdebug,\n\t\t} = options;\n\n\t\tconst destroyDelay = debug?.destroyDelay ?? 1000;\n\t\tconst trace = debug?.trace ?? 'none';\n\n\t\tlet dataTreePrototype: DataNode = {\n\t\t\t[NID]: {\n\t\t\t\tstatus: NODE_STATUSES.active,\n\t\t\t\tname,\n\t\t\t},\n\t\t\t[ND]: { isTreePrototype: true } as DataNode[typeof ND],\n\t\t};\n\t\tlet proxyTreePrototype: ProxyNode = {\n\t\t\t[NID]: { status: PROXY_STATUSES.alive },\n\t\t\t[ND]: { isTreePrototype: true } as ProxyNode[typeof ND],\n\t\t};\n\n\t\tconst newNodes = createNodes(dataTreePrototype, '', proxyTreePrototype, target);\n\n\t\tconst metadata = {\n\t\t\tstrict,\n\t\t\tmethodsEmitRaw,\n\t\t\tdestroyDelay,\n\t\t\ttrace,\n\t\t\tdataTree: newNodes.dataNode,\n\t\t\tproxyTree: newNodes.proxyNode,\n\t\t} as ProxserveInstanceMetadata;\n\n\t\treturn Proxserve.createProxy<T>(metadata, metadata.dataTree);\n\t}\n\n\t/**\n\t * create a new proxy and a new node for a property of the parent's target-object\n\t */\n\tstatic createProxy<T>(\n\t\tmetadata: ProxserveInstanceMetadata,\n\t\tparentDataNode: DataNode,\n\t\ttargetProperty?: string,\n\t): ProxserveInstance & T {\n\t\tconst parentProxyNode = parentDataNode[ND].proxyNode!;\n\t\tlet dataNode: DataNode;\n\t\tlet proxyNode: ProxyNode;\n\n\t\tif(targetProperty === undefined) { //refering to own node and not a child property (meaning root object)\n\t\t\tdataNode = parentDataNode;\n\t\t\tproxyNode = parentProxyNode;\n\t\t}\n\t\telse {\n\t\t\t//create new or reset an existing data-node and then creates a new proxy-node\n\t\t\tconst newNodes = createNodes(\n\t\t\t\tparentDataNode,\n\t\t\t\ttargetProperty,\n\t\t\t\tparentProxyNode,\n\t\t\t\tparentProxyNode[ND].target[targetProperty],\n\t\t\t);\n\t\t\tdataNode = newNodes.dataNode;\n\t\t\tproxyNode = newNodes.proxyNode!;\n\t\t}\n\n\t\tconst target = proxyNode[ND].target;\n\n\t\tconst typeoftarget = realtypeof(target);\n\n\t\tif(proxyTypes[typeoftarget]) {\n\t\t\tconst revocable = Proxy.revocable<TargetVariable>(target, {\n\t\t\t\tget: (target: TargetVariable/*same as parent scope 'target'*/, property: string|symbol, proxy) => {\n\t\t\t\t\tif(metadata.methodsEmitRaw === false && Object.prototype.hasOwnProperty.call(proxyMethods, property) && property in Object.getPrototypeOf(target)) {\n\t\t\t\t\t\t// use a proxy method instead of the built-in method that is on the prototype chain\n\t\t\t\t\t\treturn proxyMethods[property].bind({ metadata, dataNode, proxyNode });\n\t\t\t\t\t}\n\t\t\t\t\telse if(pseudoMethodsNames.includes(property as string) && typeof target[property] === 'undefined') {\n\t\t\t\t\t\t// can access a pseudo function (or its synonym) if their keywords isn't used\n\t\t\t\t\t\treturn pseudoMethodsExtended[property].bind({ metadata, dataNode, proxyNode });\n\t\t\t\t\t}\n\t\t\t\t\telse if(!target.propertyIsEnumerable(property) || typeof property === 'symbol') {\n\t\t\t\t\t\treturn target[property]; // non-enumerable or non-path'able aren't proxied\n\t\t\t\t\t}\n\t\t\t\t\telse if(\n\t\t\t\t\t\tproxyNode[property] // there's a child node\n\t\t\t\t\t\t&& proxyNode[property][ND].proxy // it holds a proxy\n\t\t\t\t\t\t&& proxyNode[property][NID].status === PROXY_STATUSES.alive\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn proxyNode[property][ND].proxy;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn target[property];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\n\t\t\t\tset: (target/*same as parent scope 'target'*/, property, value, proxy) => { //'receiver' is proxy\n\t\t\t\t\t/**\n\t\t\t\t\t * property can be a regular object because of a few possible reasons:\n\t\t\t\t\t * 1. proxy is deleted from tree but user keeps accessing it then it means he saved a reference.\n\t\t\t\t\t * 2. it is a non-enumerable property which means it was intentionally hidden.\n\t\t\t\t\t * 3. property is a symbol and symbols can't be proxied because we can't create a normal path for them.\n\t\t\t\t\t *    these properties are not proxied and should not emit change-event.\n\t\t\t\t\t *    except for: length\n\t\t\t\t\t * 4. property is manually set as raw object with the special prefix.\n\t\t\t\t\t * TODO - make a list of all possible properties exceptions (maybe function 'name'?)\n\t\t\t\t\t */\n\t\t\t\t\tif(dataNode[NID].status === NODE_STATUSES.blocked) { //blocked from changing values\n\t\t\t\t\t\tconsole.error('object is blocked. can\\'t change value of property:', property);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(\n\t\t\t\t\t\ttypeof property === 'symbol'\n\t\t\t\t\t\t|| property.startsWith(DONT_PROXIFY_PREFIX)\n\t\t\t\t\t) {\n\t\t\t\t\t\ttarget[property] = value;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse if(property !== 'length' && !target.propertyIsEnumerable(property)) {\n\t\t\t\t\t\t//if setting a whole new property then it is non-enumerable (yet) so a further test is needed\n\t\t\t\t\t\tlet descriptor = Object.getOwnPropertyDescriptor(target, property);\n\t\t\t\t\t\tif(typeof descriptor === 'object' && descriptor.enumerable === false) { //property was previously set\n\t\t\t\t\t\t\ttarget[property] = value;\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet oldValue = target[property]; // should not be proxy\n\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\tif(proxyNode[property] !== undefined && proxyNode[property][ND].proxy !== undefined) {\n\t\t\t\t\t\t// about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\tproxyNode[property][NID].status = PROXY_STATUSES.deleted;\n\t\t\t\t\t\tdelete dataNode[property][ND].proxyNode; // detach reference from data-node to proxy-node\n\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\tif(metadata.strict) {\n\t\t\t\t\t\t\t// postpone this cpu intense function for later, probably when proxserve is not in use\n\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, metadata.destroyDelay, proxyNode[property][ND].proxy);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = unproxify(value);\n\t\t\t\t\ttarget[property] = value; //assign new value\n\n\t\t\t\t\tlet isValueProxy = false;\n\t\t\t\t\tlet typeofvalue = realtypeof(value);\n\t\t\t\t\tif(proxyTypes[typeofvalue]) {\n\t\t\t\t\t\tProxserve.createProxy(metadata, dataNode, property); // if trying to add a new value which is an object then make it a proxy\n\t\t\t\t\t\tisValueProxy = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, value, isValueProxy, metadata.trace);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * TODO - this function is incomplete and doesn't handle all of 'descriptor' scenarios\n\t\t\t\t */\n\t\t\t\tdefineProperty: (target/*same as parent scope 'target'*/, property, descriptor) => {\n\t\t\t\t\tif(typeof property === 'symbol') {\n\t\t\t\t\t\tObject.defineProperty(target, property, descriptor);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet oldValue = target[property]; //should not be proxy\n\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\tif(proxyNode[property] !== undefined && proxyNode[property][ND].proxy !== undefined) {\n\t\t\t\t\t\t//about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\tproxyNode[property][NID].status = PROXY_STATUSES.deleted;\n\t\t\t\t\t\tdelete dataNode[property][ND].proxyNode; //detach reference from data-node to proxy-node\n\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\tif(metadata.strict) {\n\t\t\t\t\t\t\t//postpone this cpu intense function for later, probably when proxserve is not is use\n\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, metadata.destroyDelay, proxyNode[property][ND].proxy);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdescriptor.value = unproxify(descriptor.value);\n\t\t\t\t\tObject.defineProperty(target, property, descriptor); //defining the new value\n\t\t\t\t\tlet value = descriptor.value;\n\t\t\t\t\tlet isValueProxy = false;\n\t\t\t\t\t//excluding non-enumerable properties from being proxied\n\t\t\t\t\tlet typeofvalue = realtypeof(descriptor.value);\n\t\t\t\t\tif(proxyTypes[typeofvalue] && descriptor.enumerable === true) {\n\t\t\t\t\t\tProxserve.createProxy(metadata, dataNode, property); //if trying to add a new value which is an object then make it a proxy\n\t\t\t\t\t\tisValueProxy = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, value, isValueProxy, metadata.trace);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\n\t\t\t\tdeleteProperty: (target/*same as parent scope 'target'*/, property) => {\n\t\t\t\t\tif(!target.propertyIsEnumerable(property) || typeof property === 'symbol') {\n\t\t\t\t\t\t//non-proxied properties simply get deleted and nothing more\n\t\t\t\t\t\tdelete target[property];\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(dataNode[NID].status === NODE_STATUSES.blocked) { //blocked from changing values\n\t\t\t\t\t\tconsole.error(`can't delete property '${property}'. object is blocked.`);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(property in target) {\n\t\t\t\t\t\tlet oldValue = target[property]; //should not be proxy\n\t\t\t\t\t\tlet isOldValueProxy = false;\n\t\t\t\t\t\tif(proxyNode[property] !== undefined && proxyNode[property][ND].proxy !== undefined) {\n\t\t\t\t\t\t\t//about to overwrite an existing property which is a proxy (about to detach a proxy)\n\t\t\t\t\t\t\tproxyNode[property][NID].status = PROXY_STATUSES.deleted;\n\t\t\t\t\t\t\tdelete dataNode[property][ND].proxyNode; //detach reference from data-node to proxy-node\n\t\t\t\t\t\t\tisOldValueProxy = true;\n\t\t\t\t\t\t\tif(metadata.strict) {\n\t\t\t\t\t\t\t\t//postpone this cpu intense function for later, probably when proxserve is not is use\n\t\t\t\t\t\t\t\tsetTimeout(Proxserve.destroy, metadata.destroyDelay, proxyNode[property][ND].proxy);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelete target[property]; // actual delete\n\n\t\t\t\t\t\tinitEmitEvent(dataNode, property, oldValue, isOldValueProxy, undefined, false, metadata.trace);\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn true; //do nothing because there's nothing to delete\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as ProxyHandler<TargetVariable>) as { proxy: ProxserveInstance & T, revoke: () => void };\n\n\t\t\tproxyNode[ND].proxy = revocable.proxy;\n\t\t\tproxyNode[ND].revoke = revocable.revoke;\n\n\t\t\tif(proxyTypes[typeoftarget]) {\n\t\t\t\tlet keys = Object.keys(target); //handles both Objects and Arrays\n\t\t\t\tfor(let key of keys) {\n\t\t\t\t\tif (key.startsWith(DONT_PROXIFY_PREFIX)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlet typeofproperty = realtypeof(target[key]);\n\t\t\t\t\tif(proxyTypes[typeofproperty]) {\n\t\t\t\t\t\tProxserve.createProxy(metadata, dataNode, key); //recursively make child objects also proxies\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.warn(`Type of \"${typeoftarget}\" is not implemented`);\n\t\t\t}\n\n\t\t\treturn revocable.proxy;\n\t\t}\n\t\telse {\n\t\t\tconst types = Object.keys(proxyTypes);\n\t\t\tthrow new Error(`Must observe an ${types.join('/')}`);\n\t\t}\n\t}\n\n\t/**\n\t * Recursively revoke proxies, allowing them to be garbage collected.\n\t * this functions delays 1000 milliseconds to let time for all events to finish\n\t */\n\tstatic destroy(proxy: ProxserveInstance) {\n\t\tlet proxyNode: ProxyNode;\n\t\ttry {\n\t\t\tconst nodes = (proxy as ProxserveInstanceAlternatives).$getProxserveNodes();\n\t\t\tproxyNode = nodes.proxyNode;\n\t\t} catch(error) {\n\t\t\treturn; // proxy variable isn't a proxy\n\t\t}\n\n\t\tif(proxyNode[NID].status === PROXY_STATUSES.alive) {\n\t\t\tproxyNode[NID].status = PROXY_STATUSES.deleted;\n\t\t}\n\n\t\tlet typeofproxy = realtypeof(proxy);\n\n\t\tif(proxyTypes[typeofproxy]) {\n\t\t\tlet keys = Object.keys(proxy); // handles both Objects and Arrays\n\t\t\tfor(let key of keys) {\n\t\t\t\tif (key.startsWith(DONT_PROXIFY_PREFIX)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tlet typeofproperty = realtypeof(proxy[key]);\n\t\t\t\t\tif(proxyTypes[typeofproperty]) {\n\t\t\t\t\t\t// going to proxy[key], which is deleted, will return the original target so we will bypass it\n\t\t\t\t\t\tProxserve.destroy(proxyNode[key][ND].proxy!);\n\t\t\t\t\t}\n\t\t\t\t} catch(error) {\n\t\t\t\t\tconsole.error(error); // don't throw and kill the whole process just if this iteration fails\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tproxyNode[ND].revoke?.();\n\t\t\t//proxyNode[ND].proxy = undefined;\n\t\t\tproxyNode[NID].status = PROXY_STATUSES.revoked;\n\t\t}\n\t\telse {\n\t\t\tconsole.warn(`Type of \"${typeofproxy}\" is not implemented`);\n\t\t}\n\t}\n\n\t/**\n\t * splits a path to an array of properties\n\t */\n\tstatic splitPath(path: string): Array<string|number> {\n\t\treturn splitPath(path);\n\t}\n\n\t/**\n\t * evaluate a long path and return the designated object and its referred property\n\t */\n\tstatic evalPath(obj: SomeObject, path: string): {\n\t\tobject: SomeObject,\n\t\tproperty: string|number,\n\t\tvalue: any,\n\t} {\n\t\treturn evalPath(obj, path);\n\t}\n}"],"names":[],"mappings":";;;IAAA;;;;;;IAMG;IAGI,MAAM,EAAE,GAAG,MAAM,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;IAC7C,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;IAE/D;IACO,MAAM,UAAU,GAAG;IACzB,IAAA,QAAQ,EAAE,IAAI;IACd,IAAA,OAAO,EAAE,IAAI;KACb,CAAC;IAEF;IACA,IAAY,aAKX,CAAA;IALD,CAAA,UAAY,aAAa,EAAA;IACxB,IAAA,aAAA,CAAA,QAAA,CAAA,GAAA,QAAiB,CAAA;IACjB,IAAA,aAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;IACnB,IAAA,aAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;IACnB,IAAA,aAAA,CAAA,UAAA,CAAA,GAAA,UAAqB,CAAA;IACtB,CAAC,EALW,aAAa,KAAb,aAAa,GAKxB,EAAA,CAAA,CAAA,CAAA;IAED;IACA,IAAY,cAIX,CAAA;IAJD,CAAA,UAAY,cAAc,EAAA;IACzB,IAAA,cAAA,CAAA,OAAA,CAAA,GAAA,OAAe,CAAA;IACf,IAAA,cAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;IACnB,IAAA,cAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;IACpB,CAAC,EAJW,cAAc,KAAd,cAAc,GAIzB,EAAA,CAAA,CAAA,CAAA;IAED;IACA,IAAY,MAOX,CAAA;IAPD,CAAA,UAAY,MAAM,EAAA;IACjB,IAAA,MAAA,CAAA,QAAA,CAAA,GAAA,QAAiB,CAAA;IACjB,IAAA,MAAA,CAAA,QAAA,CAAA,GAAA,QAAiB,CAAA;IACjB,IAAA,MAAA,CAAA,QAAA,CAAA,GAAA,QAAiB,CAAA;IACjB,IAAA,MAAA,CAAA,QAAA,CAAA,GAAA,QAAiB,CAAA;IACjB,IAAA,MAAA,CAAA,OAAA,CAAA,GAAA,OAAe,CAAA;IACf,IAAA,MAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;IACpB,CAAC,EAPW,MAAM,KAAN,MAAM,GAOjB,EAAA,CAAA,CAAA;;ICzCD;;;;;;IAMG;IAKH;;IAEG;IACG,SAAU,UAAU,CAAC,QAAa,EAAA;IACvC,IAAA,IAAI,OAAO,GAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACvD,IAAA,OAAO,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,MAAM,GAAG,CAAC,CAAkB,CAAC;IAClE,CAAC;IA2DD;;;;IAIG;IACG,SAAU,SAAS,CAAC,IAAY,EAAA;QACrC,IAAG,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,KAAK,EAAE,EAAE;IAC3C,QAAA,OAAO,EAAE,CAAC;IACV,KAAA;QAED,IAAI,CAAC,GAAG,CAAC,EAAE,eAAe,GAAG,KAAK,EAAE,UAAU,GAAG,KAAK,CAAC;;IAEvD,IAAA,IAAG,IAAI,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;YACnB,CAAC,GAAG,CAAC,CAAC;IACN,KAAA;IAAM,SAAA,IAAG,IAAI,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;YAC1B,CAAC,GAAG,CAAC,CAAC;YACN,eAAe,GAAG,IAAI,CAAC;YACvB,UAAU,GAAG,IAAI,CAAC;IAClB,KAAA;QAED,IAAI,UAAU,GAAG,EAA0B,CAAC;QAC5C,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,OAAM,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;IAC3B,QAAA,IAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;IAEnB,QAAA,IAAG,eAAe,EAAE;gBACnB,IAAG,IAAI,KAAK,GAAG,EAAE;IAChB,gBAAA,IAAG,UAAU,EAAE;wBACd,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;IACnC,iBAAA;IAAM,qBAAA;IACN,oBAAA,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACrB,iBAAA;oBAED,eAAe,GAAG,KAAK,CAAC;oBACxB,UAAU,GAAG,KAAK,CAAC;oBACnB,GAAG,GAAG,EAAE,CAAC;IACT,aAAA;IACI,iBAAA;IACJ,gBAAA,IAAG,UAAU,EAAE;wBACd,IAAI,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;wBAC9B,IAAG,IAAI,GAAG,EAAE,IAAI,IAAI,GAAG,EAAE,EAAE;4BAC1B,UAAU,GAAG,KAAK,CAAC;IACnB,qBAAA;IACD,iBAAA;oBACD,GAAG,IAAI,IAAI,CAAC;IACZ,aAAA;IACD,SAAA;IACI,aAAA;gBACJ,IAAG,IAAI,KAAK,GAAG,EAAE;oBAChB,eAAe,GAAG,IAAI,CAAC;oBACvB,UAAU,GAAG,IAAI,CAAC;IAClB,aAAA;;IAGD,YAAA,IAAG,IAAI,KAAK,GAAG,IAAI,IAAI,KAAK,GAAG,EAAE;oBAChC,IAAG,GAAG,KAAK,EAAE,EAAE;IACd,oBAAA,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;wBACrB,GAAG,GAAG,EAAE,CAAC;IACT,iBAAA;IACD,aAAA;IACI,iBAAA;oBACJ,GAAG,IAAI,IAAI,CAAC;IACZ,aAAA;IACD,SAAA;IACD,KAAA;QACD,IAAG,GAAG,KAAK,EAAE,EAAE;IACd,QAAA,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACrB,KAAA;IACD,IAAA,OAAO,UAAU,CAAC;IACnB,CAAC;IAED;;IAEG;IACa,SAAA,QAAQ,CAAC,GAAe,EAAE,IAAY,EAAA;QAKrD,IAAG,IAAI,KAAK,EAAE,EAAE;YACf,OAAO;IACN,YAAA,MAAM,EAAE,GAAG;IACX,YAAA,QAAQ,EAAE,EAAE;IACZ,YAAA,KAAK,EAAE,GAAG;aACV,CAAC;IACF,KAAA;IAED,IAAA,IAAI,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;IAC/B,IAAA,IAAI,CAAS,CAAC;IACd,IAAA,KAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;YACzC,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;IACvB,QAAA,IAAG,OAAO,GAAG,KAAK,WAAW,EAAE;IAC9B,YAAA,MAAM,IAAI,KAAK,CAAC,6BAA6B,IAAI,CAAA,CAAA,CAAG,CAAC,CAAC;IACtD,SAAA;IACD,KAAA;QACD,OAAO;IACN,QAAA,MAAM,EAAE,GAAG;IACX,QAAA,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC;IACrB,QAAA,KAAK,EAAE,GAAG,CAAE,QAAQ,CAAC,CAAC,CAAC,CAAE;SACzB,CAAC;IACH;;IChLA;;;;;;IAMG;IAoBI,MAAM,IAAI,GAAiB,SAAS,IAAI,GAAA;QAC9C,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,OAAO,CAAC;IACnD,CAAC,CAAC;IAEK,MAAM,KAAK,GAAkB,SAAS,KAAK,GAAA;QACjD,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,OAAO,CAAC;IACnD,CAAC,CAAC;IAEK,MAAM,QAAQ,GAAqB,SAAS,QAAQ,CAAmB,KAAK,GAAG,KAAK,EAAA;IAC1F,IAAA,IAAG,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;YACrD,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;IACjD,KAAA;IACI,SAAA;YACJ,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC;IACjC,KAAA;IACF,CAAC,CAAC;IAEK,MAAM,EAAE,GAAe,SAAS,EAAE,CAAmB,IAAI,EAAA;IAC/D,IAAA,MAAM,EACL,IAAI,GAAG,EAAE,EACT,QAAQ,EACR,EAAE,EACF,IAAI,GAAG,KAAK,EACZ,IAAI,GAAG,KAAK,GACZ,GAAG,IAAI,CAAC;;;IAGT,IAAA,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC;QAE7B,IAAG,MAAM,KAAK,QAAQ,EAAE;YACvB,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAkB,CAAC;IAC9C,KAAA;IAAM,SAAA,IAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;IACjC,QAAA,MAAM,GAAG,CAAC,MAAM,CAAC,CAAC;IAClB,KAAA;IAED,IAAA,KAAI,IAAI,KAAK,IAAI,MAAM,EAAE;IACxB,QAAA,IAAG,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;gBAClB,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAClC,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,EAAG,KAAK,CAA2C,wCAAA,EAAA,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA,CAAE,CAAC,CAAC;IACtF,SAAA;IACD,KAAA;IAED,IAAA,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC7B,IAAA,IAAI,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;IAC/B,IAAA,KAAI,IAAI,QAAQ,IAAI,QAAQ,EAAE;IAC7B,QAAA,IAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;;IAEvB,YAAA,WAAW,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;IAChC,SAAA;IAED,QAAA,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC9B,KAAA;QAED,IAAI,aAAa,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC;IACnD,IAAA,IAAG,IAAI,EAAE;YACR,aAAa,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC;IAC5C,KAAA;IAED,IAAA,IAAI,WAAW,GAAG;IACjB,QAAA,IAAI,EAAE,MAAM;YACZ,IAAI;IACJ,QAAA,IAAI,EAAE,QAAQ;SACE,CAAC;QAElB,IAAG,EAAE,KAAK,SAAS,EAAE;IACpB,QAAA,WAAW,CAAC,EAAE,GAAG,EAAE,CAAC;IACpB,KAAA;IACD,IAAA,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IACjC,CAAC,CAAC;IAEK,MAAM,IAAI,GAAiB,SAAS,IAAI,CAAmB,IAAI,EAAA;IACrE,IAAA,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IACjB,IAAA,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACrB,CAAC,CAAC;IAEF,SAAS,UAAU,CAAC,YAA4B,EAAE,EAA8B,EAAA;IAC/E,IAAA,KAAI,IAAI,CAAC,GAAG,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;IACjD,QAAA,IAAI,WAAW,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;IAClC,QAAA,IAAG,CAAC,EAAE,KAAK,SAAS,IAAI,WAAW,CAAC,EAAE,KAAK,EAAE,KAAK,WAAW,CAAC,IAAI,KAAK,EAAE,EAAE;IAC1E,YAAA,YAAY,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC1B,SAAA;IACD,KAAA;IACF,CAAC;IAEM,MAAM,cAAc,GAA2B,SAAS,cAAc,CAAmB,IAAI,EAAA;QACnG,MAAM,EAAE,EAAE,EAAE,IAAI,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC;IAC/B,IAAA,MAAM,QAAQ,GAAG,CAAG,EAAA,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,CAAG,EAAA,IAAI,EAAE,CAAC;IACpD,IAAA,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC7B,IAAA,MAAM,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;;IAGjC,IAAA,KAAI,IAAI,QAAQ,IAAI,QAAQ,EAAE;IAC7B,QAAA,IAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;IACvB,YAAA,OAAO,CAAC,IAAI,CAAC,mDAAmD,QAAQ,CAAA,CAAA,CAAG,CAAC,CAAC;gBAC7E,OAAO;IACP,SAAA;IACD,QAAA,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC9B,KAAA;IAED,IAAA,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;IAC/C,IAAA,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;IAC7C,CAAC,CAAC;IAEK,MAAM,kBAAkB,GAA+B,SAAS,kBAAkB,CAAmB,IAAI,GAAG,EAAE,EAAA;IACpH,IAAA,MAAM,QAAQ,GAAG,CAAG,EAAA,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,CAAG,EAAA,IAAI,EAAE,CAAC;IACpD,IAAA,MAAM,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;IACjC,IAAA,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;;IAG7B,IAAA,KAAI,IAAI,QAAQ,IAAI,QAAQ,EAAE;IAC7B,QAAA,IAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;IACvB,YAAA,OAAO,CAAC,IAAI,CAAC,wDAAwD,QAAQ,CAAA,CAAA,CAAG,CAAC,CAAC;gBAClF,OAAO;IACP,SAAA;IACD,QAAA,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC9B,KAAA;QAED,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,GAAG,EAAoB,CAAC;QACtD,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,IAAI,GAAG,EAAoB,CAAC;IACpD,CAAC,CAAC;IAEK,MAAM,iBAAiB,GAA8B,SAAS,iBAAiB,GAAA;QACrF,OAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC;IAClC,CAAC,CAAC;IAEK,MAAM,gBAAgB,GAA6B,SAAS,gBAAgB,GAAA;QAClF,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;IAChC,CAAC,CAAC;IAEK,MAAM,MAAM,GAAW,SAAS,MAAM,GAAA;IAC5C,IAAA,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC;IACzD,CAAC,CAAC;IAEK,MAAM,iBAAiB,GAA8B,SAAS,iBAAiB,GAAA;IACrF,IAAA,OAAO,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,SAAS,EAAE,CAAC;IAC/D,CAAC;;;;;;;;;;;;;;;;;ICjKD;;;;;;IAMG;IASH;;IAEG;IACa,SAAA,aAAa,CAAC,GAAQ,EAAE,QAAuB,EAAA;IAC9D,IAAA,IAAG,OAAO,QAAQ,KAAK,QAAQ,EAAE;IAChC,QAAA,MAAM,IAAI,KAAK,CAAC,CAAA,yCAAA,CAA2C,CAAC,CAAC;IAC7D,KAAA;IAED,IAAA,MAAM,SAAS,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;IAClC,IAAA,QAAO,SAAS;YACf,KAAK,QAAQ,EAAE;gBACd,OAAO,CAAA,CAAA,EAAI,QAAQ,CAAA,CAAE,CAAC;IACtB,SAAA;YACD,KAAK,OAAO,EAAE;gBACb,OAAO,CAAA,CAAA,EAAI,QAAQ,CAAA,CAAA,CAAG,CAAC;IACvB,SAAA;IACD,QAAA,SAAS;IACR,YAAA,OAAO,CAAC,IAAI,CAAC,6BAA6B,SAAS,CAAA,EAAA,CAAI,CAAC,CAAC;IACzD,YAAA,OAAO,QAAkB,CAAC;IAC1B,SAAA;IACD,KAAA;IACF,CAAC;IAED;;;;;;;;;;IAUG;IACG,SAAU,SAAS,CAAC,KAAU,EAAA;IACnC,IAAA,MAAM,WAAW,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC;IAEtC,IAAA,IAAG,UAAU,CAAC,WAAW,CAAC,EAAE;YAC3B,IAAI,MAAM,GAAG,KAAK,CAAC;YACnB,IAAI;IACH,YAAA,MAAM,GAAG,KAAK,CAAC,kBAAkB,EAAE,CAAC;IACpC,SAAA;YAAC,OAAM,KAAK,EAAE,GAAE;IAEjB,QAAA,QAAO,WAAW;IACjB,YAAA,KAAK,QAAQ;oBACZ,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC/B,gBAAA,KAAI,IAAI,GAAG,IAAI,IAAI,EAAE;IACpB,oBAAA,MAAM,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;IACrC,iBAAA;oBACD,MAAM;IACP,YAAA,KAAK,OAAO;IACX,gBAAA,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;IACpC,oBAAA,MAAM,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;IACjC,iBAAA;oBACD,MAAM;IACP,YAAA;IACC,gBAAA,OAAO,CAAC,IAAI,CAAC,6BAA6B,WAAW,CAAA,EAAA,CAAI,CAAC,CAAC;IAC5D,SAAA;IAED,QAAA,OAAO,MAAM,CAAC;IACd,KAAA;IACI,SAAA;YACJ,OAAO,KAAK,CAAC;IACb,KAAA;IACF,CAAC;IAED;;;IAGG;IACG,SAAU,WAAW,CAC1B,cAAwB,EACxB,QAAyB,EACzB,eAA2B,EAC3B,MAAuB,EAAA;;IAGvB,IAAA,IAAI,YAAoB,CAAC;QACzB,IAAG,eAAe,aAAf,eAAe,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAf,eAAe,CAAG,EAAE,CAAE,CAAA,MAAM,EAAE;IAChC,QAAA,YAAY,GAAG,aAAa,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IACnE,KAAA;IAAM,SAAA;YACN,YAAY,GAAG,aAAa,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;IAC3C,KAAA;;QAGD,IAAI,QAAQ,GAAa,cAAc,CAAC,QAAQ,CAAC,CAAC;QAClD,IAAG,CAAC,QAAQ,EAAE;IACb,QAAA,QAAQ,GAAG;gBACV,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;gBACzC,CAAC,EAAE,GAAG;IACL,gBAAA,UAAU,EAAE,cAAc;IAC1B,gBAAA,SAAS,EAAE;IACV,oBAAA,OAAO,EAAE,EAAoB;IAC7B,oBAAA,IAAI,EAAE,EAAoB;IAC1B,iBAAA;IACD,aAAA;aACW,CAAC;IACd,QAAA,cAAc,CAAC,QAAQ,CAAC,GAAG,QAAQ,CAAC;IACpC,KAAA;QAED,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC;;IAE5B,IAAA,IAAG,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,eAAe,EAAE;IACvC,QAAA,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE;gBAC3B,IAAI,EAAE,cAAc,CAAC,EAAE,CAAC,CAAC,IAAI,GAAG,YAAY;gBAC5C,YAAY;IACZ,SAAA,CAAC,CAAC;IACH,KAAA;IACI,SAAA;IACJ,QAAA,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE;IAC3B,YAAA,IAAI,EAAE,EAAE;IACR,YAAA,YAAY,EAAE,EAAE;IAChB,SAAA,CAAC,CAAC;IACH,KAAA;;IAGD,IAAA,IAAI,SAAgC,CAAC;IACrC,IAAA,IAAG,eAAe,EAAE;IACnB,QAAA,SAAS,GAAG;gBACX,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;gBAC1C,CAAC,EAAE,GAAG;IACL,gBAAA,MAAM,EAAE,MAAwB;oBAChC,QAAQ;IACR,aAAA;aACD,CAAC;IAEF,QAAA,eAAe,CAAC,QAAQ,CAAC,GAAG,SAAS,CAAC;;IAGtC,QAAA,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,GAAG,SAAS,CAAC;IACnC,KAAA;IAAM,SAAA;;YAEN,SAAS,GAAG,SAAS,CAAC;IACtB,KAAA;IAED,IAAA,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,CAAC;IAChC,CAAC;IAED,IAAI,WAAW,GAAG,KAAK,CAAC;aACR,aAAa,CAC5B,QAAkB,EAClB,MAAmB,EACnB,QAA6C,EAAA;IAE7C,IAAA,IAAI,QAAQ,KAAK,QAAQ,IAAI,QAAQ,KAAK,SAAS,EAAE;YACpD,OAAO;IACP,KAAA;IAED,IAAA,MAAM,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;IACxB,IAAA,MAAM,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;QAExB,IAAI,CAAC,KAAK,EAAE;YACX,IAAI,CAAC,WAAW,EAAE;;IAEjB,YAAA,OAAO,CAAC,KAAK,CAAC,mFAAmF,CAAC,CAAC;gBACnG,WAAW,GAAG,IAAI,CAAC;IACnB,SAAA;YACD,OAAO;IACP,KAAA;;IAGD,IAAA,MAAM,cAAc,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,KAAI;IACtD,QAAA,OAAO,KAAK,CAAC,IAAI,EAAE,CAAC;IACrB,KAAC,CAAC,CAAC;;IAEH,IAAA,IAAI,cAAc,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;YAC3D,cAAc,CAAC,KAAK,EAAE,CAAC;IACvB,KAAA;;QAED,cAAc,CAAC,KAAK,EAAE,CAAC;;IAEvB,IAAA,cAAc,CAAC,CAAC,CAAC,GAAG,cAAc,CAAC;;IAGnC,IAAA,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAgB,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC;IACvE,IAAA,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;IACvB,IAAA,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,CAAC,OAAO,EAAE;YACnE,IAAI,IAAI,IAAI,CAAC;IACb,KAAA;IAAM,SAAA;YACN,IAAI,IAAI,GAAG,CAAC;IACZ,KAAA;IAED,IAAA,OAAO,CAAC,GAAG,CACV,oEAAoE,EACpE,gCAAgC,CAChC,CAAC;IACF,IAAA,OAAO,CAAC,GAAG,CACV,CAAA,EAAA,EAAK,QAAQ,CAAA,YAAA,EAAe,IAAI,CAAA,CAAA,CAAG,EACnC,iCAAiC,EACjC,cAAc,CACd,CAAC;;QAGF,IAAI,QAAQ,KAAK,SAAS,EAAE;YAC3B,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,IAAI,MAAM,CAAC,IAAI,KAAK,SAAS,EAAE;gBAC1D,OAAO,CAAC,GAAG,CACV,CAAkB,eAAA,EAAA,MAAM,CAAC,IAAI,CAAG,CAAA,CAAA,EAChC,kCAAkC,CAClC,CAAC;IACF,YAAA,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACzB,SAAA;IAED,QAAA,OAAO,CAAC,GAAG,CACV,kBAAkB,EAClB,kCAAkC,CAClC,CAAC;IACF,QAAA,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IAC7B,QAAA,OAAO,CAAC,GAAG,CACV,iBAAiB,EACjB,kCAAkC,CAClC,CAAC;IACF,QAAA,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC1B,KAAA;;IAGD,IAAA,OAAO,CAAC,GAAG,CACV,CAAA,EAAA,EAAK,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA,CAAE,EAChC,cAAc,CACd,CAAC;IACF,IAAA,OAAO,CAAC,GAAG,CACV,oEAAoE,EACpE,6BAA6B,CAC7B,CAAC;IACH;;IC9OA;;;;;;IAMG;IASH;;;;IAIG;IACH,SAAS,aAAa,CAAC,QAAkB,EAAE,QAAiB,EAAA;;QAC3D,IAAG,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,IAAI,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,cAAc,CAAC,KAAK,EAAE;IACzF,QAAA,OAAO,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC;IACxC,KAAA;IACI,SAAA;YACJ,IAAG,CAAC,QAAQ,EAAE;;IAEb,YAAA,QAAQ,GAAG,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAW,CAAC;IAC7D,SAAA;YAED,IAAI,UAAU,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC,UAAU,CAAC;YAEzC,IAAG,UAAU,CAAC,EAAE,CAAC,CAAC,SAAS,IAAI,UAAU,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,cAAc,CAAC,KAAK,EAAE;IAC7F,YAAA,OAAO,MAAA,UAAU,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAG,QAAQ,CAAC,CAAC;IACtD,SAMA;IACD,KAAA;IAED,IAAA,OAAO,SAAS,CAAC;IAClB,CAAC;IAED;;IAEG;IACa,SAAA,aAAa,CAC5B,QAAkB,EAClB,QAAgB,EAChB,QAAa,EACb,gBAAyB,EACzB,KAAU,EACV,YAAqB,EACrB,KAA0C,EAAA;IAE1C,IAAA,IAAG,QAAQ,KAAK,KAAK;eAClB,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,EAAE;YAC3B,OAAO;IACP,KAAA;QAED,IAAI,SAAS,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC;IACvC,IAAA,IAAG,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,cAAc,CAAC,KAAK,EAAE;YAClD,OAAO;IACP,KAAA;IAED,IAAA,IAAI,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;QAC/B,IAAG,KAAK,KAAK,SAAS,EAAE;IACvB,QAAA,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;IAC3B,KAAA;aAAM,IAAG,QAAQ,KAAK,SAAS,EAAE;IACjC,QAAA,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;IAC3B,KAAA;IAED,IAAA,IAAI,cAA2C,CAAC;;QAEhD,IAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,aAAa,CAAC,QAAQ,EAAE;;IAEnD,QAAA,IAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,cAAc,EAAE;IAChC,YAAA,QAAQ,CAAC,EAAE,CAAC,CAAC,cAAc,GAAG,EAAE,CAAC;IACjC,SAAA;;IAED,QAAA,cAAc,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC,cAAc,CAAC;IAC7C,KAAA;IAED,IAAA,IAAI,IAAY,CAAC;IACjB,IAAA,IAAG,QAAQ,CAAC,QAAQ,CAAC,EAAE;IACtB,QAAA,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;YAC9B,IAAI,GAAG,EAAE,CAAC;IACV,KAAA;IAAM,SAAA;IACN,QAAA,IAAI,GAAG,aAAa,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IACrD,KAAA;IAED,IAAA,IAAI,MAAM,GAAgB;IACzB,QAAA,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,UAAU;SACvC,CAAC;QAEF,IAAG,CAAC,cAAc,EAAE;;IAEnB,QAAA,aAAa,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;IAEvC,QAAA,UAAU,CAAC,QAAQ,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;IAEvC,QAAA,IAAG,gBAAgB,IAAI,YAAY,EAAE;IACpC,YAAA,WAAW,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;IAC9B,SAAA;IACD,KAAA;IACI,SAAA;IACJ,QAAA,cAAc,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,MAAM,EAAE,aAAa,EAAE,gBAAgB,IAAI,YAAY,EAAC,CAAC,CAAC;IACzF,KAAA;IACF,CAAC;IAED;;;;;IAKG;IACH,SAAS,UAAU,CAAC,QAAkB,EAAE,MAAmB,EAAE,QAAiB,EAAA;QAC7E,IAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,aAAa,CAAC,OAAO,EAAE;IAClD,QAAA,OAAO;IACP,KAAA;QAED,IAAI,SAAS,GAAG,aAAa,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;IAElD,IAAA,IAAG,MAAM,CAAC,IAAI,KAAK,EAAE,EAAE;IACtB,QAAA,cAAc,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,SAAS,EAAE,MAAM,CAAC,CAAC;IAClE,KAAA;;IAGD,IAAA,cAAc,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC,CAAC;IAE/D,IAAA,IAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC,eAAe,EAAE;;;IAGhD,QAAA,IAAI,UAAU,GAAgB;IAC7B,YAAA,GAAG,MAAM;gBACT,IAAI,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC,YAAY,GAAG,MAAM,CAAC,IAAI;aAC7C,CAAC;YAEF,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;IAChD,KAAA;IACF,CAAC;IAED;;;;IAIG;IACH,SAAS,WAAW,CAAC,QAAkB,EAAE,MAAmB,EAAA;QAC3D,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACjC,IAAA,KAAI,IAAI,GAAG,IAAI,IAAI,EAAE;IACpB,QAAA,IAAI,QAAQ,GAAG,CAAC,OAAO,MAAM,CAAC,KAAK,KAAK,QAAQ,IAAI,MAAM,CAAC,KAAK,KAAK,IAAI,IAAI,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC;IAC3G,QAAA,IAAI,WAAW,GAAG,CAAC,OAAO,MAAM,CAAC,QAAQ,KAAK,QAAQ,IAAI,MAAM,CAAC,QAAQ,KAAK,IAAI,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC;IACvH,QAAA,IAAG,QAAQ,KAAK,WAAW,EAAE;IAC5B,YAAA,IAAI,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;gBAC/B,IAAG,QAAQ,KAAK,SAAS,EAAE;IAC1B,gBAAA,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;IAC3B,aAAA;qBAAM,IAAG,WAAW,KAAK,SAAS,EAAE;IACpC,gBAAA,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;IAC3B,aAAA;IAED,YAAA,IAAI,SAAS,GAAgB;IAC5B,gBAAA,IAAI,EAAE,EAAE;IACR,gBAAA,QAAQ,EAAE,WAAW;IACrB,gBAAA,KAAK,EAAE,QAAQ;IACf,gBAAA,IAAI,EAAE,UAAU;iBAChB,CAAA;;IAGD,YAAA,IAAI,SAAS,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;gBAC9B,IAAG,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,aAAa,CAAC,OAAO,EAAE;oBACnD,IAAI,SAAS,GAAG,aAAa,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;IAC9C,gBAAA,cAAc,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC;IACtE,aAAA;IAED,YAAA,WAAW,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;IAClC,SAAA;IACD,KAAA;IACF,CAAC;IAED;;;;;IAKG;IACH,SAAS,cAAc,CAAC,YAA4B,EAAE,SAAc,EAAE,MAAmB,EAAA;IACxF,IAAA,KAAI,IAAI,CAAC,GAAG,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;IACjD,QAAA,IAAI,QAAQ,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;YAC/B,IAAG,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;IACvC,YAAA,IAAG,QAAQ,CAAC,IAAI,KAAK,IAAI,EAAE;IAC1B,gBAAA,YAAY,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC1B,aAAA;gBACD,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;IACtC,SAAA;IACD,KAAA;IACF,CAAC;IAED;;;;;;;IAOG;IACa,SAAA,qBAAqB,CACpC,QAAkB,EAClB,QAAqB,EACrB,QAA6B,EAC7B,QAAa,EACb,KAAU,EACV,KAA0C,EAAA;IAE1C,IAAA,IAAI,MAAM,GAAgB;IACzB,QAAA,IAAI,EAAE,EAAE,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,QAAQ;SACzD,CAAC;;IAGF,IAAA,aAAa,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;IAEvC,IAAA,UAAU,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;IAE7B,IAAA,IAAG,QAAQ,CAAC,EAAE,CAAC,CAAC,cAAc,EAAE;;;YAG/B,KAAI,IAAI,KAAK,IAAI,QAAQ,CAAC,EAAE,CAAC,CAAC,cAAe,EAAE;IAC9C,YAAA,IAAG,KAAK,CAAC,MAAM,CAAC,IAAI,KAAK,EAAE,EAAE;;;;oBAI5B,IAAI,SAAS,GAAG,aAAa,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;IAC9C,gBAAA,cAAc,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,SAAS,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;IAC9E,gBAAA,cAAc,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;IAC3E,aAAA;gBAED,IAAG,KAAK,CAAC,aAAa,EAAE;oBACvB,WAAW,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;IAC1C,aAAA;IACD,SAAA;IACD,QAAA,OAAO,QAAQ,CAAC,EAAE,CAAC,CAAC,cAAc,CAAC;IACnC,KAAA;IACI,SAAA;IACJ,QAAA,OAAO,CAAC,IAAI,CAAC,6BAA6B,QAAQ,CAAA,UAAA,CAAY,CAAC,CAAC;IAChE,KAAA;IACF;;ICvPA;;;;;;IAMG;IAWI,MAAM,MAAM,GAAmB,SAAS,MAAM,CAEpD,KAAK,EACL,WAAW,EACX,GAAG,KAAK,EAAA;IAER,IAAA,IAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,aAAa,CAAC,MAAM,EAAE;;;YAGtD,OAAO,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,KAAK,CAAC,CAAC;IAC3F,KAAA;IAED,IAAA,IAAI,qBAAqB,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACzE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,QAAQ,CAAC;IACnD,IAAA,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAClD,IAAA,IAAI,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,KAAK,CAAC,CAAC;QAClG,IAAI,IAAI,GAAG,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC;IAEzC,IAAA,IAAG,qBAAqB,EAAE;YACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC;IACjC,KAAA;IAAM,SAAA;YACN,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;IACjD,KAAA;IAED,IAAA,qBAAqB,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IAEpH,IAAA,OAAO,OAAO,CAAC;IAChB,CAAC,CAAA;IAEM,MAAM,KAAK,GAAkB,SAAS,KAAK,GAAA;IACjD,IAAA,IAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,aAAa,CAAC,MAAM,EAAE;;;IAGtD,QAAA,OAAO,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;IAC5D,KAAA;IAED,IAAA,IAAI,qBAAqB,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACzE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,QAAQ,CAAC;IACnD,IAAA,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAClD,IAAI,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;IAEnE,IAAA,IAAG,qBAAqB,EAAE;YACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC;IACjC,KAAA;IAAM,SAAA;YACN,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;IACjD,KAAA;IAED,IAAA,qBAAqB,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,KAAK,EAAE,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IAEjH,IAAA,OAAO,OAAO,CAAC;IAChB,CAAC,CAAA;IAEM,MAAM,OAAO,GAAoB,SAAS,OAAO,CAAmB,GAAG,KAAK,EAAA;IAClF,IAAA,IAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,aAAa,CAAC,MAAM,EAAE;;;YAGtD,OAAO,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,GAAG,KAAK,CAAC,CAAC;IACxE,KAAA;IAED,IAAA,IAAI,qBAAqB,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACzE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,QAAQ,CAAC;IACnD,IAAA,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAClD,IAAI,SAAS,GAAW,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,GAAG,KAAK,CAAC,CAAC;IACzF,IAAA,IAAI,IAAI,GAAG,EAAE,KAAK,EAAE,CAAC;IAErB,IAAA,IAAG,qBAAqB,EAAE;YACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC;IACjC,KAAA;IAAM,SAAA;YACN,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;IACjD,KAAA;IAED,IAAA,qBAAqB,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IAErH,IAAA,OAAO,SAAS,CAAC;IAClB,CAAC;;;;;;;;;IC3FM,MAAM,mBAAmB,GAAG,IAAI,CAAC;IACjC,MAAM,wCAAwC,GAAG,GAAG;;ICD3D;;;;;;IAMG;IAiBH;;;IAGG;IACH,IAAI,kBAAkB,GAAG,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACpD,IAAI,qBAAqB,GAAiC,EAAE,CAAC;IAC7D,KAAI,IAAI,CAAC,GAAG,kBAAkB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;IACvD,IAAA,IAAI,IAAI,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC;IACjC,IAAA,IAAI,OAAO,GAAG,wCAAwC,GAAG,IAAI,CAAC;IAE9D,IAAA,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACjC,qBAAqB,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC;QAClD,qBAAqB,CAAC,OAAO,CAAC,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC;IACrD,CAAA;UAaY,SAAS,CAAA;IACrB;;IAEG;IACH,IAAA,OAAO,IAAI,CAAI,MAAsB,EAAE,UAAU,EAAiB,EAAA;;IACjE,QAAA,MAAM,EACL,MAAM,GAAG,IAAI,EACb,cAAc,GAAG,KAAK,EACtB,IAAI,GAAG,EAAE,EACT,KAAK,GACL,GAAG,OAAO,CAAC;IAEZ,QAAA,MAAM,YAAY,GAAG,CAAA,EAAA,GAAA,KAAK,KAAL,IAAA,IAAA,KAAK,KAAL,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,KAAK,CAAE,YAAY,MAAI,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,IAAI,CAAC;IACjD,QAAA,MAAM,KAAK,GAAG,CAAA,EAAA,GAAA,KAAK,KAAL,IAAA,IAAA,KAAK,KAAL,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,KAAK,CAAE,KAAK,MAAI,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,MAAM,CAAC;IAErC,QAAA,IAAI,iBAAiB,GAAa;gBACjC,CAAC,GAAG,GAAG;oBACN,MAAM,EAAE,aAAa,CAAC,MAAM;oBAC5B,IAAI;IACJ,aAAA;IACD,YAAA,CAAC,EAAE,GAAG,EAAE,eAAe,EAAE,IAAI,EAAyB;aACtD,CAAC;IACF,QAAA,IAAI,kBAAkB,GAAc;gBACnC,CAAC,GAAG,GAAG,EAAE,MAAM,EAAE,cAAc,CAAC,KAAK,EAAE;IACvC,YAAA,CAAC,EAAE,GAAG,EAAE,eAAe,EAAE,IAAI,EAA0B;aACvD,CAAC;IAEF,QAAA,MAAM,QAAQ,GAAG,WAAW,CAAC,iBAAiB,EAAE,EAAE,EAAE,kBAAkB,EAAE,MAAM,CAAC,CAAC;IAEhF,QAAA,MAAM,QAAQ,GAAG;gBAChB,MAAM;gBACN,cAAc;gBACd,YAAY;gBACZ,KAAK;gBACL,QAAQ,EAAE,QAAQ,CAAC,QAAQ;gBAC3B,SAAS,EAAE,QAAQ,CAAC,SAAS;aACA,CAAC;YAE/B,OAAO,SAAS,CAAC,WAAW,CAAI,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAC;SAC7D;IAED;;IAEG;IACH,IAAA,OAAO,WAAW,CACjB,QAAmC,EACnC,cAAwB,EACxB,cAAuB,EAAA;YAEvB,MAAM,eAAe,GAAG,cAAc,CAAC,EAAE,CAAC,CAAC,SAAU,CAAC;IACtD,QAAA,IAAI,QAAkB,CAAC;IACvB,QAAA,IAAI,SAAoB,CAAC;IAEzB,QAAA,IAAG,cAAc,KAAK,SAAS,EAAE;gBAChC,QAAQ,GAAG,cAAc,CAAC;gBAC1B,SAAS,GAAG,eAAe,CAAC;IAC5B,SAAA;IACI,aAAA;;gBAEJ,MAAM,QAAQ,GAAG,WAAW,CAC3B,cAAc,EACd,cAAc,EACd,eAAe,EACf,eAAe,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,cAAc,CAAC,CAC1C,CAAC;IACF,YAAA,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;IAC7B,YAAA,SAAS,GAAG,QAAQ,CAAC,SAAU,CAAC;IAChC,SAAA;YAED,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC;IAEpC,QAAA,MAAM,YAAY,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;IAExC,QAAA,IAAG,UAAU,CAAC,YAAY,CAAC,EAAE;IAC5B,YAAA,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAiB,MAAM,EAAE;oBACzD,GAAG,EAAE,CAAC,MAAsB,oCAAmC,QAAuB,EAAE,KAAK,KAAI;wBAChG,IAAG,QAAQ,CAAC,cAAc,KAAK,KAAK,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,YAAY,EAAE,QAAQ,CAAC,IAAI,QAAQ,IAAI,MAAM,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;;IAElJ,wBAAA,OAAO,YAAY,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,SAAS,EAAE,CAAC,CAAC;IACtE,qBAAA;IACI,yBAAA,IAAG,kBAAkB,CAAC,QAAQ,CAAC,QAAkB,CAAC,IAAI,OAAO,MAAM,CAAC,QAAQ,CAAC,KAAK,WAAW,EAAE;;IAEnG,wBAAA,OAAO,qBAAqB,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,SAAS,EAAE,CAAC,CAAC;IAC/E,qBAAA;IACI,yBAAA,IAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;IAC/E,wBAAA,OAAO,MAAM,CAAC,QAAQ,CAAC,CAAC;IACxB,qBAAA;IACI,yBAAA,IACJ,SAAS,CAAC,QAAQ,CAAC;+BAChB,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK;IAC7B,2BAAA,SAAS,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,cAAc,CAAC,KAAK,EAC1D;4BACD,OAAO,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC;IACrC,qBAAA;IAAM,yBAAA;IACN,wBAAA,OAAO,MAAM,CAAC,QAAQ,CAAC,CAAC;IACxB,qBAAA;qBACD;IAED,gBAAA,GAAG,EAAE,CAAC,MAAM,oCAAmC,QAAQ,EAAE,KAAK,EAAE,KAAK,KAAI;IACxE;;;;;;;;;IASG;IACH,oBAAA,IAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,aAAa,CAAC,OAAO,EAAE;IAClD,wBAAA,OAAO,CAAC,KAAK,CAAC,qDAAqD,EAAE,QAAQ,CAAC,CAAC;IAC/E,wBAAA,OAAO,IAAI,CAAC;IACZ,qBAAA;6BACI,IACJ,OAAO,QAAQ,KAAK,QAAQ;IACzB,2BAAA,QAAQ,CAAC,UAAU,CAAC,mBAAmB,CAAC,EAC1C;IACD,wBAAA,MAAM,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC;IACzB,wBAAA,OAAO,IAAI,CAAC;IACZ,qBAAA;6BACI,IAAG,QAAQ,KAAK,QAAQ,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,EAAE;;4BAExE,IAAI,UAAU,GAAG,MAAM,CAAC,wBAAwB,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IACnE,wBAAA,IAAG,OAAO,UAAU,KAAK,QAAQ,IAAI,UAAU,CAAC,UAAU,KAAK,KAAK,EAAE;IACrE,4BAAA,MAAM,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC;IACzB,4BAAA,OAAO,IAAI,CAAC;IACZ,yBAAA;IACD,qBAAA;wBAED,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;wBAChC,IAAI,eAAe,GAAG,KAAK,CAAC;IAC5B,oBAAA,IAAG,SAAS,CAAC,QAAQ,CAAC,KAAK,SAAS,IAAI,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,SAAS,EAAE;;IAEpF,wBAAA,SAAS,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,cAAc,CAAC,OAAO,CAAC;4BACzD,OAAO,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC;4BACxC,eAAe,GAAG,IAAI,CAAC;4BACvB,IAAG,QAAQ,CAAC,MAAM,EAAE;;IAEnB,4BAAA,UAAU,CAAC,SAAS,CAAC,OAAO,EAAE,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;IACpF,yBAAA;IACD,qBAAA;IAED,oBAAA,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC;IACzB,oBAAA,MAAM,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC;wBAEzB,IAAI,YAAY,GAAG,KAAK,CAAC;IACzB,oBAAA,IAAI,WAAW,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC;IACpC,oBAAA,IAAG,UAAU,CAAC,WAAW,CAAC,EAAE;4BAC3B,SAAS,CAAC,WAAW,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;4BACpD,YAAY,GAAG,IAAI,CAAC;IACpB,qBAAA;IAED,oBAAA,aAAa,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,eAAe,EAAE,KAAK,EAAE,YAAY,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC;IAElG,oBAAA,OAAO,IAAI,CAAC;qBACZ;IAED;;IAEG;oBACH,cAAc,EAAE,CAAC,MAAM,oCAAmC,QAAQ,EAAE,UAAU,KAAI;IACjF,oBAAA,IAAG,OAAO,QAAQ,KAAK,QAAQ,EAAE;4BAChC,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAC;IACpD,wBAAA,OAAO,IAAI,CAAC;IACZ,qBAAA;wBAED,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;wBAChC,IAAI,eAAe,GAAG,KAAK,CAAC;IAC5B,oBAAA,IAAG,SAAS,CAAC,QAAQ,CAAC,KAAK,SAAS,IAAI,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,SAAS,EAAE;;IAEpF,wBAAA,SAAS,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,cAAc,CAAC,OAAO,CAAC;4BACzD,OAAO,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC;4BACxC,eAAe,GAAG,IAAI,CAAC;4BACvB,IAAG,QAAQ,CAAC,MAAM,EAAE;;IAEnB,4BAAA,UAAU,CAAC,SAAS,CAAC,OAAO,EAAE,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;IACpF,yBAAA;IACD,qBAAA;wBAED,UAAU,CAAC,KAAK,GAAG,SAAS,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;wBAC/C,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAC;IACpD,oBAAA,IAAI,KAAK,GAAG,UAAU,CAAC,KAAK,CAAC;wBAC7B,IAAI,YAAY,GAAG,KAAK,CAAC;;wBAEzB,IAAI,WAAW,GAAG,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;wBAC/C,IAAG,UAAU,CAAC,WAAW,CAAC,IAAI,UAAU,CAAC,UAAU,KAAK,IAAI,EAAE;4BAC7D,SAAS,CAAC,WAAW,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;4BACpD,YAAY,GAAG,IAAI,CAAC;IACpB,qBAAA;IAED,oBAAA,aAAa,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,eAAe,EAAE,KAAK,EAAE,YAAY,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC;IAElG,oBAAA,OAAO,IAAI,CAAC;qBACZ;oBAED,cAAc,EAAE,CAAC,MAAM,oCAAmC,QAAQ,KAAI;IACrE,oBAAA,IAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;;IAE1E,wBAAA,OAAO,MAAM,CAAC,QAAQ,CAAC,CAAC;IACxB,wBAAA,OAAO,IAAI,CAAC;IACZ,qBAAA;IAED,oBAAA,IAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,aAAa,CAAC,OAAO,EAAE;IAClD,wBAAA,OAAO,CAAC,KAAK,CAAC,0BAA0B,QAAQ,CAAA,qBAAA,CAAuB,CAAC,CAAC;IACzE,wBAAA,OAAO,IAAI,CAAC;IACZ,qBAAA;wBAED,IAAG,QAAQ,IAAI,MAAM,EAAE;4BACtB,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;4BAChC,IAAI,eAAe,GAAG,KAAK,CAAC;IAC5B,wBAAA,IAAG,SAAS,CAAC,QAAQ,CAAC,KAAK,SAAS,IAAI,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,SAAS,EAAE;;IAEpF,4BAAA,SAAS,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,cAAc,CAAC,OAAO,CAAC;gCACzD,OAAO,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC;gCACxC,eAAe,GAAG,IAAI,CAAC;gCACvB,IAAG,QAAQ,CAAC,MAAM,EAAE;;IAEnB,gCAAA,UAAU,CAAC,SAAS,CAAC,OAAO,EAAE,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;IACpF,6BAAA;IACD,yBAAA;IAED,wBAAA,OAAO,MAAM,CAAC,QAAQ,CAAC,CAAC;IAExB,wBAAA,aAAa,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,eAAe,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC;IAE/F,wBAAA,OAAO,IAAI,CAAC;IACZ,qBAAA;IACI,yBAAA;4BACJ,OAAO,IAAI,CAAC;IACZ,qBAAA;qBACD;IAC+B,aAAA,CAAyD,CAAC;gBAE3F,SAAS,CAAC,EAAE,CAAC,CAAC,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;gBACtC,SAAS,CAAC,EAAE,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;IAExC,YAAA,IAAG,UAAU,CAAC,YAAY,CAAC,EAAE;oBAC5B,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC/B,gBAAA,KAAI,IAAI,GAAG,IAAI,IAAI,EAAE;IACpB,oBAAA,IAAI,GAAG,CAAC,UAAU,CAAC,mBAAmB,CAAC,EAAE;4BACxC,SAAS;IACT,qBAAA;wBACD,IAAI,cAAc,GAAG,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;IAC7C,oBAAA,IAAG,UAAU,CAAC,cAAc,CAAC,EAAE;4BAC9B,SAAS,CAAC,WAAW,CAAC,QAAQ,EAAE,QAAQ,EAAE,GAAG,CAAC,CAAC;IAC/C,qBAAA;IACD,iBAAA;IACD,aAAA;IACI,iBAAA;IACJ,gBAAA,OAAO,CAAC,IAAI,CAAC,YAAY,YAAY,CAAA,oBAAA,CAAsB,CAAC,CAAC;IAC7D,aAAA;gBAED,OAAO,SAAS,CAAC,KAAK,CAAC;IACvB,SAAA;IACI,aAAA;gBACJ,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACtC,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,gBAAA,EAAmB,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAE,CAAA,CAAC,CAAC;IACtD,SAAA;SACD;IAED;;;IAGG;QACH,OAAO,OAAO,CAAC,KAAwB,EAAA;;IACtC,QAAA,IAAI,SAAoB,CAAC;YACzB,IAAI;IACH,YAAA,MAAM,KAAK,GAAI,KAAuC,CAAC,kBAAkB,EAAE,CAAC;IAC5E,YAAA,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC;IAC5B,SAAA;IAAC,QAAA,OAAM,KAAK,EAAE;IACd,YAAA,OAAO;IACP,SAAA;YAED,IAAG,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,cAAc,CAAC,KAAK,EAAE;gBAClD,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,cAAc,CAAC,OAAO,CAAC;IAC/C,SAAA;IAED,QAAA,IAAI,WAAW,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC;IAEpC,QAAA,IAAG,UAAU,CAAC,WAAW,CAAC,EAAE;gBAC3B,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC9B,YAAA,KAAI,IAAI,GAAG,IAAI,IAAI,EAAE;IACpB,gBAAA,IAAI,GAAG,CAAC,UAAU,CAAC,mBAAmB,CAAC,EAAE;wBACxC,SAAS;IACT,iBAAA;oBACD,IAAI;wBACH,IAAI,cAAc,GAAG,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5C,oBAAA,IAAG,UAAU,CAAC,cAAc,CAAC,EAAE;;IAE9B,wBAAA,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,KAAM,CAAC,CAAC;IAC7C,qBAAA;IACD,iBAAA;IAAC,gBAAA,OAAM,KAAK,EAAE;IACd,oBAAA,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACrB,iBAAA;IACD,aAAA;gBAED,CAAA,EAAA,GAAA,CAAA,EAAA,GAAA,SAAS,CAAC,EAAE,CAAC,EAAC,MAAM,kDAAI,CAAC;;gBAEzB,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,cAAc,CAAC,OAAO,CAAC;IAC/C,SAAA;IACI,aAAA;IACJ,YAAA,OAAO,CAAC,IAAI,CAAC,YAAY,WAAW,CAAA,oBAAA,CAAsB,CAAC,CAAC;IAC5D,SAAA;SACD;IAED;;IAEG;QACH,OAAO,SAAS,CAAC,IAAY,EAAA;IAC5B,QAAA,OAAO,SAAS,CAAC,IAAI,CAAC,CAAC;SACvB;IAED;;IAEG;IACH,IAAA,OAAO,QAAQ,CAAC,GAAe,EAAE,IAAY,EAAA;IAK5C,QAAA,OAAO,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;SAC3B;IACD;;;;;;;;;;"}